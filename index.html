
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Passfort Partner API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen-6c1ba6b6.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-bccf8c07.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-79701991.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.8.2/css/lightbox.min.css" rel="stylesheet" />
  </head>

  <body class="index" data-languages="[&quot;python&quot;,&quot;javascript&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/portal-logo-21a418ff.svg" class="logo" alt="Portal logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="python">Python</a>
              <a href="#" data-language-name="javascript">NodeJS</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#overview" class="toc-h1 toc-link" data-title="Overview">Overview</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#how-a-partner-integration-works" class="toc-h2 toc-link" data-title="How a partner integration works">How a partner integration works</a>
                  </li>
                  <li>
                    <a href="#how-a-passfort-customer-uses-a-partner-integration" class="toc-h2 toc-link" data-title="How a Passfort customer uses a partner integration">How a Passfort customer uses a partner integration</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#get-started" class="toc-h1 toc-link" data-title="Get started">Get started</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#design-your-integration" class="toc-h2 toc-link" data-title="Design your integration">Design your integration</a>
                  </li>
                  <li>
                    <a href="#build-your-integration" class="toc-h2 toc-link" data-title="Build your integration">Build your integration</a>
                  </li>
                  <li>
                    <a href="#test-your-integration" class="toc-h2 toc-link" data-title="Test your integration">Test your integration</a>
                  </li>
                  <li>
                    <a href="#document-your-integration" class="toc-h2 toc-link" data-title="Document your integration">Document your integration</a>
                  </li>
                  <li>
                    <a href="#let-us-know-you-39-re-ready-to-launch" class="toc-h2 toc-link" data-title="Let us know you're ready to launch">Let us know you're ready to launch</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#support" class="toc-h1 toc-link" data-title="Support">Support</a>
          </li>
          <li>
            <a href="#about-this-documentation" class="toc-h1 toc-link" data-title="About this documentation">About this documentation</a>
          </li>
          <li>
            <a href="#technical-requirements" class="toc-h1 toc-link" data-title="Technical Requirements">Technical Requirements</a>
          </li>
          <li>
            <a href="#authentication" class="toc-h1 toc-link" data-title="Authentication">Authentication</a>
          </li>
          <li>
            <a href="#metadata" class="toc-h1 toc-link" data-title="Metadata">Metadata</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-integration-metadata" class="toc-h2 toc-link" data-title="Get Integration Metadata">Get Integration Metadata</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#configuration" class="toc-h1 toc-link" data-title="Configuration">Configuration</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#pricing" class="toc-h2 toc-link" data-title="Pricing">Pricing</a>
                  </li>
                  <li>
                    <a href="#supported-countries" class="toc-h2 toc-link" data-title="Supported countries">Supported countries</a>
                  </li>
                  <li>
                    <a href="#supported-features" class="toc-h2 toc-link" data-title="Supported features">Supported features</a>
                  </li>
                  <li>
                    <a href="#credentials-fields" class="toc-h2 toc-link" data-title="Credentials Fields">Credentials Fields</a>
                  </li>
                  <li>
                    <a href="#configuration-fields" class="toc-h2 toc-link" data-title="Configuration Fields">Configuration Fields</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#data-structure" class="toc-h1 toc-link" data-title="Data Structure">Data Structure</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#check-input" class="toc-h2 toc-link" data-title="Check input">Check input</a>
                  </li>
                  <li>
                    <a href="#check-errors" class="toc-h2 toc-link" data-title="Check errors">Check errors</a>
                  </li>
                  <li>
                    <a href="#check-charges" class="toc-h2 toc-link" data-title="Check charges">Check charges</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#demo-checks" class="toc-h1 toc-link" data-title="Demo Checks">Demo Checks</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#guidelines-for-demo-results" class="toc-h2 toc-link" data-title="Guidelines for demo results">Guidelines for demo results</a>
                  </li>
                  <li>
                    <a href="#demo-result-types" class="toc-h2 toc-link" data-title="Demo result types">Demo result types</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#using-your-integration" class="toc-h1 toc-link" data-title="Using your integration">Using your integration</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#setting-up-a-custom-provider" class="toc-h2 toc-link" data-title="Setting up a custom provider">Setting up a custom provider</a>
                  </li>
                  <li>
                    <a href="#validation" class="toc-h2 toc-link" data-title="Validation">Validation</a>
                  </li>
                  <li>
                    <a href="#revalidating-your-custom-provider" class="toc-h2 toc-link" data-title="Revalidating your custom provider">Revalidating your custom provider</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#one-time-sync-identity-check" class="toc-h1 toc-link" data-title="One-time Sync Identity Check">One-time Sync Identity Check</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-check-configuration-one-time-sync-identity-check" class="toc-h2 toc-link" data-title="Get Check Configuration (One-time Sync Identity Check)">Get Check Configuration (One-time Sync Identity Check)</a>
                  </li>
                  <li>
                    <a href="#run-one-time-sync-identity-check" class="toc-h2 toc-link" data-title="Run One-Time Sync Identity Check">Run One-Time Sync Identity Check</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#one-time-sync-company-data" class="toc-h1 toc-link" data-title="One-time Sync Company Data">One-time Sync Company Data</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-check-configuration-one-time-sync-company-data" class="toc-h2 toc-link" data-title="Get Check Configuration (One-time Sync Company Data)">Get Check Configuration (One-time Sync Company Data)</a>
                  </li>
                  <li>
                    <a href="#run-one-time-sync-company-data-check" class="toc-h2 toc-link" data-title="Run One-Time Sync Company Data Check">Run One-Time Sync Company Data Check</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#one-time-callback-document-verification" class="toc-h1 toc-link" data-title="One-time Callback Document Verification">One-time Callback Document Verification</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-check-configuration-one-time-callback-document-verification" class="toc-h2 toc-link" data-title="Get Check Configuration (One-time Callback Document Verification)">Get Check Configuration (One-time Callback Document Verification)</a>
                  </li>
                  <li>
                    <a href="#start-one-time-callback-document-verification" class="toc-h2 toc-link" data-title="Start One-Time Callback Document Verification">Start One-Time Callback Document Verification</a>
                  </li>
                  <li>
                    <a href="#ready-for-callback" class="toc-h2 toc-link" data-title="Ready for Callback">Ready for Callback</a>
                  </li>
                  <li>
                    <a href="#download-images" class="toc-h2 toc-link" data-title="Download images">Download images</a>
                  </li>
                  <li>
                    <a href="#callback-request" class="toc-h2 toc-link" data-title="Callback Request">Callback Request</a>
                  </li>
                  <li>
                    <a href="#finish-one-time-callback-document-verification" class="toc-h2 toc-link" data-title="Finish One-Time Callback Document Verification">Finish One-Time Callback Document Verification</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#one-time-callback-document-fetch" class="toc-h1 toc-link" data-title="One-time Callback Document Fetch">One-time Callback Document Fetch</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-check-configuration-one-time-callback-document-fetch" class="toc-h2 toc-link" data-title="Get Check Configuration (One-time Callback Document Fetch)">Get Check Configuration (One-time Callback Document Fetch)</a>
                  </li>
                  <li>
                    <a href="#start-one-time-callback-document-fetch" class="toc-h2 toc-link" data-title="Start One-Time Callback Document Fetch">Start One-Time Callback Document Fetch</a>
                  </li>
                  <li>
                    <a href="#ready-for-callback" class="toc-h2 toc-link" data-title="Ready for Callback">Ready for Callback</a>
                  </li>
                  <li>
                    <a href="#callback-request" class="toc-h2 toc-link" data-title="Callback Request">Callback Request</a>
                  </li>
                  <li>
                    <a href="#finish-one-time-callback-document-fetch" class="toc-h2 toc-link" data-title="Finish One-Time Callback Document Fetch">Finish One-Time Callback Document Fetch</a>
                  </li>
                  <li>
                    <a href="#download-document-file" class="toc-h2 toc-link" data-title="Download Document File">Download Document File</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#one-time-sync-company-custom" class="toc-h1 toc-link" data-title="One-time Sync Company Custom">One-time Sync Company Custom</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-check-configuration-for-one-time-sync-company-custom" class="toc-h2 toc-link" data-title="Get check configuration for one-time sync Company custom">Get check configuration for one-time sync Company custom</a>
                  </li>
                  <li>
                    <a href="#run-a-one-time-sync-company-custom-check" class="toc-h2 toc-link" data-title="Run a one-time sync Company custom check">Run a one-time sync Company custom check</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#one-time-sync-individual-custom" class="toc-h1 toc-link" data-title="One-time Sync Individual Custom">One-time Sync Individual Custom</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-check-configuration-for-one-time-sync-individual-custom" class="toc-h2 toc-link" data-title="Get check configuration for one-time sync Individual custom">Get check configuration for one-time sync Individual custom</a>
                  </li>
                  <li>
                    <a href="#run-a-one-time-sync-individual-custom-check" class="toc-h2 toc-link" data-title="Run a one-time sync Individual custom check">Run a one-time sync Individual custom check</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#supported-features" class="toc-h1 toc-link" data-title="Supported Features">Supported Features</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#company-search" class="toc-h2 toc-link" data-title="Company Search">Company Search</a>
                  </li>
                  <li>
                    <a href="#provider-field-checks" class="toc-h2 toc-link" data-title="Provider Field Checks">Provider Field Checks</a>
                  </li>
                  <li>
                    <a href="#embedding-or-linking-an-external-webpage" class="toc-h2 toc-link" data-title="Embedding or linking an external webpage">Embedding or linking an external webpage</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#requests-to-passfort" class="toc-h1 toc-link" data-title="Requests to Passfort">Requests to Passfort</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#callbacks" class="toc-h2 toc-link" data-title="Callbacks">Callbacks</a>
                  </li>
                  <li>
                    <a href="#download-image" class="toc-h2 toc-link" data-title="Download image">Download image</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li>&copy; 2020 Passfort</li>
            <li><a href="https://help.passfort.com/en/developer-documentation">Passfort developer documentation</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='overview'>Overview</h1>
<p>Passfort helps companies onboard new applicants and monitor potential risk that
existing customers bring to their organization.</p>

<p>For example, take a bank that requires all potential new customers to make an
application. As part of the application process, known as onboarding, the bank can
use Passfort to run <a href="https://help.passfort.com/en/about-checks.html#UUID-74daccb9-742c-69bf-a854-faff56aea7b2">checks</a> on the applicant. If the applicant
passes the required checks and is approved to become a customer, the bank can monitor
potential risk to their organization by reviewing any new or updated check results
that are returned in Passfort.</p>

<p>When you build and host an integration with Passfort, our users have the option to
run checks using your product and, if you choose to provide ongoing monitoring,
review any new and updated results your product flags.</p>
<h2 id='how-a-partner-integration-works'>How a partner integration works</h2>
<p>The Passfort Partner API integration has several components that link together to
allow a user to run a check with your product. The following diagram shows the flow
between components. Components 3, 4, and 5 are built and hosted by you.</p>

<p><a href="images/diagram-passfort-partner-api-components-fac670c0.png" data-lightbox="gallery" data-title="Passfort Partner API components" data-alt="Passfort Partner API components">  <img src="images/diagram-passfort-partner-api-components-fac670c0.png" alt="Passfort Partner API components" />
</a></p>
<h3 id='components'>Components</h3>
<p>The components of a partner integration are: </p>

<ol>
<li><strong>Passfort Lifecycle API</strong>: The API through which Passfort users request to run
a check and see its result. To learn more, see
the <a href="https://developer.passfort.com/api">Passfort Lifecycle API</a> reference.</li>
<li><strong>Passfort product</strong>: Our product for onboarding and monitoring. One of our core
product features is to allow users to run an onboarding check using the data provider
of their choice. </li>
<li><strong>Passfort Partner API</strong>: The API through which Passfort requests you run a check
and through which you return the result. You’ll build and host this interface. Our
documentation is here to help you understand which endpoints to support. </li>
<li><strong>Integration service</strong>: Optionally, you can build an intermediary service to
handle communication between your product and the Passfort Partner API. </li>
<li><strong>Partner product</strong>: Your product runs the check and returns the result. </li>
</ol>
<h3 id='request-process'>Request process</h3>
<p>The process for a user to request a check and get the result is as follows:</p>

<ol>
<li>A Passfort user requests a check. This request is passed through the Passfort
Lifecycle API to the Passfort product.</li>
<li>The Passfort product passes the request to your Partner product through the
Passfort Partner API. The request includes any relevant information you might need
to run the check, for example key details about the onboarding applicant. Optionally,
you can build a service to handle communication between the Passfort Partner API and
your Partner product. </li>
<li>Your Partner product runs the check and uses the Passfort Partner API to return
the result to our Passfort product. </li>
<li>Depending on the check type, the Passfort product may perform additional
validation on top of the result you return. For example, with a
<a href="#one-time-callback-document-verification">Document verification</a> check, Passfort
confirms the data you’ve extract from the document matches the <em>profile data</em>.
Profile data is the term Passfort uses to refer to an applicant’s data, for example,
the applicant’s name and date of birth.</li>
<li>The Passfort product returns the results to the user through the Passfort
Lifecycle API. </li>
</ol>
<h2 id='how-a-passfort-customer-uses-a-partner-integration'>How a Passfort customer uses a partner integration</h2>
<p>After you’ve published your integration, Passfort customers can ask us to add your
check to their account. </p>

<p>To do this, we add the relevant <a href="https://help.passfort.com/en/about-checks.html#UUID-74daccb9-742c-69bf-a854-faff56aea7b2">check</a> type and
<a href="https://help.passfort.com/en/introduction-to-passfort-s-terms.html#UUID-c66c0e29-d6ff-a907-7f04-5dc25343e4e2_UUID-75815ac5-928d-8775-2e61-9ca9333c9ca2">task</a> type to the customer’s <em>product</em> in Passfort. A product
in Passfort represents a real-life product that an applicant can apply for. Every
product in Passfort is associated with a specific onboarding flow.</p>

<p>The diagram that follows shows the elements of a product.</p>

<p><a href="images/diagram-elements-of-a-product-dcd95c75.png" data-lightbox="gallery" data-title="Elements of a product" data-alt="Elements of a product">  <img src="images/diagram-elements-of-a-product-dcd95c75.png" alt="Elements of a product" />
</a></p>
<h3 id='product-elements'>Product elements</h3>
<p>The elements of a product are as follows: </p>

<ol>
<li><strong>Smart policy</strong>: The <a href="https://help.passfort.com/en/introduction-to-passfort-s-terms.html#UUID-c66c0e29-d6ff-a907-7f04-5dc25343e4e2_UUID-e564acae-05b6-6bba-3ef8-dd63424003ec">smart policy</a> is a flow that
determines which due diligence task types an individual or company needs to complete
to be onboarded to the product. If individuals and companies can both apply for the
product, the product has one smart policy for individuals and another for companies. </li>
<li><strong>Risk model</strong>: The <a href="https://help.passfort.com/en/introduction-to-passfort-s-terms.html#UUID-c66c0e29-d6ff-a907-7f04-5dc25343e4e2_UUID-a3aed091-ecd5-3f31-a026-82ba5fa75037">risk model</a> is an optional feature
for evaluating an applicant’s potential risk to the user’s business. As with smart
policies, if individuals and companies can both apply for the product, the product
has one risk model for individuals and another for companies. Although risk models
don’t directly relate to your check, they can affect how a smart policy behaves.</li>
</ol>

<p>Note that your check will be for either individuals or companies, so will only be
included in one smart policy. If you would like to provide one check for individuals
and another for companies, you should create two different integrations, for example
<code>partnerurl.com/individual</code> and <code>partnerurl.com/company</code>.</p>

<p>When an individual or company makes a product application, the application follows
the smart policy flow. At certain points in the flow, onboarding tasks are added to
the application, including the one associated with your check type.</p>

<p>Once the associated task is added to the application, Passfort users have the option
to run your check. Alternatively, the check can be set up to run automatically as
soon as the task is created so user intervention isn’t required.</p>

<p>Note that one task type can have multiple check types. For example, the Verify
identity task can be associated with the Electronic identity check and an ID
verification check because both checks provide a way for the user to verify the
applicant’s identity.</p>

<p>Passfort users may also have multiple data providers to run the same check type.
This is useful, for example, if one check fails, or if the user wants to choose a
data provider that specializes in checks for the applicant’s country.</p>

<p>The diagram that follows shows that every task type must have at least one check type
and every check type must have at least one data provider. There is no limit to the
number of checks that can be associated with a task, and there is no limit to the
number of data providers that can be used for one check.</p>

<p><a href="images/diagram-task-types-check-types-data-providers-ef3c0598.png" data-lightbox="gallery" data-title="The relationship between task types, check types, and data providers" data-alt="The relationship between task types, check types, and data providers">  <img src="images/diagram-task-types-check-types-data-providers-ef3c0598.png" alt="The relationship between task types, check types, and data providers" />
</a></p>

<p>When a user requests a check with your product, we pass the request to you. When you
return the results to us, Passfort users access them through the Passfort Lifecycle
API. Our product presents the check result in a clear, consistent way so our
customers can easily compare results from different checks.</p>
<h1 id='get-started'>Get started</h1>
<p>To integrate with Passfort, you’ll build the Passfort Partner API. This should be a
JSON web service that conforms to the specifications outlined in this document.</p>

<p>Note that an integration should only support one check type. If you would like to
provide Passfort users with multiple check types, you should create one integration
per check type.</p>
<h2 id='design-your-integration'>Design your integration</h2>
<p>Your design should consider the following:</p>

<ol>
<li>Which check type you’ll support. The check type determines the kind of information
you’ll provide to Passfort users. For example, The
<a href="#one-time-sync-identity-check">Identity check</a> type is used to confirm an individual
is who they say they are, and the <a href="#one-time-sync-company-data">Company data</a> check
type is used to get basic information about a company. </li>
<li>Which check template you’ll use, for example one-time sync or one-time callback.
The check template determines how the check behaves, including how long it takes to
return the check result and whether you’ll provide ongoing monitoring. Note that each
check type supports specific templates, as described in the documentation.</li>
<li>How you’ll map your data to the check result. We ask that you use the structures 
described in this documentation. Note that when the Passfort product displays the
check data to the user, there may be slight differences or certain fields may be
hidden. </li>
<li>Which configuration options you’d like to provide Passfort customers. You could,
for example, allow customers to specify which countries users can run the check for
or require customers to provide authorization credentials. Any configuration
options you send to the <a href="#configuration">Configuration</a> endpoint are displayed in
Passfort’s portal for customers to see and engage with.</li>
</ol>
<h2 id='build-your-integration'>Build your integration</h2>
<p>The Passfort Partner API JSON web service you build should meet the
<a href="#technical-requirements">technical requirements</a>.</p>

<p>All requests must follow the <a href="#authentication">rules for authentication</a>.</p>

<p>Your service should support endpoints for:</p>

<ul>
<li><a href="#metadata">Integration Metadata</a> hosted at <code>/</code></li>
<li><a href="#configuration">Configuration</a> hosted at <code>/config</code></li>
<li>The check, for example the
<a href="#one-time-sync-identity-check">One-time Sync Identity Check</a>, hosted at <code>/checks</code></li>
</ul>

<p>There may be additional endpoints for your check type and template. To learn more,
see the documentation for your check type and template.</p>

<p>You can learn more about check input, errors, and charges in the Data Structure section.</p>

<p>Your integration should also support <a href="#demo-checks">demo checks</a>.</p>
<h2 id='test-your-integration'>Test your integration</h2>
<p>After you’ve implemented a check, sign in to the Passfort portal and
<a href="#using-your-integration">register your product</a> as a custom provider. If you’re
supporting multiple checks, do this once per check.</p>

<p>Next, <a href="#validation">run the validation suite</a> to test whether the Passfort product
can send requests to your product and receive responses correctly. Note that the
validation suite only provides sample data and does not include real check data. </p>

<p>Finally, you should create a sandbox environment so you can test the check with
your real check data. </p>

<p>If you make any changes to your check or configuration, you should
<a href="#revalidating-your-custom-provider">re-run the validation suite</a>, then repeat your
real data tests in your sandbox environment.</p>
<h2 id='document-your-integration'>Document your integration</h2>
<p>Partners are responsible for writing, maintaining, and hosting their own
documentation. To ensure the best self-serve experience for customers, we suggest
including the following:</p>

<ul>
<li>A description of the check’s purpose. Ideally, this would include a link back to
our description of the associated <a href="https://help.passfort.com/en/checks-128888.html">check type</a> and a link
to our corporate website so your users have an up-to-date description of Passfort.
For example, if you’re providing a Company data check, we suggest using this
introductory sentence: “In <a href="https://www.moodys.com/web/en/us/kyc/products/passfort.html">Passfort by Moody’s</a>, you can use
[your product name] to run a <a href="https://help.passfort.com/en/checks-for-company-profiles.html#UUID-65716b6e-1ab7-edb1-89a9-f3242bd3b0b9_UUID-2bcf7301-5783-10f5-69fb-45e584b05b3e">Company data check</a> to see
who owns and controls a company.”</li>
<li>A description of any results that a user will see when they run your check. This
will help users understand what your results represent and how they might use them.</li>
<li>A description of any other key concepts that are specific to your product.</li>
<li>A description of each of your configuration options and any other information a
user is required to provide when they set up your check.</li>
<li>If you’ve produced an API for your users, a reference that describes the endpoints
as well as which fields are sent in requests and returned in responses.</li>
<li>Links to any other relevant documentation you have.</li>
</ul>
<h2 id='let-us-know-you-39-re-ready-to-launch'>Let us know you&#39;re ready to launch</h2>
<p>Partners are responsible for informing us 14 days before launching so we have time
to test and set up any additional components on our end. Please be aware we may need
a longer processing time during the Christmas holidays. To inform us or ask any
questions, send an email to <a href="mailto:passfort_partners@moodys.com">passfort_partners@moodys.com</a> and include the following
information:</p>

<ul>
<li>Your secret key</li>
<li>Your API URI</li>
</ul>
<h1 id='support'>Support</h1>
<p>If you have any questions, you can always send us an email at <a href="mailto:passfort_partners@moodys.com">passfort_partners@moodys.com</a>.</p>
<h1 id='about-this-documentation'>About this documentation</h1>
<p>As the majority of the Passfort Partner API is not called but served by integrations,
the endpoints documented here, unless otherwise indicated, are ones that your
integration should implement.</p>

<p>Code samples are given in the dark area to the right, and will generally take
the form of abbreviated route handlers for the functionality being described.
For the Python examples, <a href="https://flask.palletsprojects.com/en/1.0.x/">Flask 1.0</a> are used as the implementation
example, and <a href="https://expressjs.com/en/4x/api.html">Express 4</a> are used for the NodeJS examples.</p>

<p>As described in the <a href="#metadata">Metadata section</a>, the Passfort Partner API is
versioned to allow the implementation of integrations to be altered in the
future; all information in this document corresponds to Version 1 of the
Passfort Partner API Protocol. Versions of the Passfort Partner API won’t be
discontinued for as long as existing integrations use them.</p>
<h1 id='technical-requirements'>Technical Requirements</h1>
<p>Your integration <em>must</em> be served over HTTPS; integrations aren’t permitted to
be served over unencrypted HTTP connections. Additionally, the connection must
be using TLS 1.2 or above. This requirement is enforced to ensure that
sensitive information is not transmitted unprotected over the public internet.</p>

<p>Your integration may use plain HTTP for basic testing, but validation will fail
if your integration does not use HTTPS.</p>
<h1 id='authentication'>Authentication</h1>
<p>In order to protect the integrity and confidentiality of personal information
and to ensure your integration is only utilised by Passfort, all requests are
authenticated using the
<a href="https://tools.ietf.org/html/draft-cavage-http-signatures-12">HTTP signatures draft standard, version 12</a>.
Several usable implementations of the standard can be found on this
<a href="https://github.com/w3c-dvcg/http-signatures/issues/1">tracker of HTTP Signatures implementations</a> maintained
by the spec authors.</p>

<p>When implementing an integration, you must generate a 32 byte key secret key to sign
and verify all requests and responses your integration handles, unless
specifically noted in this document; the key ID to use should be the first 8
characters of the Base64 encoding of this key. The only supported algorithm is
<code>hmac-sha256</code>, and the only supported Digest is <code>SHA-256</code>.</p>

<p>You must sign and verify at least the <code>(request-target)</code> (the verb and full path of
the initial request) and <code>Date</code> headers. Requests with a body (eg. <code>POST</code> requests)
must also include and sign a <code>Digest</code> header. The <code>Date</code> header must be set to the
current date. Requests with any of...</p>

<ul>
<li>A missing or incorrect request signature.</li>
<li>A <code>Digest</code> header which is missing or does not match the request body.</li>
<li>A <code>Date</code> header which is missing or more than 30 seconds from the current time.</li>
</ul>

<p>... will be rejected.</p>

<aside class="warning">
 You <strong>must</strong> verify signatures in incoming requests - signing
 your outgoing requests alone is not adequate. The validation suite will fail
 integrations that do not correctly verify the signature of incoming requests.
</aside>
<h1 id='metadata'>Metadata</h1><h2 id='get-integration-metadata'>Get Integration Metadata</h2><pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.get</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_integration_metadata</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s">"protocol_version"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">"provider_name"</span><span class="p">:</span> <span class="s">"My Custom Integration"</span>        
    <span class="p">})</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">protocol_version</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="na">provider_name</span><span class="p">:</span> <span class="s1">'My Custom Integration'</span>
    <span class="p">})</span>
<span class="p">})</span>
</code></pre>
<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"protocol_version"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="s2">"provider_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My Custom Integration"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>This endpoint defines the basic properties of all integrations - which version
of the Passfort Partner API Protocol is being used, and the name of the provider
this integration connects to (for display and branding purposes
within Passfort). Currently, the only API Protocol version is <code>1</code>. This
endpoint is unauthenticated to allow future API versions to use different
authentication methods. <strong>All integrations regardless of type must serve
up this endpoint</strong>.</p>

<aside>
  If you update the name of the provider returned by the endpoint, it is only
  updated in Passfort when the integration is re-validated.
</aside>
<h3 id='http-request'>HTTP Request</h3>
<p><code>GET https://my-integration.example.com/</code></p>
<h3 id='response-fields'>Response fields</h3>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>protocol_version</code></td>
      <td>number</td>
      <td>Yes</td>
      <td>
        An integer representing the version of the version of the Integration
        API to use. Currently, this is always <code>1</code>.
      </td>
    </tr>
    <tr>
      <td><code>provider_name</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>
        The name of the provider this integration connects to. Currently, the
        name must be at least 6 characters in length, and no greater
        than 49 characters.
      </td>
    </tr>
  </tbody>
</table>

<aside>
    Requests made to this endpoint
  must not require authentication.
</aside>
<h1 id='configuration'>Configuration</h1>
<blockquote>
<p>A sample configuration for a synchronous identity check.</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"check_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IDENTITY_CHECK"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_template"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ONE_TIME_SYNCHRONOUS"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"timeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"pricing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"supports_reselling"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"maximum_cost"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"supported_countries"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"GBR"</span><span class="p">,</span><span class="w"> </span><span class="s2">"USA"</span><span class="p">,</span><span class="w"> </span><span class="s2">"CAN"</span><span class="p">],</span><span class="w">
  </span><span class="s2">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"username"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Username"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"boolean"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"boolean_config"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Boolean config field"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"subtext"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A description of the option"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"default"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MultiSelect"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"multiselect_config"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Config field with dropdown options"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"subtext"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A description of the option"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Option 1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Option 2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Option 3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Option 4"</span><span class="p">],</span><span class="w">
        </span><span class="s2">"default"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The configuration endpoint defines several important properties about your
integration. Most parts of the configuration are common to all integrations,
but the <code>check_type</code> and <code>check_template</code> are specific to each type of
integration and will be discussed in their respective sections.</p>

<aside>
  If you update the configuration returned by your integration, it's only
  updated in Passfort when the integration is re-validated.
</aside>
<h2 id='pricing'>Pricing</h2>
<p>The <code>pricing</code> field defines whether you intend to make your integration
available to Passfort for reselling, instead of requiring that Passfort
customers have a direct commercial relationship with the data provider.</p>
<h3 id='fields'>Fields</h3>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>supports_reselling</code></td>
      <td>boolean</td>
      <td>Yes</td>
      <td>
        Whether your integration supports being configured for reselling.
      </td>
    </tr>
    <tr>
      <td><code>maximum_cost</code></td>
      <td>number</td>
      <td>No</td>
      <td>
        The maximum amount of Passfort credits that can be charged for a
        single check. <strong>Required if <code>supports_reselling</code> is
        <code>true</code></strong>.
      </td>
    </tr>
  </tbody>
</table>

<aside>
  Passfort credit is purchased by Passfort's customers. It's used
  to pay for checks resold through Passfort, when reselling is
  supported by the data provider.
  
  Credits are tied to GBP at the ratio of £1 = 100 credits.
</aside>
<h2 id='supported-countries'>Supported countries</h2>
<p>The <code>supported_countries</code> field defines which countries your integration is
able to support. The exact interpretation of this field varies depending on
the check type, but it typically reflects country of residence for individuals
and the country of incorporation for companies. This field is an array of
strings, which should be the <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3">ISO3 country code</a> for the country. At
least one country must be specified.</p>
<h2 id='supported-features'>Supported features</h2>
<p>The optional <code>supported_features</code> field allows your integration to declare
support for additional features. The absence of this field from your
integration&#39;s config implies that no additional features are supported.</p>

<p>The list of possible features varies depending on the check type but are often
used to surface extra functionality implemented by the provider.</p>

<p>These features are currently recognised as items within the
<code>supported_features</code> array:</p>

<table>
  <thead>
    <th>Feature</th>
    <th>Check Type</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><a href="#company-search"><code>COMPANY_SEARCH</code></a></td>
      <td>Company Data</td>
      <td>The integration supports predictive search through the companies known to the provider.</td>
    </tr>
  </tbody>
</table>
<h2 id='credentials-fields'>Credentials Fields</h2>
<p>The <code>credentials</code> field contains exactly one field, <code>fields</code>, which specify
an array of single values needed for your integration to contact the data
provider and authorize itself successfully. Customers will provide these as
part of configuring your integration. For checks with reselling enabled,
these credentials won&#39;t be sent.</p>

<p>Per Passfort&#39;s general API compatibility policies, we may add new types for
configuration fields at any time, although existing types won&#39;t be removed.</p>

<aside class="warning">
  You should not alter existing credential fields once your integration is
  being used by Passfort customers. This can cause checks through your
  integration to stop working.
</aside>
<h3 id='fields-2'>Fields</h3>
<p>These fields are permitted on objects inside the <code>fields</code> array:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>type</code></td>
      <td>One of: <code>"string"</code>, <code>"password"</code></td>
      <td>Yes</td>
      <td>
        The type of the credential field. <code>password</code> is functionally identical
        to <code>string</code>, but is rendered as a password input in the UI.
      </td>
    </tr>
    <tr>
      <td><code>name</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>
        The name of the field which is used when sent to your
        integration.
      </td>
    </tr>
    <tr>
      <td><code>label</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>
        The name that's displayed for this field in Passfort.
      </td>
    </tr>
  </tbody>
</table>
<h2 id='configuration-fields'>Configuration Fields</h2>
<p>Like credentials, the <code>config</code> field contains exactly one field, <code>fields</code>,
which specify an array of configurable options for your integration that can
be set up on individual provider configurations, and is provided to your
integration on every check.</p>

<p>Per Passfort&#39;s general API compatibility policies, we may add new types for
configuration fields at any time, although existing types won&#39;t be removed.</p>

<aside class="warning">
  You should not alter existing configuration fields once your integration is
  being used by Passfort customers. This can cause checks through your
  integration to stop working.
</aside>
<h3 id='fields-3'>Fields</h3>
<p>These fields are permitted on objects inside the <code>fields</code> array:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>type</code></td>
      <td>One of: <code>"string"</code>, <code>"boolean"</code>, <code>"MultiSelect"</code></td>
      <td>Yes</td>
      <td>
        The type of the configuration field.
      </td>
    </tr>
    <tr>
      <td><code>name</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>
        The name of the field which is used when sent to your
        integration.
      </td>
    </tr>
    <tr>
      <td><code>label</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>
        The name that's displayed for this field in Passfort.
      </td>
    </tr>
    <tr>
      <td><code>subtext</code></td>
      <td>string</td>
      <td>No</td>
      <td>
        A short description that's displayed under the configuration
        option in Passfort.
      </td>
    </tr>
    <tr>
      <td><code>options</code></td>
      <td>array[string]</td>
      <td>No</td>
      <td>
        An <code>array</code> of options which may be chosen; used for both
        display name and value. Only applicable to (and required for) the
        <code>MultiSelect</code> field type.
      </td>
    </tr>
    <tr>
      <td><code>default</code></td>
      <td>A valid value allowed by the type specified in <code>type</code></td>
      <td>Yes</td>
      <td>
        The default value for this configuration field. For
        <code>MultiSelect</code> fields, this value may also be
        <code>null</code>. Otherwise, it must be a valid value for the field's
        type; for example, a <code>boolean</code> field may only have a
        <code>default</code> of either <code>true</code> or <code>false</code>.
      </td>
    </tr>
  </tbody>
</table>
<h1 id='data-structure'>Data Structure</h1>
<p>Passfort structures data on individual and company entities in a standard
format throughout the product. Additionally, many data structure types are
common across different checks.</p>
<h2 id='check-input'>Check input</h2>
<p>Checks are given information on a profile through the <code>check_input</code> field
on the JSON body of the request, either accepting <code>CompanyData</code> or
<code>IndividualData</code> depending on the check type. For full information on the
structure of this data, check the <a href="https://developer.passfort.com/api#tag/Checks/paths/~1profiles~1{profile_id}~1checks/post"><code>input_data</code> field on the &#39;Run a check&#39;
response in our API documentation</a> or consult the schemas
for <code>CompanyData</code> and <code>IndividualData</code> in our
<a href="https://identity.passfort.com/api/static/schemas/openapi_v41.json">OpenAPI spec</a>.</p>
<h2 id='check-errors'>Check errors</h2>
<p>All checks may return errors in their <code>errors</code> field using the structure
specified here.</p>
<h3 id='error-fields'>Error fields</h3>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>type</code></td>
      <td>One of the <a href="#error-types">supported error types</a></td>
      <td>Yes</td>
      <td>The type of error that's being reported.</td>
    </tr>
    <tr>
      <td><code>sub_type</code></td>
      <td>A valid error subtype for the specified <code>type</code></td>
      <td>No</td>
      <td>Provides additional detail for certain types of error.</td>
    </tr>
    <tr>
      <td><code>message</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>
        A message displayed in the Passfort portal to show the
        check error.
      </td>
    </tr>
    <tr>
      <td><code>data</code></td>
      <td>A map of strings to any valid JSON value</td>
      <td>No</td>
      <td>
        Integration-specific structured error information that customers can
        use to get additional information about the error.
      </td>
    </tr>
  </tbody>
</table>
<h3 id='error-types'>Error types</h3><h4 id='invalid_credentials'><code>INVALID_CREDENTIALS</code></h4>
<p>The data provider reported that the credentials used aren&#39;t valid.</p>
<h4 id='invalid_config'><code>INVALID_CONFIG</code></h4>
<p>Your integration is not able to run the check because it was sent with
invalid configuration values.</p>
<h4 id='missing_check_input'><code>MISSING_CHECK_INPUT</code></h4>
<p>Your integration is not able to run the check because the <code>input_data</code> does
not contain fields that are required by the data provider.</p>
<h4 id='invalid_check_input'><code>INVALID_CHECK_INPUT</code></h4>
<p>Your integration is not able to run because the <code>input_data</code> contains values
that your integration cannot handle, for example, because the date of birth
is not accurate enough, or because the country on the profile is not supported
by this data provider.</p>

<p>Subtypes:</p>

<table>
 <thead>
  <th>Subtype</th>
  <th>Description</th>
</thead>
<tbody>
  <tr>
    <td><code>UNSUPPORTED_COUNTRY</code></td>
    <td>
      The data provider doesn't support running checks for the
      requested country.
    </td>
  </tr>
  <tr>
    <td><code>MISSING_CONTACT_DETAILS</code></td>
    <td>
      Contact details are missing from the check input.
    </td>
  </tr>
</tbody>
</table>
<h4 id='provider_connection'><code>PROVIDER_CONNECTION</code></h4>
<p>A successful request could not be made to the data provider due to connection
issues, such as downtime or a check timeout.</p>
<h4 id='provider_message'><code>PROVIDER_MESSAGE</code></h4>
<p>The data provider returned an error message when processing this check.</p>
<h4 id='unsupported_demo_result'><code>UNSUPPORTED_DEMO_RESULT</code></h4>
<p>This error should be returned when your integration receives a <code>demo_result</code>
value which it doesn&#39;t support or does not have demo data implemented.</p>
<h2 id='check-charges'>Check charges</h2>
<p>Checks may return charges in their <code>charges</code> field using the structure
specified here.</p>
<h3 id='charge-fields'>Charge fields</h3>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>amount</code></td>
      <td>integer</td>
      <td>Yes</td>
      <td>
        The amount to charge (in pennies). In the future, it may be possible
        to specify a different currency unit.
      </td>
    </tr>
    <tr>
      <td><code>sku</code></td>
      <td>string</td>
      <td>No</td>
      <td>
        Stock Keeping Unit (SKU). All charges with the same SKU should cost the
        same amount. For providers with a fixed cost in each country, the SKU
        can simply be the 3-letter code for the country in which the check was
        run. This field can be omitted if there is no sensible value to use.
      </td>
    </tr>
    <tr>
      <td><code>reference</code></td>
      <td>string</td>
      <td>No</td>
      <td>
        The reference should be unique for each check. It should be possible
        to use the reference to correlate the charges recorded by the provider
        against the charges recorded in Passfort.
      </td>
    </tr>
  </tbody>
</table>
<h1 id='demo-checks'>Demo Checks</h1>
<p>Integrations should support the ability to provide demo results to customers
using Passfort&#39;s demo environments for integration work and evaluation. To this
end, the Passfort Partner API allows for checks to be run with a specifically
requested demo result using the <code>demo_result</code> field in the request payload
of most check types.</p>
<h2 id='guidelines-for-demo-results'>Guidelines for demo results</h2>
<ul>
<li><p>Your demo result outputs should match the structure of your live check
results as closely as possible, to ensure that they&#39;re representative of
the check results customers receive on live checks.</p></li>
<li><p>Your demo result outputs must incorporate the input data provided to the
check, so that Passfort&#39;s check results are interpreted correctly and
the check results imitate a result a customer might get for a profile in
a live check.</p></li>
<li><p>Your integration should provide as many demo results as possible, as long
as the data provider supports results meeting those criteria.</p></li>
<li><p>The <code>provider_data</code> field in the result should be populated with a
human-readable notice that the check was not run in the live environment,
such as <code>&quot;Demo result. Did not make request to provider.&quot;</code>.</p></li>
</ul>
<h2 id='demo-result-types'>Demo result types</h2>
<p>To support a wide range of testing scenarios, Passfort uses specific values
in the <code>demo_result</code> field to select demo results. The different types of demo
result are outlined below.</p>

<aside>
  New types of demo result may be added at any time, and so your integration
  may be asked to return a demo result it does not recognise, even if you
  implement all currently specified demo result types. You should return an
  error with the type <code>"UNSUPPORTED_DEMO_RESULT"</code> in the check
  result if you do not recognise a specific demo result type.
</aside>
<h3 id='demo-results-for-all-check-types'>Demo results for all check types</h3>
<p>These demo result values may be requested for any check type.</p>
<h4 id='any-required'><code>ANY</code> <span style="float:right">Required</span></h4>
<p>A demo result that&#39;s used as the default if nothing more specific is
requested. It should reflect a genuine non-error result for this integration,
but it does not need to be a passing result.</p>
<h4 id='any_charge-conditional'><code>ANY_CHARGE</code> <span style="float:right">Conditional</span></h4>
<p>This demo result will be used to test billing. This is required if your
integration supports reselling and
the maximum amount your integration can charge for a check is greater than
zero.</p>

<p>There are no requirements on what the result of the check must be, but if the
check is being resold, at least one non-zero charge must be returned. The usual
rules also still apply: the total amount charged must be no greater than the
maximum specified in your integration&#39;s configuration.</p>

<p>Note that, as this is a demo check, no credits will actually be deducted
from the customer.</p>
<h4 id='error_invalid_credentials-required'><code>ERROR_INVALID_CREDENTIALS</code> <span style="float:right">Required</span></h4>
<p>Your integration must return a result as if a customer with a direct commercial
relationship has provided credentials that have been rejected by the
data provider.</p>
<h4 id='error_any_provider_message-required'><code>ERROR_ANY_PROVIDER_MESSAGE</code> <span style="float:right">Required</span></h4>
<p>Your integration must return a result as if the data provider was successfully
reached but encountered a problem fulfilling the request, such a problem
with the service, or missing information in the request.</p>
<h4 id='error_connection_to_provider-required'><code>ERROR_CONNECTION_TO_PROVIDER</code> <span style="float:right">Required</span></h4>
<p>Your integration must return a result as if it attempted to contact the data
provider but the connection failed (due to timeouts or outages).</p>
<h3 id='demo-results-for-identity-checks'>Demo results for Identity Checks</h3>
<p>These demo result values are specific to Identity Checks.</p>
<h4 id='no_matches-required'><code>NO_MATCHES</code> <span style="float:right">Required</span></h4>
<p>Your integration must return a result where the data provider could not find
any matching records for the submitted profile.</p>
<h4 id='one_name_address_match-required'><code>ONE_NAME_ADDRESS_MATCH</code> <span style="float:right">Required</span></h4>
<p>Your integration must return a result where the data provider could find a
match on the full name and address for the submitted profile in a single
database.</p>
<h4 id='one_name_dob_match-optional'><code>ONE_NAME_DOB_MATCH</code> <span style="float:right">Optional</span></h4>
<p>Your integration must return a result where the data provider could find a
match on the full name and date of birth for the submitted profile in a single
database.</p>
<h4 id='two_name_address_match-optional'><code>TWO_NAME_ADDRESS_MATCH</code> <span style="float:right">Optional</span></h4>
<p>Your integration must return a result where the data provider could find a
match on the full name and address for the submitted profile in at least
<strong>two</strong> separate databases, if the provider supports this.</p>
<h4 id='one_name_address_one_name_dob_match-optional'><code>ONE_NAME_ADDRESS_ONE_NAME_DOB_MATCH</code> <span style="float:right">Optional</span></h4>
<p>Your integration must return a result where the data provider could find a
match on the full name and address for the submitted profile in a single
database, and a match on the full name and date of birth in <strong>another
separate database</strong>, if the provider supports this.</p>
<h4 id='one_name_address_dob_match-optional'><code>ONE_NAME_ADDRESS_DOB_MATCH</code> <span style="float:right">Optional</span></h4>
<p>Your integration must return a result where the data provider could find a
match on the full name, address, and date of birth for the submitted profile in
at least one database.</p>
<h4 id='mortality_match-optional'><code>MORTALITY_MATCH</code> <span style="float:right">Optional</span></h4>
<p>Your integration must return a result where the data provider could find a
match on the submitted profile in at least one mortality register, if the
provider supports this.</p>
<h4 id='one_name_address_mortality_match-optional'><code>ONE_NAME_ADDRESS_MORTALITY_MATCH</code> <span style="float:right">Optional</span></h4>
<p>Your integration must return a result where the data provider could find a
match on the full name and date of birth for the submitted profile in a single
database, and also a match in at least one mortality register, if the provider
supports this.</p>
<h4 id='one_name_address_one_name_dob_mortality_match-optional'><code>ONE_NAME_ADDRESS_ONE_NAME_DOB_MORTALITY_MATCH</code> <span style="float:right">Optional</span></h4>
<p>Your integration must return a result where the data provider could find a
match on the full name and address for the submitted profile in a single
database, and a match on the full name and date of birth in <strong>another
separate database</strong>, and also a match in at least one mortality register, if
the provider supports this.</p>
<h3 id='demo-results-for-document-checks'>Demo results for Document Checks</h3>
<p>These demo results are specific to Document verification and Document fetch
checks unless otherwise specified.</p>
<h4 id='error_unsupported_document_type-required'><code>ERROR_UNSUPPORTED_DOCUMENT_TYPE</code> <span style="float:right">Required</span></h4>
<p>Your integration must return a result as if a document was submitted whose type
is not supported by the data provider.</p>
<h4 id='document_image_check_failure'><code>DOCUMENT_IMAGE_CHECK_FAILURE</code></h4>
<p>Your integration must return a result as if a document was submitted which
failed one or more image checks. For example, if the document image was
too blurry.</p>
<h4 id='document_forgery_check_failure'><code>DOCUMENT_FORGERY_CHECK_FAILURE</code></h4>
<p>Your integration must return a result as if a document was submitted which
failed one or more forgery checks. For example, if the fonts used on the
document are incorrect.</p>
<h4 id='document_name_field_different'><code>DOCUMENT_NAME_FIELD_DIFFERENT</code></h4>
<p>Your integration must return a result where the name extracted from the
document differs from the name on the check input.</p>
<h4 id='document_name_field_unreadbale'><code>DOCUMENT_NAME_FIELD_UNREADBALE</code></h4>
<p>Your integration must return a result where no name could be extracted
from the document.</p>
<h4 id='document_dob_field_different'><code>DOCUMENT_DOB_FIELD_DIFFERENT</code></h4>
<p>Your integration must return a result where the date of birth extracted from the
document differs from the date of birth on the check input.</p>
<h4 id='document_dob_field_unreadbale'><code>DOCUMENT_DOB_FIELD_UNREADBALE</code></h4>
<p>Your integration must return a result where no date of birth could be extracted
from the document.</p>
<h4 id='document_all_pass-required'><code>DOCUMENT_ALL_PASS</code> <span style="float:right">Required</span></h4>
<p>Your integration must return a result where the extracted data matches the
check input and all image and forgery checks have passed.</p>
<h4 id='error_invalid_provider_reference-conditional'><code>ERROR_INVALID_PROVIDER_REFERENCE</code> <span style="float:right">Conditional</span></h4>
<p>This demo result is required for Document fetch checks. It is not used for
Document verification checks.</p>

<p>Your integration must return a result indicating that the document reference
passed as part of the check input was invalid.</p>
<h4 id='error_missing_contact_details-conditional'><code>ERROR_MISSING_CONTACT_DETAILS</code> <span style="float:right">Conditional</span></h4>
<p>This demo result is optional for Document fetch checks. It is not used for
Document verification checks.</p>

<p>Your integration must return an error indicating that the contact details field
is missing from the check input.</p>
<h3 id='demo-results-for-company-data-checks'>Demo results for Company Data Checks</h3>
<p>These demo results are specific to Company Data checks.</p>
<h4 id='no_data-required'><code>NO_DATA</code> <span style="float:right">Required</span></h4>
<p>Your integration must return a result as if the company details submitted
do not match any on the provider&#39;s records.</p>
<h4 id='all_data-required'><code>ALL_DATA</code> <span style="float:right">Required</span></h4>
<p>Your integration must return a result as if the provider had data for all of their
supported fields.</p>
<h4 id='company_inactive-required'><code>COMPANY_INACTIVE</code> <span style="float:right">Required</span></h4>
<p>Your integration must return a result as if the company submitted was on record as no
longer actively operating.</p>
<h4 id='company_country_of_incorporation_mismatch'><code>COMPANY_COUNTRY_OF_INCORPORATION_MISMATCH</code></h4>
<p>Your integration must return a result as if the company submitted was on record with a
different country of incorporation from the one submitted in the check input.</p>
<h4 id='company_name_mismatch-required'><code>COMPANY_NAME_MISMATCH</code> <span style="float:right">Required</span></h4>
<p>Your integration must return a result as if the company submitted was on record with a
different name from the one submitted in the check input.</p>
<h4 id='company_number_mismatch-required'><code>COMPANY_NUMBER_MISMATCH</code> <span style="float:right">Required</span></h4>
<p>Your integration must return a result as if the company submitted was on record with a
different number from the one submitted in the check input.</p>
<h4 id='company_resigned_officer'><code>COMPANY_RESIGNED_OFFICER</code></h4>
<p>Your integration must return a result with at least one associate with all its officer
relationships marked with a <code>FORMER</code> tenure.</p>
<h4 id='company_former_shareholder'>`COMPANY_FORMER_SHAREHOLDER</h4>
<p>Your integration must return a result with at least one associate with a shareholder
relationship marked with a <code>FORMER</code> tenure.</p>
<h4 id='company_officer_with_multiple_roles'><code>COMPANY_OFFICER_WITH_MULTIPLE_ROLES</code></h4>
<p>Your integration must return a result with at least one associate with more than one
officer relationship.</p>
<h4 id='company_shareholder_with_100_percent_ownership'><code>COMPANY_SHAREHOLDER_WITH_100_PERCENT_OWNERSHIP</code></h4>
<p>Your integration must return a result with at exactly one associate with a
single shareholder relationship owning 100% of the company.</p>
<h4 id='company_shareholder_with_significant_control'><code>COMPANY_SHAREHOLDER_WITH_SIGNIFICANT_CONTROL</code></h4>
<p>Your integration must return a result with at least one associate who has both a
shareholding relationship and one indicating significant control or influence
over the company.</p>
<h4 id='company_individual_of_significant_control'><code>COMPANY_INDIVIDUAL_OF_SIGNIFICANT_CONTROL</code></h4>
<p>Your integration must return a result with at least one associate which is an
individual with a relationship indicating significant control or influence over
the company.</p>
<h4 id='company_company_of_significant_control'><code>COMPANY_COMPANY_OF_SIGNIFICANT_CONTROL</code></h4>
<p>Your integration must return a result with at least one associate which is a
company with a relationship indicating significant control or influence over the
company.</p>
<h4 id='company_address_match-conditional'><code>COMPANY_ADDRESS_MATCH</code> <span style="float:right">Conditional</span></h4>
<p>Your integration must return a result as if the company submitted was on record with an
address matching the one submitted in the check input. This demo result is required
when the <a href="#provider-field-checks">Provider Field Checks</a> feature is in use.</p>
<h4 id='company_address_mismatch-conditional'><code>COMPANY_ADDRESS_MISMATCH</code> <span style="float:right">Conditional</span></h4>
<p>Your integration must return a result as if the company submitted was on record with a
different address from the one submitted in the check input. This demo result is required
when the <a href="#provider-field-checks">Provider Field Checks</a> feature is in use.</p>
<h1 id='using-your-integration'>Using your integration</h1>
<p>In order to use your data provider inside Passfort for testing or production
use, you must register the integration as a custom provider. A custom provider
allows your integration to be used by a single Passfort institution.</p>

<aside>
  If you are developing a check to be used by all users of Passfort, your
  integration will be published once it has gone through appropriate testing
  and review. You should use a custom provider during the development process.
</aside>
<h2 id='setting-up-a-custom-provider'>Setting up a custom provider</h2>
<p>To start setting up your integration, navigate to the <a href="https://identity.passfort.com/institution/policy-builder">Data providers</a> section
of the <a href="https://identity.passfort.com/institution/policy-builder/providers">Policy Builder</a> tab in the portal. Then, click the
<em>New data provider</em> button in the top-right corner of the page. Choose
<em>Individual data provider</em> or <em>Company data provider</em> as appropriate for your
integration.</p>

<p><a href="images/validation-add-integration-a1605ffe.png" data-lightbox="gallery" data-title="Policy builder data providers" data-alt="Policy builder data providers">  <img src="images/validation-add-integration-a1605ffe.png" alt="Policy builder data providers" />
</a></p>

<aside>
    If you can't find the <a href="https://identity.passfort.com/institution/policy-builder/providers">Policy Builder</a> tab, or the
    <em>New data provider</em> button, contact your Passfort admin to ensure
    your account has the correct permissions to manage data providers.
</aside>

<p>In the <em>New data provider</em> modal, first choose the check type for your custom
provider. Custom integrations are found at the bottom of the list.</p>

<p><a href="images/validation-choose-check-type-9a1eaeb5.png" data-lightbox="gallery" data-title="Check type selection in 'New data provider' modal" data-alt="Check type selection in 'New data provider' modal">  <img src="images/validation-choose-check-type-9a1eaeb5.png" alt="Check type selection in 'New data provider' modal" />
</a></p>

<p>Then choose a suitable name for your custom provider.</p>

<p><a href="images/validation-enter-check-name-fb0ac9fc.png" data-lightbox="gallery" data-title="Provider name entered 'New data provider' modal" data-alt="Provider name entered 'New data provider' modal">  <img src="images/validation-enter-check-name-fb0ac9fc.png" alt="Provider name entered 'New data provider' modal" />
</a></p>

<p>Then choose create, after which you will be brought to the Validation screen.</p>
<h2 id='validation'>Validation</h2>
<p>Your custom provider has not yet been saved; to begin using your custom
provider, you must first pass the validation suite for your check type. These
tests ensure your integration meets basic technical and security standards
required.</p>

<p><a href="images/validation-screen-24db5d3c.png" data-lightbox="gallery" data-title="Validation screen" data-alt="Validation screen">  <img src="images/validation-screen-24db5d3c.png" alt="Validation screen" />
</a></p>

<p>Enter the URL for your integration, as well as the secret key you have chosen.
See the <a href="#authentication">authentication section</a> for more information on the
requirements for your secret key. Once ready, press Run Validation to start the
validation process. The validation process may take some time, depending on the
check type and configuration of your integration.</p>

<aside>
    Your integration URL <em>must</em> end with a trailing slash.
</aside>

<p><a href="images/validation-results-6a175c72.png" data-lightbox="gallery" data-title="Validation results display" data-alt="Validation results display">  <img src="images/validation-results-6a175c72.png" alt="Validation results display" />
</a></p>

<p>Once the validation run has completed, the outcome and information on the tests
will be displayed below, including basic information detected about your check,
if available. If validation of your integration passed without any failures or
errors, you will now be able to click Save to create your custom provider as a
usable data provider. You can also view the results of individual tests run
during validation.</p>

<p><a href="images/validation-error-9d834f3b.png" data-lightbox="gallery" data-title="Error returned by the validation suite" data-alt="Error returned by the validation suite">  <img src="images/validation-error-9d834f3b.png" alt="Error returned by the validation suite" />
</a></p>

<p>If validation fails or encounters errors, you won&#39;t be able to save your
custom provider until they&#39;re addressed. View the test results for information
on why your custom provider has failed validation. In this case, validation
failed because a URL was provided for a non-existent domain.</p>
<h2 id='revalidating-your-custom-provider'>Revalidating your custom provider</h2>
<p>Should you want to retest validation for your custom provider at any point, or
if you have updated the configuration or settings for your check, you can
submit the provider for validation again. This allows you to quickly update
your custom provider&#39;s configuration without needing to reconfigure your
Passfort smart policy.</p>

<p><a href="images/custom-provider-revalidate-d48c81e8.png" data-lightbox="gallery" data-title="Update custom integration section on provider config" data-alt="Update custom integration section on provider config">  <img src="images/custom-provider-revalidate-d48c81e8.png" alt="Update custom integration section on provider config" />
</a></p>

<p>Press the <em>Update</em> button in the <em>Update custom integration</em> section. You will
be brought back to the validation screen.</p>

<aside class="warning">
    If you press <em>Save</em> on the validation screen to update your custom
    provider's validation, the configuration parameters will be reset to the
    default values to ensure that they're consistent in the event your
    credentials or config values are changed.
</aside>
<h1 id='one-time-sync-identity-check'>One-time Sync Identity Check</h1>
<p>This section lists all endpoints that must be implemented for a one-time
synchronous identity check integration.</p>

<p>One-time synchronous identity checks are identity checks with the following
behaviour:</p>

<ul>
<li><p>The check result will be returned directly upon request; the response will
not be sent until the check is finished (synchronous).</p></li>
<li><p>The check operates at a point-in-time: there is no ongoing monitoring
of the check result (one-time).</p></li>
</ul>
<h2 id='get-check-configuration-one-time-sync-identity-check'>Get Check Configuration (One-time Sync Identity Check)</h2>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.get</span><span class="p">(</span><span class="s">"/config"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_check_configuration</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s">"check_type"</span><span class="p">:</span> <span class="s">"IDENTITY_CHECK"</span><span class="p">,</span>
        <span class="s">"check_template"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"type"</span><span class="p">:</span> <span class="s">"ONE_TIME_SYNCHRONOUS"</span><span class="p">,</span>
            <span class="s">"timeout"</span><span class="p">:</span> <span class="mi">60</span>
        <span class="p">},</span>
        <span class="s">"pricing"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"supports_reselling"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s">"maximum_cost"</span><span class="p">:</span> <span class="mi">200</span>
        <span class="p">},</span>
        <span class="s">"supported_countries"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">"GBR"</span><span class="p">,</span>
            <span class="s">"USA"</span><span class="p">,</span>
            <span class="s">"CAN"</span>
        <span class="p">],</span>
        <span class="s">"credentials"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span>
                    <span class="s">"name"</span><span class="p">:</span> <span class="s">"username"</span><span class="p">,</span>
                    <span class="s">"label"</span><span class="p">:</span> <span class="s">"Username"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"password"</span><span class="p">,</span>
                    <span class="s">"name"</span><span class="p">:</span> <span class="s">"password"</span><span class="p">,</span>
                    <span class="s">"label"</span><span class="p">:</span> <span class="s">"Password"</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s">"config"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"boolean"</span><span class="p">,</span>
                    <span class="s">"name"</span><span class="p">:</span> <span class="s">"require_dob"</span><span class="p">,</span>
                    <span class="s">"label"</span><span class="p">:</span> <span class="s">"Date of birth is required for 1+1 and 2+2 results"</span><span class="p">,</span>
                    <span class="s">"subtext"</span><span class="p">:</span> <span class="s">"The individual's date of birth must be matched in one source for 1+1 and 2+2 results to be achieved"</span><span class="p">,</span>
                    <span class="s">"default"</span><span class="p">:</span> <span class="bp">False</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">})</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/config'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">check_type</span><span class="p">:</span> <span class="s1">'IDENTITY_CHECK'</span><span class="p">,</span>
        <span class="na">check_template</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="s1">'ONE_TIME_SYNCHRONOUS'</span><span class="p">,</span>
            <span class="na">timeout</span><span class="p">:</span> <span class="mi">60</span>
        <span class="p">},</span>
        <span class="na">pricing</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">supports_reselling</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="na">maximum_cost</span><span class="p">:</span> <span class="mi">200</span>
        <span class="p">},</span>
        <span class="na">supported_countries</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'GBR'</span><span class="p">,</span>
            <span class="s1">'USA'</span><span class="p">,</span>
            <span class="s1">'CAN'</span>
        <span class="p">],</span>
        <span class="na">credentials</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">fields</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span>
                    <span class="na">name</span><span class="p">:</span> <span class="s1">'username'</span><span class="p">,</span>
                    <span class="na">label</span><span class="p">:</span> <span class="s1">'Username'</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span> <span class="s1">'password'</span><span class="p">,</span>
                    <span class="na">name</span><span class="p">:</span> <span class="s1">'password'</span><span class="p">,</span>
                    <span class="na">label</span><span class="p">:</span> <span class="s1">'Password'</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="na">config</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">fields</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span> <span class="s1">'boolean'</span><span class="p">,</span>
                    <span class="na">name</span><span class="p">:</span> <span class="s1">'require_dob'</span><span class="p">,</span>
                    <span class="na">label</span><span class="p">:</span> <span class="s1">'Date of birth is required for 1+1 and 2+2 results'</span><span class="p">,</span>
                    <span class="na">subtext</span><span class="p">:</span> <span class="s1">'The individuals date of birth must be matched in one source for 1+1 and 2+2 results to be achieveds date of birth must be matched in one source for 1+1 and 2+2 results to be achieved'</span><span class="p">,</span>
                    <span class="na">default</span><span class="p">:</span> <span class="kc">false</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>

<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"check_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IDENTITY_CHECK"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_template"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ONE_TIME_SYNCHRONOUS"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"timeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"pricing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"supports_reselling"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"maximum_cost"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"supported_countries"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"USA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"CAN"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"username"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Username"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"boolean"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"require_dob"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Date of birth is required for 1+1 and 2+2 results"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"subtext"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The individual's date of birth must be matched in one source for 1+1 and 2+2 results to be achieved"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"default"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint specifies which configuration is used by Passfort to perform
one-time synchronous identity checks using your integration.</p>
<h3 id='http-request'>HTTP Request</h3>
<p><code>GET https://my-integration.example.com/config</code></p>
<h3 id='response-fields'>Response fields</h3>
<p>Most configuration fields are already discussed in the <a href="#configuration">configuration
section</a>. Check specific options will be discussed here.</p>
<h4 id='check-type'>Check type</h4>
<p>The <code>check_type</code> field must be set to <code>&quot;IDENTITY_CHECK&quot;</code>.</p>
<h4 id='check-template'>Check template</h4>
<p>The <code>check_template</code> fields for this check are:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>type</code></td>
      <td>The value <code>"ONE_TIME_SYNCHRONOUS"</code></td>
      <td>Yes</td>
      <td>
        Which check template to use for this check. For one-time synchronous
        checks, you must specify <code>"ONE_TIME_SYNCHRONOUS"</code>.
      </td>
    </tr>
    <tr>
      <td><code>timeout</code></td>
      <td>number</td>
      <td>No</td>
      <td>
        The number of seconds Passfort should wait without a response before
        considering identity checks run through this integration to have
        timed out. Must be an integer. If not specified or set to
        <code>null</code>, a timeout of 60 seconds is used.
      </td>
    </tr>
  </tbody>
</table>

<aside class="warning">
    Requests made to this endpoint must be verified
   per the <a href="#authentication">authentication section</a>.
</aside>
<h2 id='run-one-time-sync-identity-check'>Run One-Time Sync Identity Check</h2>
<p>This endpoint exposes your data provider&#39;s identity check to Passfort.</p>
<h3 id='http-request-2'>HTTP Request</h3>
<p><code>POST https://my-integration.example.com/checks</code></p>

<blockquote>
<p>A JSON payload following this structure will be sent to the endpoint:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01234567-89ab-cdef-0123-456789abcdef"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"demo_result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ANY"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"commercial_relationship"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DIRECT"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_input"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INDIVIDUAL"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"personal_details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"family_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Person"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"given_names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"Example"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"dob"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-10-26"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"nationality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"address_history"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STRUCTURED"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"locality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"London"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"postal_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"E1 1AA"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"route"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Crown Street"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"street_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
          </span><span class="s2">"original_freeform_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42 Crown Street, London, E1 1AA"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-10"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"require_dob"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The payload of the request can contain the following fields:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        Every check instruction will contain a unique ID which can be used to
        track and identify individual requests without needing to use other
        information in the request.
      </td>
    </tr>
    <tr>
      <td><code>demo_result</code></td>
      <td>
        One of the <a href="#demo-result-types">specified demo result types</a>
      </td>
      <td>No</td>
      <td>
        If this field is present, the check must be considered a demo check
        and you should respond with appropriate demo data. See the
        <a href="#demo-checks">Demo Checks section</a> for more information.
      </td>
    </tr>
    <tr>
      <td><code>commercial_relationship</code></td>
      <td>One of <code>"DIRECT"</code>, <code>"PASSFORT"</code></td>
      <td>Yes</td>
      <td>
        Specified whether the check is for a customer with a direct
        relationship with your integration's data provider, or if they're
        using the check through Passfort's pay-as-you-go reselling scheme.
      </td>
    </tr>
    <tr>
      <td><code>check_input</code></td>
      <td>An IndividualData object</td>
      <td>Yes</td>
      <td>
        This field contains the profile information for the individual on which the
        Identity check is run. See the
        <a href="#check-input">PassFort Data Structure check input section</a>
        for more information on how profile data is structured within Passfort.
      </td>
    </tr>
    <tr>
      <td><code>provider_config</code></td>
      <td>A user-defined JSON object</td>
      <td>Yes</td>
      <td>
        This field contains the provider config structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-sync-identity-check">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option.
      </td>
    </tr>
    <tr>
      <td><code>provider_credentials</code></td>
      <td>A user-defined JSON object</td>
      <td>No</td>
      <td>
        This field contains the credentials structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-sync-identity-check">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option. <strong>This
        field is only sent if <code>commercial_relationship</code> is set to
        <code>"DIRECT"</code>.</strong>
      </td>
    </tr>
  </tbody>
</table>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">integration.testing</span> <span class="kn">import</span> <span class="n">create_demo_result</span>
<span class="kn">from</span> <span class="nn">integration.provider</span> <span class="kn">import</span> <span class="n">make_provider_request</span><span class="p">,</span> <span class="n">reseller_creds</span><span class="p">,</span> \
    <span class="n">to_passfort_field_types</span>
<span class="kn">from</span> <span class="nn">integration.errors</span> <span class="kn">import</span> <span class="n">ProviderError</span><span class="p">,</span> <span class="n">ConnectionError</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.post</span><span class="p">(</span><span class="s">'/checks'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run_check</span><span class="p">():</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>

    <span class="n">demo_result</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'demo_result'</span><span class="p">)</span>
    <span class="n">check_input</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'check_input'</span><span class="p">)</span>

    <span class="c"># Handle demo data scenarios</span>
    <span class="k">if</span> <span class="n">demo_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">create_demo_result</span><span class="p">(</span><span class="n">demo_result</span><span class="p">,</span> <span class="n">check_input</span><span class="p">))</span>

    <span class="n">commercial_rel</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'commercial_relationship'</span><span class="p">)</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">reseller_creds</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_config'</span><span class="p">)</span>

    <span class="c"># Use provided creds if check is through direct agreement</span>
    <span class="k">if</span> <span class="n">commercial_rel</span> <span class="o">==</span> <span class="s">'DIRECT'</span><span class="p">:</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_credentials'</span><span class="p">)</span>

    <span class="c"># Make call to provider</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">make_provider_request</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">check_input</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'check_output'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">'entity_type'</span><span class="p">:</span> <span class="s">'INDIVIDUAL'</span><span class="p">,</span>
                <span class="s">'address_history'</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s">'electronic_id_check'</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s">'matches'</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">({</span>
                            <span class="s">'count'</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">database</span><span class="o">.</span><span class="n">matched_records</span><span class="p">),</span>
                            <span class="s">'database_name'</span><span class="p">:</span> <span class="n">database</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="s">'database_type'</span><span class="p">:</span> 
                                <span class="s">'CIVIL'</span> <span class="k">if</span> <span class="n">database</span><span class="o">.</span><span class="n">is_voting_register</span> <span class="k">else</span> <span class="s">'CREDIT'</span><span class="p">,</span>
                            <span class="s">'matched_fields'</span><span class="p">:</span> 
                                <span class="n">to_passfort_field_types</span><span class="p">(</span><span class="n">database</span><span class="o">.</span><span class="n">matched_fields</span><span class="p">)</span>
                        <span class="p">})</span> <span class="k">for</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">matched_databases</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">'provider_data'</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_CONNECTION'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Failed to contact data provider: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ProviderError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_MESSAGE'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Provider error: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"express"</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">createDemoResult</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"./testing"</span><span class="p">);</span>
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">makeProviderRequest</span><span class="p">,</span>
  <span class="nx">RESELLER_CREDS</span><span class="p">,</span>
  <span class="nx">toPassfortFieldTypes</span><span class="p">,</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"./provider"</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">"/checks"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Handle demo data scenarios</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">demo_result</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span>
      <span class="nx">createDemoResult</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">demo_result</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">check_input</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Use provided creds if check is through direct agreement</span>
  <span class="kr">const</span> <span class="nx">credentials</span> <span class="o">=</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">commercial_relationship</span> <span class="o">===</span> <span class="s2">"DIRECT"</span>
      <span class="p">?</span> <span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">provider_credentials</span>
      <span class="p">:</span> <span class="nx">RESELLER_CREDS</span><span class="p">;</span>

  <span class="k">return</span> <span class="nx">makeProviderRequest</span><span class="p">(</span>
    <span class="nx">credentials</span><span class="p">,</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">provider_config</span><span class="p">,</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">check_input</span>
  <span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">checkResult</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">check_output</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">entity_type</span><span class="p">:</span> <span class="s2">"INDIVIDUAL"</span><span class="p">,</span>
          <span class="na">address_history</span><span class="p">:</span> <span class="p">[],</span>
          <span class="na">electronic_id_check</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">matches</span><span class="p">:</span> <span class="nx">checkResult</span><span class="p">.</span><span class="nx">matched_databases</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">database</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
              <span class="na">count</span><span class="p">:</span> <span class="nx">database</span><span class="p">.</span><span class="nx">matched_records</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
              <span class="na">database_name</span><span class="p">:</span> <span class="nx">database</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
              <span class="na">database_type</span><span class="p">:</span> <span class="nx">database</span><span class="p">.</span><span class="nx">is_voting_register</span> <span class="p">?</span> <span class="s2">"CIVIL"</span> <span class="p">:</span> <span class="s2">"CREDIT"</span><span class="p">,</span>
              <span class="na">matched_fields</span><span class="p">:</span> <span class="nx">toPassfortFieldTypes</span><span class="p">(</span><span class="nx">database</span><span class="p">.</span><span class="nx">matched_fields</span><span class="p">),</span>
            <span class="p">})),</span>
          <span class="p">},</span>
        <span class="p">},</span>
        <span class="na">errors</span><span class="p">:</span> <span class="p">[],</span>
        <span class="na">warnings</span><span class="p">:</span> <span class="p">[],</span>
        <span class="na">provider_data</span><span class="p">:</span> <span class="nx">checkResult</span><span class="p">.</span><span class="nx">data</span><span class="p">(),</span>
      <span class="p">});</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">"CONNECTION"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
          <span class="na">errors</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="s2">"PROVIDER_CONNECTION"</span><span class="p">,</span>
              <span class="na">error</span><span class="p">:</span> <span class="s2">"Failed to contact data provider: "</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">],</span>
          <span class="na">warnings</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
          <span class="na">errors</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="s2">"PROVIDER_MESSAGE"</span><span class="p">,</span>
              <span class="na">error</span><span class="p">:</span> <span class="s2">"Provider error: "</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">],</span>
          <span class="na">warnings</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre>
<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"check_output"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INDIVIDUAL"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"address_history"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"electronic_id_check"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"matches"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
          </span><span class="s2">"database_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Credit File from Lender A"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"database_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CREDIT"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"matched_fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"FORENAME"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"SURNAME"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"ADDRESS"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"DOB"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"IDENTITY_NUMBER"</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
          </span><span class="s2">"database_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Electoral Roll"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"database_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CIVIL"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"matched_fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"FORENAME"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"SURNAME"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"ADDRESS"</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"warnings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"provider_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='response-fields-2'>Response fields</h3>
<table id="check-response-fields">
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>check_output</code></td>
      <td>Object structured in <a href=#check_output>check_output</a> below</td>
      <td>If check did not error</td>
      <td>
        Indicates the result data for this check. See the
        <code>check_output</code> section for the full structure of
        this check. In the absence of a result, Passfort tries to
        interpret a result from the <code>check_output</code>.
      </td>
    </tr>
    <tr>
      <td><code>result</code></td>
      <td>A supported <a href="#result">result type</a></td>
      <td>Only when there is no <code>check_output</code></td>
      <td>
        Indicates the result of this check. If this is not empty,
        this is the result of the check in Passfort. The result 
        field should only be populated when the provider does not give enough 
        information to generate a suitable <code>check_output</code>, or if the user has 
        explicitly requested to use the raw provider result without 
        Passfort's interpretation.
      </td>
    </tr>
    <tr>
      <td><code>errors</code></td>
      <td>
        An array containing one or more
        <a href="#check-errors">Errors</a>
      </td>
      <td>No</td>
      <td>
        A list of errors that occurred while running this check. If this is
        provided and it's not empty, the result of this check is
        considered to be errored by Passfort, regardless of the other contents
        of this response.
      </td>
    </tr>
    <tr>
      <td><code>warnings</code></td>
      <td>
        An array containing one or more warnings
      </td>
      <td>No</td>
      <td>
        Essentially the same as <a href="#check-errors">errors</a>, except the
        <code>sub_type</code> and <code>data</code> fields aren't present, and
        providing warnings won't cause Passfort to consider the check
        as errored.
      </td>
    </tr>
    <tr>
      <td><code>provider_data</code></td>
      <td>
        Any valid JSON value
      </td>
      <td>No</td>
      <td>
        This should be the structured JSON data returned by the data provider
        or a conversion of the data provider's response to allow
        Passfort to investigate any issues that arise with your integration.
      </td>
    </tr>
    <tr>
      <td><code>charges</code></td>
      <td>
        An array containing one or more
        <a href="#check-charges">Charges</a>
      </td>
      <td>No</td>
      <td>
        A list of charges incurred while running this check. Charges may only
        be returned if both of these conditions are met:
        <ul>
          <li>No errors occur when the check is run.</li>
          <li>
            The check is resold by Passfort.
          </li>
        </ul>
        
        For demo checks, charges may be returned, but they won't be deducted
        from the institution's credit.
        
        If charges are returned, the total amount charged must be no greater
        than the maximum cost-per-check specified in the integration's
        configuration.
      </td>
    </tr>
  </tbody>
</table>
<h3 id='result'><code>result</code></h3>
<p>The result types currently supported are:
<table>
 <thead>
  <th>Result type</th>
  <th>Description</th>
</thead>
<tbody>
  <tr>
    <td><code>Pass</code></td>
    <td>
      The check was successful.
    </td>
  </tr>
  <tr>
    <td><code>Fail</code></td>
    <td>
      The check is not successful.
    </td>
  </tr>
  <tr>
    <td><code>Error</code></td>
    <td>The check returns an error.</td>
  </tr>
  </tr>
  <tr>
    <td><code>1+1</code></td>
    <td>Definition varies based on provider.</td>
  </tr>
    </tr>
  <tr>
  <td><code>2+2</code></td>
    <td>Definition varies based on provider.</td>
  </tr>
</tbody>
</table></p>
<h4 id='check_output'><code>check_output</code></h4>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>entity_type</code></td>
      <td>The value <code>"INDIVIDUAL"</code></td>
      <td>Yes</td>
      <td>
        The only supported entity type for Identity Checks
        is individuals.
      </td>
    </tr>
    <tr>
      <td><code>address_history</code></td>
      <td>
        An array containing the address history, structured as it is
        in <a href="#data-structure">the Passfort Partner API</a>.
      </td>
      <td>No</td>
      <td>
        If supported by the provider, should report the known addresses for
        this individual when matched.
      </td>
    </tr>
    <tr>
      <td><code>electronic_id_check</code></td>
      <td>
        Object structured in <a href=#electronic_id_check>electronic_id_check</a>
      </td>
      <td>Yes</td>
      <td>
        The resulting matches of an EKYC check.
      </td>
    </tr>
  </tbody>
</table>
<h3 id='electronic_id_check'><code>electronic_id_check</code></h3>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>matches</code></td>
      <td>An array containing one or more Identity Check matches</td>
      <td>Only when <code>result</code> is 
        not present in the <a href=#check-response-fields>Response</a></td>
      <td>
        See the Identity Check matches section below.
      </td>
    </tr>
    <tr>
      <td><code>provider_url</code></td>
      <td>string </td>
      <td>No</td>
      <td>
        A link to an external provider page containing metadata for the associated check.
      </td>
    </tr>
  </tbody>
</table>
<h4 id='identity-check-matches'>Identity Check matches</h4>
<p>Each object represents zero or more matches in a database returned by the
data provider.</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>count</code></td>
      <td>number</td>
      <td>Yes</td>
      <td>
        A non-negative integer representing the number of matched entries
        in this database. Databases without matches should be listed with
        a count of 0.
      </td>
    </tr>
    <tr>
      <td><code>database_name</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>The human readable name for the database this match comes from.</td>
    </tr>
    <tr>
      <td><code>database_type</code></td>
      <td>A supported database type</td>
      <td>Yes</td>
      <td>
        Describes the categorisation of the database, see the supported
        types listed below.
       </td>
    </tr>
    <tr>
      <td><code>matched_fields</code></td>
      <td>An array containing zero or more matched fields</td>
      <td>Yes</td>
      <td>
        Describes which fields were matched on in this database. See
        the list of matched field types supported below.
       </td>
    </tr>
  </tbody>
</table>

<p>The database types currently supported are:
<table>
 <thead>
  <th>Database type</th>
  <th>Description</th>
</thead>
<tbody>
  <tr>
    <td><code>CREDIT</code></td>
    <td>
      A credit scoring database or other similar lending
      activity database.
    </td>
  </tr>
  <tr>
    <td><code>CIVIL</code></td>
    <td>
      A government or organization maintained database or register of
      individuals, such as an electoral roll or telephone directory.
    </td>
  </tr>
  <tr>
    <td><code>MORTALITY</code></td>
    <td>A database or register of deceased individuals.</td>
  </tr>
</tbody>
</table></p>

<p>The matched fields currently supported are:
<table>
 <thead>
  <th>Field</th>
  <th>Description</th>
</thead>
<tbody>
  <tr>
    <td><code>FORENAME</code></td>
    <td>A match was found for the individual&#39;s given name(s).</td>
  </tr>
  <tr>
    <td><code>SURNAME</code></td>
    <td>A match was found for the individual&#39;s family name.</td>
  </tr>
  <tr>
    <td><code>ADDRESS</code></td>
    <td>A match was found for the provided address.</td>
  </tr>
  <tr>
    <td><code>DOB</code></td>
    <td>A match was found for the individual&#39;s Date of Birth.</td>
  </tr>
  <tr>
    <td><code>IDENTITY_NUMBER</code></td>
    <td>
      A match was found for the individual&#39;s government-issued identity
      number, commonly referred to as a National Identity Number or Social
      Security Number.
     </td>
  </tr>
  <tr>
    <td><code>IDENTITY_NUMBER_SUFFIX</code></td>
    <td>
      A match was found for a trailing portion of the individual&#39;s
      government-issued identity number.
     </td>
  </tr>
</tbody>
</table></p>

<aside class="warning">
    Requests made to this endpoint must be verified
   per the <a href="#authentication">authentication section</a>.
</aside>
<h1 id='one-time-sync-company-data'>One-time Sync Company Data</h1>
<p>This section lists all endpoints that must be implemented for a one-time synchronous company data check integration.</p>

<p>One-time synchronous company data checks are company data checks with the following behaviour:</p>

<p>* The check result will be returned directly upon request; the response won&#39;t be sent until the check is finished (synchronous)</p>

<p>* The check operates at a point-in-time: there is no ongoing monitoring of the check result (one-time)</p>
<h2 id='get-check-configuration-one-time-sync-company-data'>Get Check Configuration (One-time Sync Company Data)</h2>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.get</span><span class="p">(</span><span class="s">"/config"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_check_configuration</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s">"check_type"</span><span class="p">:</span> <span class="s">"COMPANY_DATA"</span><span class="p">,</span>
        <span class="s">"check_template"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"type"</span><span class="p">:</span> <span class="s">"ONE_TIME_SYNCHRONOUS"</span><span class="p">,</span>
            <span class="s">"timeout"</span><span class="p">:</span> <span class="mi">60</span>
        <span class="p">},</span>
        <span class="s">"pricing"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"supports_reselling"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s">"maximum_cost"</span><span class="p">:</span> <span class="mi">200</span>
        <span class="p">},</span>
        <span class="s">"supported_countries"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">"GBR"</span><span class="p">,</span>
            <span class="s">"USA"</span><span class="p">,</span>
            <span class="s">"CAN"</span><span class="p">,</span>
            <span class="s">"NLD"</span>
        <span class="p">],</span>
        <span class="s">"supported_features"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">"COMPANY_SEARCH"</span>
        <span class="p">],</span>
        <span class="s">"credentials"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span>
                    <span class="s">"name"</span><span class="p">:</span> <span class="s">"apikey"</span><span class="p">,</span>
                    <span class="s">"label"</span><span class="p">:</span> <span class="s">"API Key"</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s">"config"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="p">:</span> <span class="p">[</span>

            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">})</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/config'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">check_type</span><span class="p">:</span> <span class="s1">'COMPANY_DATA'</span><span class="p">,</span>
        <span class="na">check_template</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="s1">'ONE_TIME_SYNCHRONOUS'</span><span class="p">,</span>
            <span class="na">timeout</span><span class="p">:</span> <span class="mi">60</span>
        <span class="p">},</span>
        <span class="na">pricing</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">supports_reselling</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="na">maximum_cost</span><span class="p">:</span> <span class="mi">200</span>
        <span class="p">},</span>
        <span class="na">supported_countries</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'GBR'</span><span class="p">,</span>
            <span class="s1">'USA'</span><span class="p">,</span>
            <span class="s1">'CAN'</span><span class="p">,</span>
            <span class="s1">'NLD'</span>
        <span class="p">],</span>
        <span class="na">supported_features</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'COMPANY_SEARCH'</span>
        <span class="p">],</span>
        <span class="na">credentials</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">fields</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span>
                    <span class="na">name</span><span class="p">:</span> <span class="s1">'apikey'</span><span class="p">,</span>
                    <span class="na">label</span><span class="p">:</span> <span class="s1">'API Key'</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="na">config</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">fields</span><span class="p">:</span> <span class="p">[</span>

            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>

<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"check_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMPANY_DATA"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_template"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ONE_TIME_SYNCHRONOUS"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"timeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"pricing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"supports_reselling"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"maximum_cost"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"supported_countries"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"USA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"CAN"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"NLD"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"supported_features"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"COMPANY_SEARCH"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"apikey"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"API Key"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint specifies which configuration is used by Passfort to perform
one-time synchronous Company data checks using your integration.</p>
<h3 id='http-request'>HTTP Request</h3>
<p><code>GET https://my-integration.example.com/config</code></p>
<h3 id='response-fields'>Response fields</h3>
<p>Most configuration fields are already discussed in the <a href="#configuration">configuration
section</a>. Check specific options will be discussed here.</p>
<h4 id='check-type'>Check type</h4>
<p>The <code>check_type</code> field must be set to <code>&quot;COMPANY_DATA&quot;</code>.</p>
<h4 id='check-template'>Check template</h4>
<p>The <code>check_template</code> fields for this check are:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always Present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>type</code></td>
      <td>The value <code>"ONE_TIME_SYNCHRONOUS"</code></td>
      <td>Yes</td>
      <td>
        Which check template to use for this check. For one-time synchronous
        checks, you must specify <code>"ONE_TIME_SYNCHRONOUS"</code>.
      </td>
    </tr>
    <tr>
      <td><code>timeout</code></td>
      <td>number</td>
      <td>No</td>
      <td>
        The number of seconds Passfort should wait without a response before
        considering identity checks run through this integration to have
        timed out. Must be an integer. If not specified or set to
        <code>null</code>, a timeout of 60 seconds is used.
      </td>
    </tr>
  </tbody>
</table>

<aside class="warning">
    Requests made to this endpoint must be verified
   per the <a href="#authentication">authentication section</a>.
</aside>
<h2 id='run-one-time-sync-company-data-check'>Run One-Time Sync Company Data Check</h2>
<p>This endpoint exposes your data provider&#39;s Company data check to PassFort.</p>
<h3 id='http-request-2'>HTTP Request</h3>
<p><code>POST https://my-integration.example.com/checks</code></p>

<blockquote>
<p>A JSON payload following this structure will be sent to the endpoint:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01234567-89ab-cdef-0123-456789abcdef"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"demo_result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ANY"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"commercial_relationship"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DIRECT"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_input"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMPANY"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Co."</span><span class="p">,</span><span class="w">
      </span><span class="s2">"number"</span><span class="p">:</span><span class="w"> </span><span class="mi">123456</span><span class="p">,</span><span class="w">
      </span><span class="s2">"country_of_incorporation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"apikey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foobar"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The payload of the request can contain the following fields:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        Every check instruction will contain a unique ID which can be used to
        track and identify individual requests without needing to use other
        information in the request.
      </td>
    </tr>
    <tr>
      <td><code>demo_result</code></td>
      <td>
        One of the <a href="#demo-result-types">specified demo result types</a>
      </td>
      <td>No</td>
      <td>
        If this field is present, the check must be considered a demo check
        and you should respond with appropriate demo data. See the
        <a href="#demo-checks">Demo Checks section</a> for more information.
      </td>
    </tr>
    <tr>
      <td><code>commercial_relationship</code></td>
      <td>One of <code>"DIRECT"</code>, <code>"PASSFORT"</code></td>
      <td>Yes</td>
      <td>
        Specified whether the check is for a customer with a direct
        relationship with your integration's data provider, or if they're
        using the check through Passfort's pay-as-you-go reselling scheme.
      </td>
    </tr>
    <tr>
      <td><code>check_input</code></td>
      <td>A CompanyData object</td>
      <td>Yes</td>
      <td>
        This field contains the profile information for the company on which the
        Company data check is run. See the
        <a href="#check-input">PassFort Data Structure check input section</a>
        for more information on how profile data is structured within Passfort.
      </td>
    </tr>
    <tr>
      <td><code>provider_config</code></td>
      <td>A user-defined JSON object</td>
      <td>Yes</td>
      <td>
        This field contains the provider config structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-sync-company-data">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option.
      </td>
    </tr>
    <tr>
      <td><code>provider_credentials</code></td>
      <td>A user-defined JSON object</td>
      <td>No</td>
      <td>
        This field contains the credentials structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-sync-company-data">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option. <strong>This
        field is only sent if <code>commercial_relationship</code> is set to
        <code>"DIRECT"</code>.</strong>
      </td>
    </tr>
  </tbody>
</table>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">integration.testing</span> <span class="kn">import</span> <span class="n">create_demo_result</span>
<span class="kn">from</span> <span class="nn">integration.provider</span> <span class="kn">import</span> <span class="n">make_provider_request</span><span class="p">,</span> <span class="n">reseller_creds</span><span class="p">,</span> \
    <span class="n">extract_passfort_metadata</span>
<span class="kn">from</span> <span class="nn">integration.errors</span> <span class="kn">import</span> <span class="n">ProviderError</span><span class="p">,</span> <span class="n">ConnectionError</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.post</span><span class="p">(</span><span class="s">'/checks'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run_check</span><span class="p">():</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>

    <span class="n">demo_result</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'demo_result'</span><span class="p">)</span>
    <span class="n">check_input</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'check_input'</span><span class="p">)</span>

    <span class="c"># Handle demo data scenarios</span>
    <span class="k">if</span> <span class="n">demo_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">create_demo_result</span><span class="p">(</span><span class="n">demo_result</span><span class="p">,</span> <span class="n">check_input</span><span class="p">))</span>

    <span class="n">commercial_rel</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'commercial_relationship'</span><span class="p">)</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">reseller_creds</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_config'</span><span class="p">)</span>

    <span class="c"># Use provided creds if check is through direct agreement</span>
    <span class="k">if</span> <span class="n">commercial_rel</span> <span class="o">==</span> <span class="s">'DIRECT'</span><span class="p">:</span>
      <span class="n">credentials</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_credentials'</span><span class="p">)</span>

    <span class="c"># Make call to provider</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">make_provider_request</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">check_input</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'check_output'</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">'enitity_type'</span><span class="p">:</span> <span class="s">'COMPANY'</span><span class="p">,</span> 
                <span class="s">'metadata'</span><span class="p">:</span> <span class="n">extract_passfort_metadata</span><span class="p">(</span><span class="n">result</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">'provider_data'</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_CONNECTION'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Failed to contact data provider: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ProviderError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_MESSAGE'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Provider error: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"express"</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">createDemoResult</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"./testing"</span><span class="p">);</span>
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">makeProviderRequest</span><span class="p">,</span>
  <span class="nx">RESELLER_CREDS</span><span class="p">,</span>
  <span class="nx">extractPassFortMetadata</span><span class="p">,</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"./provider"</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">"/checks"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Handle demo data scenarios</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">demo_result</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span>
      <span class="nx">createDemoResult</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">demo_result</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">check_input</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Use provided creds if check is through direct agreement</span>
  <span class="kr">const</span> <span class="nx">credentials</span> <span class="o">=</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">commercial_relationship</span> <span class="o">===</span> <span class="s2">"DIRECT"</span>
      <span class="p">?</span> <span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">provider_credentials</span>
      <span class="p">:</span> <span class="nx">RESELLER_CREDS</span><span class="p">;</span>

  <span class="k">return</span> <span class="nx">makeProviderRequest</span><span class="p">(</span>
    <span class="nx">credentials</span><span class="p">,</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">provider_config</span><span class="p">,</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">check_input</span>
  <span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">checkResult</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">check_output</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">entity_type</span><span class="p">:</span> <span class="s2">"COMPANY"</span><span class="p">,</span>
          <span class="na">metadata</span><span class="p">:</span> <span class="nx">extractPassFortMetadata</span><span class="p">(</span><span class="nx">checkResult</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="na">errors</span><span class="p">:</span> <span class="p">[],</span>
        <span class="na">warnings</span><span class="p">:</span> <span class="p">[],</span>
        <span class="na">provider_data</span><span class="p">:</span> <span class="nx">checkResult</span><span class="p">.</span><span class="nx">data</span><span class="p">(),</span>
      <span class="p">});</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">"CONNECTION"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
          <span class="na">errors</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="s2">"PROVIDER_CONNECTION"</span><span class="p">,</span>
              <span class="na">error</span><span class="p">:</span> <span class="s2">"Failed to contact data provider: "</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">],</span>
          <span class="na">warnings</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
          <span class="na">errors</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="s2">"PROVIDER_MESSAGE"</span><span class="p">,</span>
              <span class="na">error</span><span class="p">:</span> <span class="s2">"Provider error: "</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">],</span>
          <span class="na">warnings</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre>
<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"provider_data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Demo result. Did not make request to provider."</span><span class="p">,</span><span class="w">
  </span><span class="s2">"warnings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"check_output"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMPANY"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"trade_description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Business and domestic software development"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"tax_ids"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"structured_company_type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"ownership_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMPANY"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"is_public"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="s2">"is_limited"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"previous_names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0123456"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Co."</span><span class="p">,</span><span class="w">
      </span><span class="s2">"is_active_details"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Active"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"is_active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="s2">"industry_classifications"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Computer programming, data processing, and other computer related services"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"737"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"classification_version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US SIC"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"classification_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SIC"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Computer programming activities"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6201"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"classification_version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NACE Rev. 2"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"classification_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NACE"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Computer Systems Design and Related Services"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5415"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"classification_version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NAICS 2017"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"classification_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NAICS"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"country_of_incorporation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"contact_information"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"www.example.co"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"info@example.co"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"company_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Private limited companies"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"addresses"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='response-fields-2'>Response fields</h3>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>check_output</code></td>
      <td>Object structured per <code>check_output</code> below</td>
      <td>If check did not error</td>
      <td>
        Indicates the result data for this check. See the
        <code>check_output</code> section for the full structure of
        this check.
      </td>
    </tr>
    <tr>
      <td><code>errors</code></td>
      <td>
        An array containing one or more
        <a href="#check-errors">Errors</a>
      </td>
      <td>No</td>
      <td>
        A list of errors that occurred while running this check. If this is
        provided and it's not empty, the result of this check is
        considered to be errored by Passfort, regardless of the other contents
        of this response.
      </td>
    </tr>
    <tr>
      <td><code>warnings</code></td>
      <td>
        An array containing one or more warnings
      </td>
      <td>No</td>
      <td>
        Essentially the same as <a href="#check-errors">errors</a>, except the
        <code>sub_type</code> and <code>data</code> fields aren't present, and
        providing warnings won't cause Passfort to consider the check
        as errored.
      </td>
    </tr>
    <tr>
      <td><code>provider_data</code></td>
      <td>
        Any valid JSON value
      </td>
      <td>No</td>
      <td>
        This should be the structured JSON data returned by the data provider
        or a conversion of the data provider's response to allow
        Passfort to investigate any issues that arise with your integration.
      </td>
    </tr>
    <tr>
      <td><code>charges</code></td>
      <td>
        An array containing one or more
        <a href="#check-charges">Charges</a>
      </td>
      <td>No</td>
      <td>
        A list of charges incurred while running this check. Charges may only
        be returned if both of these conditions are met:
        <ul>
          <li>No errors occur when the check is run.</li>
          <li>
            The check is resold by Passfort.
          </li>
        </ul>
        
        For demo checks, charges may be returned, but they won't be deducted
        from the institution's credit.
        
        If charges are returned, the total amount charged must be no greater
        than the maximum cost-per-check specified in the integration's
        configuration.
      </td>
    </tr>
  </tbody>
</table>
<h4 id='check_output'><code>check_output</code></h4>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>entity_type</code></td>
      <td>The value <code>"COMPANY"</code></td>
      <td>Yes</td>
      <td>
        The only supported entity type for Company Data Checks
        is company.
      </td>
    </tr>
    <tr>
      <td><code>metadata</code></td>
      <td>
        An object containing the registry data, structured as it is
        in <a href="#data-structure">the Passfort Partner API</a>.
      </td>
      <td>If a match was found by the provider</td>
      <td>As best as possible, all fields you support should be made to populate all fields supported by the provider</td>
    </tr>
    <tr>
      <td><code>field_checks</code></td>
      <td>An array of <code>CompanyFieldCheck</code> objects</td>
      <td>No</td>
      <td>
        This field is used to surface company fields which have been marked as a match or mismatch
        between the provider's data and the input data sent to your integration. This field is only
        used if the <a href="#provider-field-checks">Provider Field Checks</a> feature
        is in use.
      </td>
    </tr>
  </tbody>
</table>
<h1 id='one-time-callback-document-verification'>One-time Callback Document Verification</h1>
<p>This section lists all endpoints that must be implemented for a one-time
callback document verification integration.</p>

<p>One-time callback checks are checks with the following
behaviour:</p>

<ul>
<li><p>The initial &quot;start check&quot; request will return immediately, indicating
that the check is in progress.</p></li>
<li><p>When the check is complete, a request will be set from the integration
to Passfort&#39;s &quot;callback&quot; endpoint.</p></li>
<li><p>Upon receiving the callback, Passfort sends a final request to the
integration to complete the check and fetch the result.</p></li>
<li><p>The check operates at a point-in-time: there is no ongoing monitoring
of the check result (one-time).</p></li>
</ul>
<h2 id='get-check-configuration-one-time-callback-document-verification'>Get Check Configuration (One-time Callback Document Verification)</h2>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.get</span><span class="p">(</span><span class="s">"/config"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_check_configuration</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s">"check_type"</span><span class="p">:</span> <span class="s">"DOCUMENT_VERIFICATION"</span><span class="p">,</span>
        <span class="s">"check_template"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"type"</span><span class="p">:</span> <span class="s">"ONE_TIME_CALLBACK"</span><span class="p">,</span>
            <span class="s">"request_timeout"</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
            <span class="s">"callback_timeout"</span><span class="p">:</span> <span class="mi">15</span>
        <span class="p">},</span>
        <span class="s">"pricing"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"supports_reselling"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s">"maximum_cost"</span><span class="p">:</span> <span class="mi">200</span>
        <span class="p">},</span>
        <span class="s">"supported_countries"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">"GBR"</span><span class="p">,</span>
            <span class="s">"USA"</span><span class="p">,</span>
            <span class="s">"CAN"</span>
        <span class="p">],</span>
        <span class="s">"credentials"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span>
                    <span class="s">"name"</span><span class="p">:</span> <span class="s">"username"</span><span class="p">,</span>
                    <span class="s">"label"</span><span class="p">:</span> <span class="s">"Username"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"password"</span><span class="p">,</span>
                    <span class="s">"name"</span><span class="p">:</span> <span class="s">"password"</span><span class="p">,</span>
                    <span class="s">"label"</span><span class="p">:</span> <span class="s">"Password"</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s">"config"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"boolean"</span><span class="p">,</span>
                    <span class="s">"name"</span><span class="p">:</span> <span class="s">"enhanced_verification"</span><span class="p">,</span>
                    <span class="s">"label"</span><span class="p">:</span> <span class="s">"Enable Enhanced Verification"</span><span class="p">,</span>
                    <span class="s">"subtext"</span><span class="p">:</span> <span class="s">"Fall back to a manual process when a document cannot be automatically verified."</span><span class="p">,</span>
                    <span class="s">"default"</span><span class="p">:</span> <span class="bp">False</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">})</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/config'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">check_type</span><span class="p">:</span> <span class="s1">'DOCUMENT_VERIFICATION'</span><span class="p">,</span>
        <span class="na">check_template</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="s1">'ONE_TIME_CALLBACK'</span><span class="p">,</span>
            <span class="na">request_timeout</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
            <span class="na">callback_timeout</span><span class="p">:</span> <span class="mi">15</span>
        <span class="p">},</span>
        <span class="na">pricing</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">supports_reselling</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="na">maximum_cost</span><span class="p">:</span> <span class="mi">200</span>
        <span class="p">},</span>
        <span class="na">supported_countries</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'GBR'</span><span class="p">,</span>
            <span class="s1">'USA'</span><span class="p">,</span>
            <span class="s1">'CAN'</span>
        <span class="p">],</span>
        <span class="na">credentials</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">fields</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span>
                    <span class="na">name</span><span class="p">:</span> <span class="s1">'username'</span><span class="p">,</span>
                    <span class="na">label</span><span class="p">:</span> <span class="s1">'Username'</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span> <span class="s1">'password'</span><span class="p">,</span>
                    <span class="na">name</span><span class="p">:</span> <span class="s1">'password'</span><span class="p">,</span>
                    <span class="na">label</span><span class="p">:</span> <span class="s1">'Password'</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="na">config</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">fields</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span> <span class="s1">'boolean'</span><span class="p">,</span>
                    <span class="na">name</span><span class="p">:</span> <span class="s1">'enhanced_verification'</span><span class="p">,</span>
                    <span class="na">label</span><span class="p">:</span> <span class="s1">'Enable Enhanced Verification'</span><span class="p">,</span>
                    <span class="na">subtext</span><span class="p">:</span> <span class="s1">'Fall back to a manual process when a document cannot be automatically verified.'</span><span class="p">,</span>
                    <span class="na">default</span><span class="p">:</span> <span class="kc">false</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>

<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"check_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DOCUMENT_VERIFICATION"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_template"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ONE_TIME_CALLBACK"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"request_timeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
    </span><span class="s2">"callback_timeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"pricing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"supports_reselling"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"maximum_cost"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"supported_countries"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"USA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"CAN"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"username"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Username"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"boolean"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enhanced_verification"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enable Enhanced Verification"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"subtext"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Fall back to a manual process when a document cannot be automatically verified."</span><span class="p">,</span><span class="w">
        </span><span class="s2">"default"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint specifies which configuration is used by Passfort to perform
one-time callback-based document verifications using your integration.</p>
<h3 id='http-request'>HTTP Request</h3>
<p><code>GET https://my-integration.example.com/config</code></p>
<h3 id='response-fields'>Response fields</h3>
<p>Most configuration fields are already discussed in the <a href="#configuration">configuration
section</a>. Check specific options will be discussed here.</p>
<h4 id='check-type'>Check type</h4>
<p>The <code>check_type</code> field must be set to <code>&quot;DOCUMENT_VERIFICATION&quot;</code>.</p>
<h4 id='check-template'>Check template</h4>
<p>The <code>check_template</code> fields for this check are:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>type</code></td>
      <td>The value <code>"ONE_TIME_CALLBACK"</code></td>
      <td>Yes</td>
      <td>
        Which check template to use for this check. For one-time callback
        checks, you must specify <code>"ONE_TIME_CALLBACK"</code>.
      </td>
    </tr>
    <tr>
      <td><code>request_timeout</code></td>
      <td>number</td>
      <td>No</td>
      <td>
        The number of seconds Passfort should wait without a response before
        considering Document verification checks run through this integration to have
        timed out. Must be an integer. If not specified or set to
        <code>null</code>, a timeout of 60 seconds is used. This timeout
        will also be applied to image downloads.
      </td>
    </tr>
    </tr>
    <tr>
      <td><code>callback_timeout</code></td>
      <td>number</td>
      <td>No</td>
      <td>
        The number of seconds Passfort should wait following a callback without 
        a response before considering Document fetch checks run through this integration 
        to have timed out. Must be an integer. If not specified or set to
        <code>null</code>, a timeout of 60 seconds is used. This timeout
        will also be applied to image downloads.
      </td>
    </tr>
  </tbody>
</table>

<aside class="warning">
    Requests made to this endpoint must be verified
   per the <a href="#authentication">authentication section</a>.
</aside>
<h2 id='start-one-time-callback-document-verification'>Start One-Time Callback Document Verification</h2>
<p>This endpoint is used by Passfort to initiate a Document verification check through
your integration.</p>
<h3 id='http-request-2'>HTTP Request</h3>
<p><code>POST https://my-integration.example.com/checks</code></p>

<blockquote>
<p>A JSON payload following this structure will be sent to the endpoint:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01234567-89ab-cdef-0123-456789abcdef"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"demo_result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ANY"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"commercial_relationship"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DIRECT"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_input"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INDIVIDUAL"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"personal_details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"family_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Person"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"given_names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"Example"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"dob"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-10-26"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"nationality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"address_history"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STRUCTURED"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"locality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"London"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"postal_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"E1 1AA"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"route"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Crown Street"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"street_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
          </span><span class="s2">"original_freeform_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42 Crown Street, London, E1 1AA"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-10"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"documents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"17bb8473-1466-466e-b651-2de39df7c148"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PROOF_OF_IDENTITY"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"document_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASSPORT"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"images"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2a7933f3-c4a2-49f3-883b-946c33d28b26"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"image_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FRONT"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"enhanced_verification"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The payload of the request can contain the following fields:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        Every check instruction will contain a unique ID which can be used to
        track and identify individual requests without needing to use other
        information in the request.
      </td>
    </tr>
    <tr>
      <td><code>demo_result</code></td>
      <td>
        One of the <a href="#demo-result-types">specified demo result types</a>
      </td>
      <td>No</td>
      <td>
        If this field is present, the check must be considered a demo check
        and you should respond with appropriate demo data. See the
        <a href="#demo-checks">Demo Checks section</a> for more information.
      </td>
    </tr>
    <tr>
      <td><code>commercial_relationship</code></td>
      <td>One of <code>"DIRECT"</code>, <code>"PASSFORT"</code></td>
      <td>Yes</td>
      <td>
        Specified whether the check is for a customer with a direct
        relationship with your integration's data provider, or if they're
        using the check through Passfort's pay-as-you-go reselling scheme.
      </td>
    </tr>
    <tr>
      <td><code>check_input</code></td>
      <td>An IndividualData object</td>
      <td>Yes</td>
      <td>
        This field contains the profile information for the individual on which the
        Document verification check is run. See the
        <a href="#check-input">PassFort Data Structure check input section</a>
        for more information on how profile data is structured within Passfort.
      </td>
    </tr>
    <tr>
      <td><code>provider_config</code></td>
      <td>A user-defined JSON object</td>
      <td>Yes</td>
      <td>
        This field contains the provider config structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-callback-document-verification">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option.
      </td>
    </tr>
    <tr>
      <td><code>provider_credentials</code></td>
      <td>A user-defined JSON object</td>
      <td>No</td>
      <td>
        This field contains the credentials structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-callback-document-verification">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option. <strong>This
        field is only sent if <code>commercial_relationship</code> is set to
        <code>"DIRECT"</code>.</strong>
      </td>
    </tr>
  </tbody>
</table>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">integration.testing</span> <span class="kn">import</span> <span class="n">create_demo_result</span>
<span class="kn">from</span> <span class="nn">integration.provider</span> <span class="kn">import</span> <span class="n">make_provider_request</span><span class="p">,</span> <span class="n">reseller_creds</span><span class="p">,</span> \
    <span class="n">to_passfort_field_types</span>
<span class="kn">from</span> <span class="nn">integration.errors</span> <span class="kn">import</span> <span class="n">ProviderError</span><span class="p">,</span> <span class="n">ConnectionError</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.post</span><span class="p">(</span><span class="s">"/checks"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run_check</span><span class="p">():</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>

    <span class="n">demo_result</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'demo_result'</span><span class="p">)</span>
    <span class="n">check_input</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'check_input'</span><span class="p">)</span>

    <span class="c"># Handle demo data scenarios</span>
    <span class="k">if</span> <span class="n">demo_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">create_demo_result</span><span class="p">(</span><span class="n">demo_result</span><span class="p">,</span> <span class="n">check_input</span><span class="p">))</span>

    <span class="n">commercial_rel</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'commercial_relationship'</span><span class="p">)</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">reseller_creds</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_config'</span><span class="p">)</span>

    <span class="c"># Use provided creds if check is through direct agreement</span>
    <span class="k">if</span> <span class="n">commercial_rel</span> <span class="o">==</span> <span class="s">'DIRECT'</span><span class="p">:</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_credentials'</span><span class="p">)</span>

    <span class="c"># Make call to provider</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">make_provider_request</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">check_input</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'provider_id'</span><span class="p">:</span> <span class="n">CONST_PROVIDER_UUID</span><span class="p">,</span>
            <span class="s">'reference'</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s">'reference'</span><span class="p">],</span>
            <span class="s">'custom_data'</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_CONNECTION'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Failed to contact data provider: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ProviderError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_MESSAGE'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Provider error: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
</code></pre>
<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b0b7611e-c024-4ffb-9f9f-928992bec445"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"custom_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"my_field"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"warnings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='response-fields-2'>Response fields</h3>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>provider_id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        Unique identifier for the provider. The <code>reference</code> field should uniquely identify
        a check when combined with the <code>provider_id</code.
      </td>
    </tr>
    <tr>
      <td><code>reference</code></td>
      <td>string</td>
      <td>If no errors occurred</td>
      <td>
        An opaque string which identifies this check to the provider. No two checks from
        the same provider should have the same reference.
      </td>
    </tr>
    <tr>
      <td><code>custom_data</code></td>
      <td>object</td>
      <td>No</td>
      <td>
        Use this to store any state required by later requests relating to this check.
        The intent is for your integration to be completely stateless itself, to make
        it simpler to deploy and maintain.
        Note: if present, this *must* be an object, rather than an array or other JSON
        value. However, the keys and values in this object can be anything you like, although
        we don't recommend storing large amounts of data here, as it will be passed in on
        every following request to your integration relating to this check.
      </td>
    </tr>
    <tr>
      <td><code>errors</code></td>
      <td>
        An array containing one or more
        <a href="#check-errors">Errors</a>
      </td>
      <td>No</td>
      <td>
        A list of errors that occurred while running this check. If this is
        provided and it's not empty, the result of this check is
        considered to be errored by Passfort, regardless of the other contents
        of this response.
        If an error is returned from this endpoint, no callback will be expected.
      </td>
    </tr>
    <tr>
      <td><code>warnings</code></td>
      <td>
        An array containing one or more warnings
      </td>
      <td>No</td>
      <td>
        Essentially the same as <a href="#check-errors">errors</a>, except the
        <code>sub_type</code> and <code>data</code> fields aren't present, and
        providing warnings won't cause Passfort to consider the check
        as errored.
      </td>
    </tr>
    <tr>
      <td><code>provider_data</code></td>
      <td>
        Any valid JSON value
      </td>
      <td>No</td>
      <td>
        This should be the structured JSON data returned by the data provider
        or a conversion of the data provider's response to allow
        Passfort to investigate any issues that arise with your integration.
      </td>
    </tr>
  </tbody>
</table>

<aside class="warning">
    Requests made to this endpoint must be verified
   per the <a href="#authentication">authentication section</a>.
</aside>
<h2 id='ready-for-callback'>Ready for Callback</h2>
<p>This endpoint is used by Passfort to indicate that it is ready to receive callbacks
from your integration.</p>

<p>For demo checks, the callback should be sent synchronously when this request is
received, and should generate a reference that won&#39;t conflict with live checks.</p>
<h3 id='http-request-3'>HTTP Request</h3>
<p><code>POST https://my-integration.example.com/checks/{check_id}/ready</code></p>

<blockquote>
<p>A JSON payload following this structure will be sent to the endpoint:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01234567-89ab-cdef-0123-456789abcdef"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"demo_result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ANY"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"commercial_relationship"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DIRECT"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_input"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INDIVIDUAL"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"personal_details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"family_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Person"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"given_names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"Example"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"dob"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-10-26"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"nationality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"external_refs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"generic"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PROVIDER_CHECK_REFERENCE"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"address_history"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STRUCTURED"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"locality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"London"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"postal_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"E1 1AA"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"route"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Crown Street"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"street_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
          </span><span class="s2">"original_freeform_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42 Crown Street, London, E1 1AA"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-10"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"documents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"17bb8473-1466-466e-b651-2de39df7c148"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PROOF_OF_IDENTITY"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"document_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UNKNOWN"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"enhanced_verification"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"16fd3691-40d2-4c74-a808-f4758f435e2d"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"custom_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"my_field"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The payload of the request can contain the following fields:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        Every check instruction will contain a unique ID which can be used to
        track and identify individual requests without needing to use other
        information in the request.
      </td>
    </tr>
    <tr>
      <td><code>demo_result</code></td>
      <td>
        One of the <a href="#demo-result-types">specified demo result types</a>
      </td>
      <td>No</td>
      <td>
        If this field is present, the check must be considered a demo check
        and you should respond with appropriate demo data. See the
        <a href="#demo-checks">Demo Checks section</a> for more information.
      </td>
    </tr>
    <tr>
      <td><code>commercial_relationship</code></td>
      <td>One of <code>"DIRECT"</code>, <code>"PASSFORT"</code></td>
      <td>Yes</td>
      <td>
        Specified whether the check is for a customer with a direct
        relationship with your integration's data provider, or if they're
        using the check through Passfort's pay-as-you-go reselling scheme.
      </td>
    </tr>
    <tr>
      <td><code>check_input</code></td>
      <td>An IndividualData object</td>
      <td>Yes</td>
      <td>
        <p/>
        This field contains the profile information for the individual on which the
        Document verification check is run. See the
        <a href="#check-input">Passfort Data Structure check input section</a>
        for more information on how profile data is structured within Passfort.
        <p/>
        For Document fetch checks, the check input contains a single "placeholder"
        document with no images attached.
        <p/>
        The integration should take this placeholder document and populate it with
        the result from the provider, including attaching any images that can be
        downloaded.
        <p/>
        Notably, the `id` and `category` fields from the placeholder document should
        be preserved unchanged, as these indicate how the document should be used
        within Passfort, for example, as a proof of address.
      </td>
    </tr>
    <tr>
      <td><code>provider_config</code></td>
      <td>A user-defined JSON object</td>
      <td>Yes</td>
      <td>
        This field contains the provider config structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-callback-document-verification">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option.
      </td>
    </tr>
    <tr>
      <td><code>provider_credentials</code></td>
      <td>A user-defined JSON object</td>
      <td>No</td>
      <td>
        This field contains the credentials structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-callback-document-verification">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option. <strong>This
        field is only sent if <code>commercial_relationship</code> is set to
        <code>"DIRECT"</code>.</strong>
      </td>
    </tr>
    <tr>
      <td><code>custom_data</code></td>
      <td>A user-defined JSON object</td>
      <td>No</td>
      <td>
            Any custom_data returned by your integration when the check was instructed
          will be provided here. 
      </td>
    </tr>
    <tr>
      <td><code>provider_id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        This matches the `provider_id` returned by your integration when the check was 
        instructed, and should also match the field with the same name sent to Passfort as
        part of the callback indicating that this check had completed.
      </td>
    </tr>
    <tr>
      <td><code>reference</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>
        This matches the `reference` returned by your integration when the check was
        instructed, and should also match the field with the same name sent to Passfort as 
        part of the callback indicating that this check had completed.
    </tr>
  </tbody>
</table>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">integration.testing</span> <span class="kn">import</span> <span class="n">create_demo_result</span>
<span class="kn">from</span> <span class="nn">integration.provider</span> <span class="kn">import</span> <span class="n">make_provider_request</span><span class="p">,</span> <span class="n">reseller_creds</span><span class="p">,</span> \
    <span class="n">to_passfort_field_types</span>
<span class="kn">from</span> <span class="nn">integration.errors</span> <span class="kn">import</span> <span class="n">ProviderError</span><span class="p">,</span> <span class="n">ConnectionError</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.post</span><span class="p">(</span><span class="s">"/checks/&lt;uuid:id&gt;/ready"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">acknowledge_ready</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>

    <span class="n">provider_id</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_id'</span><span class="p">)</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'reference'</span><span class="p">)</span>


    <span class="c"># Demo checks should send the callback synchronously</span>
    <span class="k">if</span> <span class="n">demo_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">send_callback</span><span class="p">(</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">custom_data</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>


    <span class="n">credentials</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'credentials'</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'config'</span><span class="p">)</span>
    <span class="n">check_input</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'check_input'</span><span class="p">)</span>

    <span class="c"># Check if provider result is ready</span>
    <span class="n">check_result</span> <span class="o">=</span> <span class="n">make_provider_request</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">check_input</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">check_result</span><span class="p">[</span><span class="s">'complete'</span><span class="p">]:</span>
      <span class="n">send_callback</span><span class="p">(</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">custom_data</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</code></pre><h3 id='response-fields-3'>Response fields</h3>
<p>This response is not required to return any content.</p>

<aside class="warning">
    Requests made to this endpoint must be verified
   per the <a href="#authentication">authentication section</a>.
</aside>
<h2 id='download-images'>Download images</h2>
<p>The document images for verification can be downloaded using the image IDs
included in the <code>images</code> array in the request payload.</p>

<p>More details can be found in the <a href="#download-image">download image section</a>. </p>
<h2 id='callback-request'>Callback Request</h2>
<p>Once the check is complete, the integration should send a callback request
to Passfort, notifying us of this event. More details can be found in the
<a href="#callbacks">callbacks section</a>.</p>

<p>There are no check-type-specific callback fields for document verification
checks.</p>

<p>For demo checks, the callback should be sent within a few seconds of the
check being started, and should generate a reference that won&#39;t conflict
with live checks.</p>
<h2 id='finish-one-time-callback-document-verification'>Finish One-Time Callback Document Verification</h2>
<p>This endpoint is called shortly after Passfort receives a callback from your
integration indicating that a previously instructed check has completed.</p>

<p>In response, your integration should return the result of the check.</p>
<h3 id='http-request-4'>HTTP Request</h3>
<p><code>POST https://my-integration.example.com/checks/{check_id}/complete</code></p>

<blockquote>
<p>A JSON payload following this structure will be sent to the endpoint:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01234567-89ab-cdef-0123-456789abcdef"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"commercial_relationship"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DIRECT"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"provider_config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"enhanced_verification"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b0b7611e-c024-4ffb-9f9f-928992bec445"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"custom_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"my_field"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The payload of the request can contain the following fields:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        This check ID will be the same as the one used to instruct the check.
      </td>
    </tr>
    <tr>
      <td><code>commercial_relationship</code></td>
      <td>One of <code>"DIRECT"</code>, <code>"PASSFORT"</code></td>
      <td>Yes</td>
      <td>
        Specified whether the check is for a customer with a direct
        relationship with your integration's data provider, or if they're
        using the check through Passfort's pay-as-you-go reselling scheme.
      </td>
    </tr>
    <tr>
      <td><code>provider_config</code></td>
      <td>A user-defined JSON object</td>
      <td>Yes</td>
      <td>
        This field contains the provider config structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-callback-document-verification">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option.
      </td>
    </tr>
    <tr>
      <td><code>provider_credentials</code></td>
      <td>A user-defined JSON object</td>
      <td>No</td>
      <td>
        This field contains the credentials structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-callback-document-verification">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option. <strong>This
        field is only sent if <code>commercial_relationship</code> is set to
        <code>"DIRECT"</code>.</strong>
      </td>
    </tr>
    <tr>
      <td><code>provider_id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        This matches the <code>provider_id</code> returned by your integration when the
        check was instructed, and also matches the field with the same name
        sent to Passfort as part of the callback indicating that this check
        had completed.
      </td>
    </tr>
    <tr>
      <td><code>reference</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>
        This matches the <code>reference</code> returned by your integration when the
        check was instructed, and also matches the field with the same name
        sent to Passfort as part of the callback indicating that this check
        had completed.
      </td>
    </tr>
    <tr>
      <td><code>custom_data</code></td>
      <td>object</td>
      <td>No</td>
      <td>
        Any <code>custom_data</code> returned by your integration when the check
        was instructed or supplied to the callback endpoint will be merged
        together and provided here. The merging rules will always prioritise
        newer data when fields have the same name.
      </td>
    </tr>
  </tbody>
</table>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">integration.testing</span> <span class="kn">import</span> <span class="n">create_demo_result</span>
<span class="kn">from</span> <span class="nn">integration.provider</span> <span class="kn">import</span> <span class="n">make_provider_request</span><span class="p">,</span> <span class="n">reseller_creds</span><span class="p">,</span> \
    <span class="n">to_passfort_field_types</span>
<span class="kn">from</span> <span class="nn">integration.errors</span> <span class="kn">import</span> <span class="n">ProviderError</span><span class="p">,</span> <span class="n">ConnectionError</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.post</span><span class="p">(</span><span class="s">"/checks/&lt;uuid:id&gt;/complete"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">complete_check</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>

    <span class="n">commercial_rel</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'commercial_relationship'</span><span class="p">)</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">reseller_creds</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_config'</span><span class="p">)</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'reference'</span><span class="p">)</span>

    <span class="c"># Use provided creds if check is through direct agreement</span>
    <span class="k">if</span> <span class="n">commercial_rel</span> <span class="o">==</span> <span class="s">'DIRECT'</span><span class="p">:</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_credentials'</span><span class="p">)</span>

    <span class="c"># Make call to provider</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">fetch_check_result</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">convert_to_passfort_format</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_CONNECTION'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Failed to contact data provider: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ProviderError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_MESSAGE'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Provider error: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
</code></pre>
<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"check_output"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INDIVIDUAL"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"documents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"17bb8473-1466-466e-b651-2de39df7c148"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PROOF_OF_IDENTITY"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"document_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASSPORT"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"images"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2a7933f3-c4a2-49f3-883b-946c33d28b26"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"image_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FRONT"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"extracted_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"address_history"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

          </span><span class="p">],</span><span class="w">
          </span><span class="s2">"expiry"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2030-01-01"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"issued"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"United Kingdom"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"issuing_country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"mrz1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"P&lt;GBRPERSON&lt;&lt;EXAMPLE&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"mrz2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9040604586GBR8510264M3001019&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;06"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"904060458"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"personal_details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"family_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Person"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"given_names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"Example"</span><span class="w">
              </span><span class="p">]</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"dob"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-10-26"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"nationality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"verification_result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"all_passed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="s2">"image_checks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Image Quality"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Image resolution"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASS"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Image Quality"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Image sharpness"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASS"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="s2">"image_checks_passed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="s2">"forgery_checks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Document Fonts"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Title uses correct font"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASS"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Checksum"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MRZ has a valid checksum"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASS"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="s2">"forgery_checks_passed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="s2">"document_type_passed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"warnings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"provider_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='response-fields-4'>Response fields</h3>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>check_output</code></td>
      <td>Object structured per <code>check_output</code> below</td>
      <td>If check did not error</td>
      <td>
        Indicates the result data for this check. See the
        <code>check_output</code> section for the full structure of
        this check.
      </td>
    </tr>
    <tr>
      <td><code>errors</code></td>
      <td>
        An array containing one or more
        <a href="#check-errors">Errors</a>
      </td>
      <td>No</td>
      <td>
        A list of errors that occurred while running this check. If this is
        provided and it's not empty, the result of this check is
        considered to be errored by Passfort, regardless of the other contents
        of this response.
      </td>
    </tr>
    <tr>
      <td><code>warnings</code></td>
      <td>
        An array containing one or more warnings
      </td>
      <td>No</td>
      <td>
        Essentially the same as <a href="#check-errors">errors</a>, except the
        <code>sub_type</code> and <code>data</code> fields aren't present, and
        providing warnings won't cause Passfort to consider the check
        as errored.
      </td>
    </tr>
    <tr>
      <td><code>provider_data</code></td>
      <td>
        Any valid JSON value
      </td>
      <td>No</td>
      <td>
        This should be the structured JSON data returned by the data provider
        or a conversion of the data provider's response to allow
        Passfort to investigate any issues that arise with your integration.
      </td>
    </tr>
    <tr>
      <td><code>charges</code></td>
      <td>
        An array containing one or more
        <a href="#check-charges">Charges</a>
      </td>
      <td>No</td>
      <td>
        A list of charges incurred while running this check. Charges may only
        be returned if both of these conditions are met:
        <ul>
          <li>No errors occur when the check is run.</li>
          <li>
            The check is resold by Passfort.
          </li>
        </ul>
        
        For demo checks, charges may be returned, but they won't be deducted
        from the institution's credit.
        
        If charges are returned, the total amount charged must be no greater
        than the maximum cost-per-check specified in the integration's
        configuration.
      </td>
    </tr>
  </tbody>
</table>

<aside class="info">
If the billing information isn't easily available from the final
request, the integration can use the `custom_data` field to pass that
information through to the point where it is needed.
</aside>
<h4 id='check_output'><code>check_output</code></h4>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>entity_type</code></td>
      <td>The value <code>"INDIVIDUAL"</code></td>
      <td>Yes</td>
      <td>
        The only supported entity type for Document verification checks
        is individuals.
      </td>
    </tr>
    <tr>
      <td><code>documents</code></td>
      <td>
        An array containing the documents, structured as it is
        in <a href="#data-structure">the Passfort Partner API</a>.
      </td>
      <td>If no errors occurred</td>
      <td>
        This should be a copy of the documents array supplied as the
        check input, but with the <code>extracted_data</code> and
        <code>verification_result</code> fields populated using the
        response from the provider.
      </td>
    </tr>
  </tbody>
</table>

<aside class="warning">
    Requests made to this endpoint must be verified
   per the <a href="#authentication">authentication section</a>.
</aside>
<h1 id='one-time-callback-document-fetch'>One-time Callback Document Fetch</h1>
<p>This section lists all endpoints that must be implemented for a one-time
callback Document fetch integration.</p>

<p>Document fetch integrations are a special variant of Document verification
checks where the customer seeks closer integration with additional
functionality the provider offers, such as an improved document
collection flow for mobile. In this integration, instead of downloading images
from Passfort and submitting them to the provider, the customer uploads the
images with the provider, and they&#39;re downloaded into Passfort through
your integration.</p>
<h2 id='get-check-configuration-one-time-callback-document-fetch'>Get Check Configuration (One-time Callback Document Fetch)</h2>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.get</span><span class="p">(</span><span class="s">"/config"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_check_configuration</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s">"check_type"</span><span class="p">:</span> <span class="s">"DOCUMENT_FETCH"</span><span class="p">,</span>
        <span class="s">"check_template"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"type"</span><span class="p">:</span> <span class="s">"ONE_TIME_CALLBACK"</span><span class="p">,</span>
            <span class="s">"request_timeout"</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
            <span class="s">"callback_timeout"</span><span class="p">:</span> <span class="mi">15</span>
        <span class="p">},</span>
        <span class="s">"pricing"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"supports_reselling"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s">"maximum_cost"</span><span class="p">:</span> <span class="mi">200</span>
        <span class="p">},</span>
        <span class="s">"supported_countries"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">"GBR"</span><span class="p">,</span>
            <span class="s">"USA"</span><span class="p">,</span>
            <span class="s">"CAN"</span>
        <span class="p">],</span>
        <span class="s">"credentials"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span>
                    <span class="s">"name"</span><span class="p">:</span> <span class="s">"username"</span><span class="p">,</span>
                    <span class="s">"label"</span><span class="p">:</span> <span class="s">"Username"</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"password"</span><span class="p">,</span>
                    <span class="s">"name"</span><span class="p">:</span> <span class="s">"password"</span><span class="p">,</span>
                    <span class="s">"label"</span><span class="p">:</span> <span class="s">"Password"</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s">"config"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"boolean"</span><span class="p">,</span>
                    <span class="s">"name"</span><span class="p">:</span> <span class="s">"enhanced_verification"</span><span class="p">,</span>
                    <span class="s">"label"</span><span class="p">:</span> <span class="s">"Enable Enhanced Verification"</span><span class="p">,</span>
                    <span class="s">"subtext"</span><span class="p">:</span> <span class="s">"Fall back to a manual process when a document cannot be automatically verified."</span><span class="p">,</span>
                    <span class="s">"default"</span><span class="p">:</span> <span class="bp">False</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">})</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/config'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">check_type</span><span class="p">:</span> <span class="s1">'DOCUMENT_FETCH'</span><span class="p">,</span>
        <span class="na">check_template</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="s1">'ONE_TIME_CALLBACK'</span><span class="p">,</span>
            <span class="na">request_timeout</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
            <span class="na">callback_timeout</span><span class="p">:</span> <span class="mi">15</span>
        <span class="p">},</span>
        <span class="na">pricing</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">supports_reselling</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="na">maximum_cost</span><span class="p">:</span> <span class="mi">200</span>
        <span class="p">},</span>
        <span class="na">supported_countries</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'GBR'</span><span class="p">,</span>
            <span class="s1">'USA'</span><span class="p">,</span>
            <span class="s1">'CAN'</span>
        <span class="p">],</span>
        <span class="na">credentials</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">fields</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span>
                    <span class="na">name</span><span class="p">:</span> <span class="s1">'username'</span><span class="p">,</span>
                    <span class="na">label</span><span class="p">:</span> <span class="s1">'Username'</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span> <span class="s1">'password'</span><span class="p">,</span>
                    <span class="na">name</span><span class="p">:</span> <span class="s1">'password'</span><span class="p">,</span>
                    <span class="na">label</span><span class="p">:</span> <span class="s1">'Password'</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="na">config</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">fields</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span> <span class="s1">'boolean'</span><span class="p">,</span>
                    <span class="na">name</span><span class="p">:</span> <span class="s1">'enhanced_verification'</span><span class="p">,</span>
                    <span class="na">label</span><span class="p">:</span> <span class="s1">'Enable Enhanced Verification'</span><span class="p">,</span>
                    <span class="na">subtext</span><span class="p">:</span> <span class="s1">'Fall back to a manual process when a document cannot be automatically verified.'</span><span class="p">,</span>
                    <span class="na">default</span><span class="p">:</span> <span class="kc">false</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>

<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"check_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DOCUMENT_FETCH"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_template"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ONE_TIME_CALLBACK"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"request_timeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w">
    </span><span class="s2">"callback_timeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"pricing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"supports_reselling"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="s2">"maximum_cost"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"supported_countries"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"USA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"CAN"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"username"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Username"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"boolean"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"enhanced_verification"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enable Enhanced Verification"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"subtext"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Fall back to a manual process when a document cannot be automatically verified."</span><span class="p">,</span><span class="w">
        </span><span class="s2">"default"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint specifies which configuration is used by Passfort to perform
one-time callback-based Document fetch checks using your integration.</p>
<h3 id='http-request'>HTTP Request</h3>
<p><code>GET https://my-integration.example.com/config</code></p>
<h3 id='response-fields'>Response fields</h3>
<p>Most configuration fields are already discussed in the <a href="#configuration">configuration
section</a>. Check specific options will be discussed here.</p>
<h4 id='check-type'>Check type</h4>
<p>The <code>check_type</code> field must be set to <code>&quot;DOCUMENT_FETCH&quot;</code>.</p>
<h4 id='check-template'>Check template</h4>
<p>The <code>check_template</code> fields for this check are:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>type</code></td>
      <td>The value <code>"ONE_TIME_CALLBACK"</code></td>
      <td>Yes</td>
      <td>
        Which check template to use for this check. For one-time callback
        checks, you must specify <code>"ONE_TIME_CALLBACK"</code>.
      </td>
    </tr>
    <tr>
      <td><code>request_timeout</code></td>
      <td>number</td>
      <td>No</td>
      <td>
        The number of seconds Passfort should wait without a response before
        considering Document fetch checks run through this integration to have
        timed out. Must be an integer. If not specified or set to
        <code>null</code>, a timeout of 60 seconds is used. This timeout
        will also be applied to image downloads.
      </td>
    </tr>
    </tr>
    <tr>
      <td><code>callback_timeout</code></td>
      <td>number</td>
      <td>No</td>
      <td>
        The number of seconds Passfort should wait following a callback without 
        a response before considering Document fetch checks run through this integration 
        to have timed out. Must be an integer. If not specified or set to
        <code>null</code>, a timeout of 60 seconds is used. This timeout
        will also be applied to image downloads.
      </td>
    </tr>
  </tbody>
</table>

<aside class="warning">
    Requests made to this endpoint must be verified
   per the <a href="#authentication">authentication section</a>.
</aside>
<h2 id='start-one-time-callback-document-fetch'>Start One-Time Callback Document Fetch</h2>
<p>This endpoint is used by Passfort to initiate a document fetch check through
your integration. The important difference with Document verification is the
<code>external_refs</code> field on the input data, which contains a <code>generic</code> field
specifying the provider-specific token or reference identifying the request
made with the provider.</p>
<h3 id='http-request-2'>HTTP Request</h3>
<p><code>POST https://my-integration.example.com/checks</code></p>

<blockquote>
<p>A JSON payload following this structure will be sent to the endpoint:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01234567-89ab-cdef-0123-456789abcdef"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"demo_result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ANY"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"commercial_relationship"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DIRECT"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_input"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INDIVIDUAL"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"personal_details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"family_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Person"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"given_names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"Example"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"dob"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-10-26"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"nationality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"external_refs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"generic"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PROVIDER_CHECK_REFERENCE"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"address_history"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STRUCTURED"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"locality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"London"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"postal_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"E1 1AA"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"route"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Crown Street"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"street_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
          </span><span class="s2">"original_freeform_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42 Crown Street, London, E1 1AA"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-10"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"documents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"17bb8473-1466-466e-b651-2de39df7c148"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PROOF_OF_IDENTITY"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"document_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UNKNOWN"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"enhanced_verification"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The payload of the request can contain the following fields:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        Every check instruction will contain a unique ID which can be used to
        track and identify individual requests without needing to use other
        information in the request.
      </td>
    </tr>
    <tr>
      <td><code>demo_result</code></td>
      <td>
        One of the <a href="#demo-result-types">specified demo result types</a>
      </td>
      <td>No</td>
      <td>
        If this field is present, the check must be considered a demo check
        and you should respond with appropriate demo data. See the
        <a href="#demo-checks">Demo Checks section</a> for more information.
      </td>
    </tr>
    <tr>
      <td><code>commercial_relationship</code></td>
      <td>One of <code>"DIRECT"</code>, <code>"PASSFORT"</code></td>
      <td>Yes</td>
      <td>
        Specified whether the check is for a customer with a direct
        relationship with your integration's data provider, or if they're
        using the check through Passfort's pay-as-you-go reselling scheme.
      </td>
    </tr>
    <tr>
      <td><code>check_input</code></td>
      <td>An IndividualData object</td>
      <td>Yes</td>
      <td>
        <p/>
        This field contains the profile information for the individual on which the
        Document verification check is run. See the
        <a href="#check-input">PassFort Data Structure check input section</a>
        for more information on how profile data is structured within Passfort.
        <p/>
        For Document fetch checks, the check input contains a single "placeholder"
        document with no images attached.
        <p/>
        The integration should take this placeholder document and populate it with
        the result from the provider, including attaching any images that can be
        downloaded.
        <p/>
        Notably, the `id` and `category` fields from the placeholder document should
        be preserved unchanged, as these indicate how the document should be used
        within Passfort, for example, as a proof of address.
      </td>
    </tr>
    <tr>
      <td><code>provider_config</code></td>
      <td>A user-defined JSON object</td>
      <td>Yes</td>
      <td>
        This field contains the provider config structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-callback-document-verification">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option.
      </td>
    </tr>
    <tr>
      <td><code>provider_credentials</code></td>
      <td>A user-defined JSON object</td>
      <td>No</td>
      <td>
        This field contains the credentials structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-callback-document-verification">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option. <strong>This
        field is only sent if <code>commercial_relationship</code> is set to
        <code>"DIRECT"</code>.</strong>
      </td>
    </tr>
  </tbody>
</table>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">integration.testing</span> <span class="kn">import</span> <span class="n">create_demo_result</span>
<span class="kn">from</span> <span class="nn">integration.provider</span> <span class="kn">import</span> <span class="n">make_provider_request</span><span class="p">,</span> <span class="n">reseller_creds</span><span class="p">,</span> \
    <span class="n">to_passfort_field_types</span>
<span class="kn">from</span> <span class="nn">integration.errors</span> <span class="kn">import</span> <span class="n">ProviderError</span><span class="p">,</span> <span class="n">ConnectionError</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.post</span><span class="p">(</span><span class="s">"/checks"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run_check</span><span class="p">():</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>

    <span class="n">demo_result</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'demo_result'</span><span class="p">)</span>
    <span class="n">check_input</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'check_input'</span><span class="p">)</span>

    <span class="c"># Handle demo data scenarios</span>
    <span class="k">if</span> <span class="n">demo_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">create_demo_result</span><span class="p">(</span><span class="n">demo_result</span><span class="p">,</span> <span class="n">check_input</span><span class="p">))</span>

    <span class="n">commercial_rel</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'commercial_relationship'</span><span class="p">)</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">reseller_creds</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_config'</span><span class="p">)</span>

    <span class="c"># Use provided creds if check is through direct agreement</span>
    <span class="k">if</span> <span class="n">commercial_rel</span> <span class="o">==</span> <span class="s">'DIRECT'</span><span class="p">:</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_credentials'</span><span class="p">)</span>

    <span class="c"># Make call to provider</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">make_provider_request</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">check_input</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'provider_id'</span><span class="p">:</span> <span class="n">CONST_PROVIDER_UUID</span><span class="p">,</span>
            <span class="s">'reference'</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s">'reference'</span><span class="p">],</span>
            <span class="s">'custom_data'</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_CONNECTION'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Failed to contact data provider: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ProviderError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_MESSAGE'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Provider error: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
</code></pre>
<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"16fd3691-40d2-4c74-a808-f4758f435e2d"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"custom_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"my_field"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"warnings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='response-fields-2'>Response fields</h3>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>provider_id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        Unique identifier for the provider. The <code>reference</code> field should uniquely identify
        a check when combined with the <code>provider_id</code.
      </td>
    </tr>
    <tr>
      <td><code>reference</code></td>
      <td>string</td>
      <td>If no errors occurred</td>
      <td>
        An opaque string which identifies this check to the provider. No two checks from
        the same provider should have the same reference.  Note that this doesn't need to be the
        provider reference passed in to the check (and frequently, that may not be suitable
        as a check reference).
      </td>
    </tr>
    <tr>
      <td><code>custom_data</code></td>
      <td>object</td>
      <td>No</td>
      <td>
        Use this to store any state required by later requests relating to this check.
        The intent is for your integration to be completely stateless itself, to make
        it simpler to deploy and maintain.
        Note: if present, this *must* be an object, rather than an array or other JSON
        value. However, the keys and values in this object can be anything you like, although
        we don't recommend storing large amounts of data here, as it will be passed in on
        every following request to your integration relating to this check.
      </td>
    </tr>
    <tr>
      <td><code>errors</code></td>
      <td>
        An array containing one or more
        <a href="#check-errors">Errors</a>
      </td>
      <td>No</td>
      <td>
        A list of errors that occurred while running this check. If this is
        provided and it's not empty, the result of this check is
        considered to be errored by Passfort, regardless of the other contents
        of this response.
        If an error is returned from this endpoint, no callback is expected.
      </td>
    </tr>
    <tr>
      <td><code>warnings</code></td>
      <td>
        An array containing one or more warnings
      </td>
      <td>No</td>
      <td>
        Essentially the same as <a href="#check-errors">errors</a>, except the
        <code>sub_type</code> and <code>data</code> fields aren't present, and
        providing warnings won't cause Passfort to consider the check
        as errored.
      </td>
    </tr>
    <tr>
      <td><code>provider_data</code></td>
      <td>
        Any valid JSON value
      </td>
      <td>No</td>
      <td>
        This should be the structured JSON data returned by the data provider
        or a conversion of the data provider's response to allow
        Passfort to investigate any issues that arise with your integration.
      </td>
    </tr>
  </tbody>
</table>

<aside class="warning">
    Requests made to this endpoint must be verified
   per the <a href="#authentication">authentication section</a>.
</aside>
<h2 id='ready-for-callback'>Ready for Callback</h2>
<p>This endpoint is used by Passfort to indicate that it is ready to receive callbacks
from your integration.</p>

<p>For demo checks, the callback should be sent synchronously when this request is
received, and should generate a reference that won&#39;t conflict with live checks.</p>
<h3 id='http-request-3'>HTTP Request</h3>
<p><code>POST https://my-integration.example.com/checks/{check_id}/ready</code></p>

<blockquote>
<p>A JSON payload following this structure will be sent to the endpoint:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01234567-89ab-cdef-0123-456789abcdef"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"demo_result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ANY"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"commercial_relationship"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DIRECT"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_input"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INDIVIDUAL"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"personal_details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"family_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Person"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"given_names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"Example"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"dob"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-10-26"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"nationality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"external_refs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"generic"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PROVIDER_CHECK_REFERENCE"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"address_history"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STRUCTURED"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"locality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"London"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"postal_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"E1 1AA"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"route"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Crown Street"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"street_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
          </span><span class="s2">"original_freeform_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42 Crown Street, London, E1 1AA"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-10"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="s2">"documents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"17bb8473-1466-466e-b651-2de39df7c148"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PROOF_OF_IDENTITY"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"document_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UNKNOWN"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"enhanced_verification"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"16fd3691-40d2-4c74-a808-f4758f435e2d"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"custom_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"my_field"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The payload of the request can contain the following fields:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        Every check instruction will contain a unique ID which can be used to
        track and identify individual requests without needing to use other
        information in the request.
      </td>
    </tr>
    <tr>
      <td><code>demo_result</code></td>
      <td>
        One of the <a href="#demo-result-types">specified demo result types</a>
      </td>
      <td>No</td>
      <td>
        If this field is present, the check must be considered a demo check
        and you should respond with appropriate demo data. See the
        <a href="#demo-checks">Demo Checks section</a> for more information.
      </td>
    </tr>
    <tr>
      <td><code>commercial_relationship</code></td>
      <td>One of <code>"DIRECT"</code>, <code>"PASSFORT"</code></td>
      <td>Yes</td>
      <td>
        Specified whether the check is for a customer with a direct
        relationship with your integration's data provider, or if they're
        using the check through Passfort's pay-as-you-go reselling scheme.
      </td>
    </tr>
    <tr>
      <td><code>check_input</code></td>
      <td>An IndividualData object</td>
      <td>Yes</td>
      <td>
        <p/>
        This field contains the profile information for the individual on which the
        Document verification check is run. See the
        <a href="#check-input">Passfort Data Structure check input section</a>
        for more information on how profile data is structured within Passfort.
        <p/>
        For Document fetch checks, the check input contains a single "placeholder"
        document with no images attached.
        <p/>
        The integration should take this placeholder document and populate it with
        the result from the provider, including attaching any images that can be
        downloaded.
        <p/>
        Notably, the `id` and `category` fields from the placeholder document should
        be preserved unchanged, as these indicate how the document should be used
        within Passfort, for example, as a proof of address.
      </td>
    </tr>
    <tr>
      <td><code>provider_config</code></td>
      <td>A user-defined JSON object</td>
      <td>Yes</td>
      <td>
        This field contains the provider config structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-callback-document-verification">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option.
      </td>
    </tr>
    <tr>
      <td><code>provider_credentials</code></td>
      <td>A user-defined JSON object</td>
      <td>No</td>
      <td>
        This field contains the credentials structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-callback-document-verification">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option. <strong>This
        field is only sent if <code>commercial_relationship</code> is set to
        <code>"DIRECT"</code>.</strong>
      </td>
    </tr>
    <tr>
      <td><code>custom_data</code></td>
      <td>A user-defined JSON object</td>
      <td>No</td>
      <td>
            Any custom_data returned by your integration when the check was instructed
          will be provided here. 
      </td>
    </tr>
    <tr>
      <td><code>provider_id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        This matches the `provider_id` returned by your integration when the check was 
        instructed, and should also match the field with the same name sent to Passfort as
        part of the callback indicating that this check had completed.
      </td>
    </tr>
    <tr>
      <td><code>reference</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>
        This matches the `reference` returned by your integration when the check was
        instructed, and should also match the field with the same name sent to Passfort as 
        part of the callback indicating that this check had completed.
    </tr>
  </tbody>
</table>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">integration.testing</span> <span class="kn">import</span> <span class="n">create_demo_result</span>
<span class="kn">from</span> <span class="nn">integration.provider</span> <span class="kn">import</span> <span class="n">make_provider_request</span><span class="p">,</span> <span class="n">reseller_creds</span><span class="p">,</span> \
    <span class="n">to_passfort_field_types</span>
<span class="kn">from</span> <span class="nn">integration.errors</span> <span class="kn">import</span> <span class="n">ProviderError</span><span class="p">,</span> <span class="n">ConnectionError</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.post</span><span class="p">(</span><span class="s">"/checks/&lt;uuid:id&gt;/ready"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">acknowledge_ready</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>

    <span class="n">provider_id</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_id'</span><span class="p">)</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'reference'</span><span class="p">)</span>


    <span class="c"># Demo checks should send the callback synchronously</span>
    <span class="k">if</span> <span class="n">demo_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">send_callback</span><span class="p">(</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">custom_data</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>


    <span class="n">credentials</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'credentials'</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'config'</span><span class="p">)</span>
    <span class="n">check_input</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'check_input'</span><span class="p">)</span>

    <span class="c"># Check if provider result is ready</span>
    <span class="n">check_result</span> <span class="o">=</span> <span class="n">make_provider_request</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">check_input</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">check_result</span><span class="p">[</span><span class="s">'complete'</span><span class="p">]:</span>
      <span class="n">send_callback</span><span class="p">(</span><span class="n">provider_id</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">custom_data</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</code></pre><h3 id='response-fields-3'>Response fields</h3>
<p>This response is not required to return any content.</p>

<aside class="warning">
    Requests made to this endpoint must be verified
   per the <a href="#authentication">authentication section</a>.
</aside>
<h2 id='callback-request'>Callback Request</h2>
<p>Once the check is complete, the integration should send a callback request
to Passfort, notifying us of this event. More details can be found in the
<a href="#callbacks">callbacks section</a>.</p>

<p>There are no check-type-specific callback fields for Document fetch checks.</p>
<h2 id='finish-one-time-callback-document-fetch'>Finish One-Time Callback Document Fetch</h2>
<p>This endpoint is called shortly after Passfort receives a callback from your
integration indicating that a previously instructed check has completed.</p>

<p>In response, your integration should return the result of the check.</p>
<h3 id='http-request-4'>HTTP Request</h3>
<p><code>POST https://my-integration.example.com/checks/{check_id}/complete</code></p>

<blockquote>
<p>A JSON payload following this structure will be sent to the endpoint:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01234567-89ab-cdef-0123-456789abcdef"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"commercial_relationship"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DIRECT"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"provider_config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"enhanced_verification"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b0b7611e-c024-4ffb-9f9f-928992bec445"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"custom_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"my_field"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The payload of the request can contain the following fields:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        This check ID will be the same as the one used to instruct the check.
      </td>
    </tr>
    <tr>
      <td><code>commercial_relationship</code></td>
      <td>One of <code>"DIRECT"</code>, <code>"PASSFORT"</code></td>
      <td>Yes</td>
      <td>
        Specified whether the check is for a customer with a direct
        relationship with your integration's data provider, or if they're
        using the check through Passfort's pay-as-you-go reselling scheme.
      </td>
    </tr>
    <tr>
      <td><code>provider_config</code></td>
      <td>A user-defined JSON object</td>
      <td>Yes</td>
      <td>
        This field contains the provider config structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-callback-document-verification">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option.
      </td>
    </tr>
    <tr>
      <td><code>provider_credentials</code></td>
      <td>A user-defined JSON object</td>
      <td>No</td>
      <td>
        This field contains the credentials structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-callback-document-verification">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option. <strong>This
        field is only sent if <code>commercial_relationship</code> is set to
        <code>"DIRECT"</code>.</strong>
      </td>
    </tr>
    <tr>
      <td><code>provider_id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        This matches the <code>provider_id</code> returned by your integration when the
        check was instructed, and also matches the field with the same name
        sent to Passfort as part of the callback indicating that this check
        had completed.
      </td>
    </tr>
    <tr>
      <td><code>reference</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>
        This matches the <code>reference</code> returned by your integration when the
        check was instructed, and also matches the field with the same name
        sent to Passfort as part of the callback indicating that this check
        had completed.
      </td>
    </tr>
    <tr>
      <td><code>custom_data</code></td>
      <td>object</td>
      <td>No</td>
      <td>
        Any <code>custom_data</code> returned by your integration when the check
        was instructed or supplied to the callback endpoint will be merged
        together and provided here. The merging rules will always prioritise
        newer data when fields have the same name.
      </td>
    </tr>
  </tbody>
</table>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">integration.testing</span> <span class="kn">import</span> <span class="n">create_demo_result</span>
<span class="kn">from</span> <span class="nn">integration.provider</span> <span class="kn">import</span> <span class="n">make_provider_request</span><span class="p">,</span> <span class="n">reseller_creds</span><span class="p">,</span> \
    <span class="n">to_passfort_field_types</span>
<span class="kn">from</span> <span class="nn">integration.errors</span> <span class="kn">import</span> <span class="n">ProviderError</span><span class="p">,</span> <span class="n">ConnectionError</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.post</span><span class="p">(</span><span class="s">"/checks/&lt;uuid:id&gt;/complete"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">complete_check</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>

    <span class="n">commercial_rel</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'commercial_relationship'</span><span class="p">)</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">reseller_creds</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_config'</span><span class="p">)</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'reference'</span><span class="p">)</span>

    <span class="c"># Use provided creds if check is through direct agreement</span>
    <span class="k">if</span> <span class="n">commercial_rel</span> <span class="o">==</span> <span class="s">'DIRECT'</span><span class="p">:</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_credentials'</span><span class="p">)</span>

    <span class="c"># Make call to provider</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">fetch_check_result</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">convert_to_passfort_format</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_CONNECTION'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Failed to contact data provider: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ProviderError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_MESSAGE'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Provider error: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
</code></pre>
<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"check_output"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INDIVIDUAL"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"documents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"17bb8473-1466-466e-b651-2de39df7c148"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PROOF_OF_IDENTITY"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"document_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASSPORT"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"images"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="s2">"provider_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PROVIDER_IMAGE_REF"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"image_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FRONT"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"extracted_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"address_history"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

          </span><span class="p">],</span><span class="w">
          </span><span class="s2">"expiry"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2030-01-01"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"issued"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-01-01"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"United Kingdom"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"issuing_country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"mrz1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"P&lt;GBRPERSON&lt;&lt;EXAMPLE&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"mrz2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9040604586GBR8510264M3001019&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;06"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"904060458"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"personal_details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="s2">"family_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Person"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"given_names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"Example"</span><span class="w">
              </span><span class="p">]</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="s2">"dob"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-10-26"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"nationality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"verification_result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"all_passed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="s2">"image_checks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Image Quality"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Image resolution"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASS"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Image Quality"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Image sharpness"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASS"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="s2">"image_checks_passed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="s2">"forgery_checks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Document Fonts"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Title uses correct font"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASS"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="s2">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Checksum"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MRZ has a valid checksum"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASS"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="s2">"forgery_checks_passed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="s2">"document_type_passed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"warnings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"provider_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='response-fields-4'>Response fields</h3>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>check_output</code></td>
      <td>Object structured per <code>check_output</code> below</td>
      <td>If check did not error</td>
      <td>
        Indicates the result data for this check. See the
        <code>check_output</code> section for the full structure of
        this check.
      </td>
    </tr>
    <tr>
      <td><code>errors</code></td>
      <td>
        An array containing one or more
        <a href="#check-errors">Errors</a>
      </td>
      <td>No</td>
      <td>
        A list of errors that occurred while running this check. If this is
        provided and it's not empty, the result of this check is
        considered to be errored by Passfort, regardless of the other contents
        of this response.
      </td>
    </tr>
    <tr>
      <td><code>warnings</code></td>
      <td>
        An array containing one or more warnings
      </td>
      <td>No</td>
      <td>
        Essentially the same as <a href="#check-errors">errors</a>, except the
        <code>sub_type</code> and <code>data</code> fields aren't present, and
        providing warnings won't cause Passfort to consider the check
        as errored.
      </td>
    </tr>
    <tr>
      <td><code>provider_data</code></td>
      <td>
        Any valid JSON value
      </td>
      <td>No</td>
      <td>
        This should be the structured JSON data returned by the data provider
        or a conversion of the data provider's response to allow
        Passfort to investigate any issues that arise with your integration.
      </td>
    </tr>
    <tr>
      <td><code>charges</code></td>
      <td>
        An array containing one or more
        <a href="#check-charges">Charges</a>
      </td>
      <td>No</td>
      <td>
        A list of charges incurred while running this check. Charges may only
        be returned if both of these conditions are met:
        <ul>
          <li>No errors occur when the check is run.</li>
          <li>
            The check is resold by Passfort.
          </li>
        </ul>
        
        For demo checks, charges may be returned, but they won't be deducted
        from the institution's credit.
        
        If charges are returned, the total amount charged must be no greater
        than the maximum cost-per-check specified in the integration's
        configuration.
      </td>
    </tr>
  </tbody>
</table>

<aside class="info">
If the billing information isn't easily available from the final
request, the integration can use the `custom_data` field to pass that
information through to the point where it is needed.
</aside>
<h4 id='check_output'><code>check_output</code></h4>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>entity_type</code></td>
      <td>The value <code>"INDIVIDUAL"</code></td>
      <td>Yes</td>
      <td>
        The only supported entity type for Document verification checks
        is individuals.
      </td>
    </tr>
    <tr>
      <td><code>documents</code></td>
      <td>
        An array containing the documents, structured as it is
        in <a href="#data-structure">the Passfort Partner API</a>.
      </td>
      <td>If no errors occurred</td>
      <td>
        This field should contain as much information on the document as
        possible from the provider. You must return the provider's document
        image in the <code>images</code> field, with the
        <code>provider_reference</code> set to a string identifier used
        to reference the image to be used in the
        <a href="#download-document-image">Download Document Image</a> endpoint.
      </td>
    </tr>
  </tbody>
</table>

<aside class="warning">
    Requests made to this endpoint must be verified
   per the <a href="#authentication">authentication section</a>.
</aside>
<h2 id='download-document-file'>Download Document File</h2>
<p>This endpoint allows Passfort to retrieve images and other files
stored with the provider for a given check.</p>
<h3 id='http-request-5'>HTTP Request</h3>
<p><code>POST https://my-integration.example.com/download_file</code></p>

<blockquote>
<p>A JSON payload following this structure will be sent to the endpoint:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"check_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b383f249-7ffa-4fd4-9465-73728e090d26"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"file_reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"download_info"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"download_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"IMAGE"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"image_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FRONT"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"commercial_relationship"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DIRECT"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"provider_config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"enhanced_verification"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"custom_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"my_field"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The payload of the request can contain the following fields:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>check_id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        The unique ID for the check corresponding to this request, which can be
        used to track and identify individual requests without needing to use
        other information in the request, useful for logging and tracing issues
        with your integration.
      </td>
    </tr>
    <tr>
      <td><code>file_reference</code></td>
      <td>
        <code>string</code>
      </td>
      <td>Yes</td>
      <td>
        The provider reference for the file being requested, as previously specified
        in the check result's <code>provider_reference</code> field for images
        or the <code>reference</code> field for other files.
      </td>
    </tr>
    <tr>
      <td><code>download_info.download_type</code></td>
      <td>One of <code>"FILE"</code>, <code>"IMAGE"</code></td>
      <td>Yes</td>
      <td>
        Specifies whether this download is for a file or image, i.e. whether this
        is from the <code>images</code> or <code>files</code>, for a given document.
      </td>
    </tr>
    <tr>
      <td><code>download_info.image_type</code></td>
      <td>One of <code>"FRONT"</code>, <code>"BACK"</code>, <code>"FACE"</code></td>
      <td>If <code>download_info.download_type</code> is <code>"IMAGE"</code></td>
      <td>
        Specifies which type of document image was indicated for this file.
      </td>
    </tr>
    <tr>
      <td><code>download_info.file_type</code></td>
      <td>One of <code>"LIVE_VIDEO"</code>, <code>"VIDEO_FRAME"</code></td>
      <td>If <code>download_info.download_type</code> is <code>"FILE"</code></td>
      <td>
        Specifies which type of file was indicated for this file.
      </td>
    </tr>
    <tr>
      <td><code>commercial_relationship</code></td>
      <td>One of <code>"DIRECT"</code>, <code>"PASSFORT"</code></td>
      <td>Yes</td>
      <td>
        Specified whether the check is for a customer with a direct
        relationship with your integration's data provider, or if they're
        using the check through Passfort's pay-as-you-go reselling scheme.
      </td>
    </tr>
    <tr>
      <td><code>provider_config</code></td>
      <td>A user-defined JSON object</td>
      <td>Yes</td>
      <td>
        This field contains the provider config structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-callback-document-verification">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option.
      </td>
    </tr>
    <tr>
      <td><code>provider_credentials</code></td>
      <td>A user-defined JSON object</td>
      <td>If <code>commercial_relationship</code> is set to <code>"DIRECT"</code></td>
      <td>
        This field contains the credentials structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-callback-document-verification">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option. <strong>This
        field is only sent if <code>commercial_relationship</code> is set to
        <code>"DIRECT"</code>.</strong>
      </td>
    </tr>
    <tr>
      <td><code>custom_data</code></td>
      <td>object</td>
      <td>No</td>
      <td>
        Any <code>custom_data</code> returned by your integration when the check
        was instructed or supplied to the callback endpoint will be merged
        together and provided here. The merging rules will always prioritise
        newer data when fields have the same name.
      </td>
    </tr>
  </tbody>
</table>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">send_file</span>
<span class="kn">from</span> <span class="nn">integration.provider</span> <span class="kn">import</span> <span class="n">download_provider_image</span><span class="p">,</span> <span class="n">reseller_creds</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.post</span><span class="p">(</span><span class="s">"/download_file"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run_check</span><span class="p">():</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>

    <span class="n">file_ref</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'file_reference'</span><span class="p">)</span>

    <span class="c"># Send demo image if requested</span>
    <span class="k">if</span> <span class="n">file_ref</span> <span class="o">==</span> <span class="s">'DEMO_IMAGE'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="s">'static/demo.png'</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">'image/png'</span><span class="p">)</span>

    <span class="n">commercial_rel</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'commercial_relationship'</span><span class="p">)</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">reseller_creds</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_config'</span><span class="p">)</span>

    <span class="c"># Use provided creds if check is through direct agreement</span>
    <span class="k">if</span> <span class="n">commercial_rel</span> <span class="o">==</span> <span class="s">'DIRECT'</span><span class="p">:</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_credentials'</span><span class="p">)</span>

    <span class="c"># Make call to provider</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">download_provider_image</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">file_ref</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">mimetype</span><span class="p">)</span>
</code></pre><h3 id='response'>Response</h3>
<p>This endpoint should return the raw image data with the appropriate <code>Content-Type</code>.</p>
<h4 id='file-names'>File names</h4>
<p>Wherever possible, your integration should return an appropriate name for the file using
a <code>File-Name</code> header. The value of the header <em>is required</em> to be be a a valid UTF-8
string, and should include the file extension. If this is not provided a default filename
of <code>&quot;unknown&quot;</code> will be used, with no file extension. If the provider does not provide a
file name, it is recommended your integration generate a suitable file name.</p>

<aside>
    Currently, file names are only used for files. The file name will be ignored for document images.
</aside>
<h4 id='supported-image-types'>Supported image types</h4>
<p>The currently supported types for document images on Passfort are:</p>

<ul>
<li><code>image/jpeg</code></li>
<li><code>image/png</code></li>
<li><code>image/gif</code></li>
<li><code>image/tiff</code></li>
<li><code>application/pdf</code></li>
</ul>
<h4 id='supported-video-types'>Supported video types</h4>
<p>The currently supported types for live video files on Passfort are:</p>

<ul>
<li><code>video/mp4</code></li>
<li><code>video/webm</code></li>
</ul>

<aside class="warning">
    Requests made to this endpoint must be verified
   per the <a href="#authentication">authentication section</a>.
</aside>
<h1 id='one-time-sync-company-custom'>One-time Sync Company Custom</h1>
<p>This section lists all endpoints that must be implemented for a one-time synchronous Company custom check integration.</p>

<p>One-time synchronous Company custom checks are custom checks with the following behavior:</p>

<p>* The check result is returned directly upon request; the response is only sent when the check is finished (synchronous).</p>

<p>* This one-time check operates at a point in time, meaning the check result is returned once and there is no ongoing monitoring.</p>
<h2 id='get-check-configuration-for-one-time-sync-company-custom'>Get check configuration for one-time sync Company custom</h2>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.get</span><span class="p">(</span><span class="s">"/config"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_check_configuration</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s">"check_type"</span><span class="p">:</span> <span class="s">"COMPANY_CUSTOM"</span><span class="p">,</span>
        <span class="s">"check_template"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"type"</span><span class="p">:</span> <span class="s">"ONE_TIME_SYNCHRONOUS"</span><span class="p">,</span>
            <span class="s">"timeout"</span><span class="p">:</span> <span class="mi">60</span>
        <span class="p">},</span>
        <span class="s">"pricing"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"supports_reselling"</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">},</span>
        <span class="s">"supported_countries"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">"GBR"</span><span class="p">,</span>
            <span class="s">"USA"</span><span class="p">,</span>
            <span class="s">"CAN"</span><span class="p">,</span>
            <span class="s">"NLD"</span>
        <span class="p">],</span>
        <span class="s">"supported_features"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">"EXTERNAL_EMBED"</span>
        <span class="p">],</span>
        <span class="s">"credentials"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span>
                    <span class="s">"name"</span><span class="p">:</span> <span class="s">"apikey"</span><span class="p">,</span>
                    <span class="s">"label"</span><span class="p">:</span> <span class="s">"API Key"</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s">"config"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="p">:</span> <span class="p">[</span>

            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">})</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/config'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">check_type</span><span class="p">:</span> <span class="s1">'COMPANY_CUSTOM'</span><span class="p">,</span>
        <span class="na">check_template</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="s1">'ONE_TIME_SYNCHRONOUS'</span><span class="p">,</span>
            <span class="na">timeout</span><span class="p">:</span> <span class="mi">60</span>
        <span class="p">},</span>
        <span class="na">pricing</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">supports_reselling</span><span class="p">:</span> <span class="kc">false</span>
        <span class="p">},</span>
        <span class="na">supported_countries</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'GBR'</span><span class="p">,</span>
            <span class="s1">'USA'</span><span class="p">,</span>
            <span class="s1">'CAN'</span><span class="p">,</span>
            <span class="s1">'NLD'</span>
        <span class="p">],</span>
        <span class="na">supported_features</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'EXTERNAL_EMBED'</span>
        <span class="p">],</span>
        <span class="na">credentials</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">fields</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span>
                    <span class="na">name</span><span class="p">:</span> <span class="s1">'apikey'</span><span class="p">,</span>
                    <span class="na">label</span><span class="p">:</span> <span class="s1">'API Key'</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="na">config</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">fields</span><span class="p">:</span> <span class="p">[</span>

            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>

<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"check_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMPANY_CUSTOM"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_template"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ONE_TIME_SYNCHRONOUS"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"timeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"pricing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"supports_reselling"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"supported_countries"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"USA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"CAN"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"NLD"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"supported_features"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"EXTERNAL_EMBED"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"apikey"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"API Key"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint specifies which configuration is used by Passfort to perform a
one-time synchronous custom check using your integration.</p>
<h3 id='http-request'>HTTP request</h3>
<p><code>GET https://my-integration.example.com/config</code></p>
<h3 id='response-fields'>Response fields</h3>
<p>Most configuration fields are already discussed in the <a href="#configuration">configuration
section</a>. The following options are specific to the Company custom check.</p>
<h4 id='check-type'>Check type</h4>
<p>The <code>check_type</code> field must be set to <code>&quot;COMPANY_CUSTOM&quot;</code>.</p>
<h4 id='check-template'>Check template</h4>
<p>The <code>check_template</code> fields for this check are:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>type</code></td>
      <td>The value <code>"ONE_TIME_SYNCHRONOUS"</code></td>
      <td>Yes</td>
      <td>
        Which check template to use for this check. For one-time synchronous
        checks, you must specify <code>"ONE_TIME_SYNCHRONOUS"</code>.
      </td>
    </tr>
    <tr>
      <td><code>timeout</code></td>
      <td>number</td>
      <td>No</td>
      <td>
        The minimum number of seconds Passfort waits without a response before
        considering identity checks run through this integration to have
        timed out. Must be an integer. If not specified or set to
        <code>null</code>, a timeout of 60 seconds is used.
      </td>
    </tr>
  </tbody>
</table>

<aside class="warning">
    Requests made to this endpoint must be verified
   per the <a href="#authentication">authentication section</a>.
</aside>
<h2 id='run-a-one-time-sync-company-custom-check'>Run a one-time sync Company custom check</h2>
<p>This endpoint exposes your data provider&#39;s check results to Passfort.</p>
<h3 id='http-request-2'>HTTP request</h3>
<p><code>POST https://my-integration.example.com/checks</code></p>

<blockquote>
<p>A JSON payload following this structure is sent to the endpoint:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01234567-89ab-cdef-0123-456789abcdef"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"demo_result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ANY"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"commercial_relationship"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DIRECT"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_input"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMPANY"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Co."</span><span class="p">,</span><span class="w">
      </span><span class="s2">"number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123456"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"country_of_incorporation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"apikey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foobar"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The payload of the request can contain the following fields:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        Every check instruction contains a unique ID which can be used to
        track and identify individual requests without needing to use other
        information in the request.
      </td>
    </tr>
    <tr>
      <td><code>demo_result</code></td>
      <td>
        One of the <a href="#demo-result-types">specified demo result types</a>
      </td>
      <td>No</td>
      <td>
        If this field is present, the check must be considered a demo check
        and you should respond with appropriate demo data. See the
        <a href="#demo-checks">Demo Checks</a> section for more information.
      </td>
    </tr>
    <tr>
      <td><code>commercial_relationship</code></td>
      <td><code>"DIRECT"</code></td>
      <td>Yes</td>
      <td>
        Specifies whether the check is for a customer with a direct
        relationship with your integration's data provider or if they're
        using the check through Passfort's pay-as-you-go reselling scheme. 
        Reselling is not available for Company Custom Check.
      </td>
    </tr>
    <tr>
      <td><code>check_input</code></td>
      <td>A <code>CompanyData</code> object</td>
      <td>Yes</td>
      <td>  
      This field contains the profile information for the company on which the
        Company custom check check is run. See the
        <a href="#check-input">Passfort Data Structure check input</a> section
        for more information on how profile data is structured within Passfort.
      </td>
    </tr>
    <tr>
      <td><code>provider_config</code></td>
      <td>A user-defined JSON object</td>
      <td>Yes</td>
      <td>
        This field contains the provider config structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-sync-company-custom">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the <code>value</code> of the configuration option.
      </td>
    </tr>
    <tr>
      <td><code>provider_credentials</code></td>
      <td>A user-defined JSON object</td>
      <td>No</td>
      <td>
        This field contains the credentials structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-sync-company-custom">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the <code>value</code> of the configuration option. <strong>This
        field is only sent if <code>commercial_relationship</code> is set to
        <code>"DIRECT"</code>.</strong>
      </td>
    </tr>
  </tbody>
</table>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">integration.testing</span> <span class="kn">import</span> <span class="n">create_demo_result</span>
<span class="kn">from</span> <span class="nn">integration.provider</span> <span class="kn">import</span> <span class="n">make_provider_request</span><span class="p">,</span> <span class="n">reseller_creds</span><span class="p">,</span> \
    <span class="n">extract_passfort_metadata</span>
<span class="kn">from</span> <span class="nn">integration.errors</span> <span class="kn">import</span> <span class="n">ProviderError</span><span class="p">,</span> <span class="n">ConnectionError</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.post</span><span class="p">(</span><span class="s">'/checks'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run_check</span><span class="p">():</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>

    <span class="n">demo_result</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'demo_result'</span><span class="p">)</span>
    <span class="n">check_input</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'check_input'</span><span class="p">)</span>

    <span class="c"># Handle demo data scenarios</span>
    <span class="k">if</span> <span class="n">demo_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">create_demo_result</span><span class="p">(</span><span class="n">demo_result</span><span class="p">,</span> <span class="n">check_input</span><span class="p">))</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_config'</span><span class="p">)</span>

    <span class="n">credentials</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_credentials'</span><span class="p">)</span>

    <span class="c"># Make call to provider</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">make_provider_request</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">check_input</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">"result"</span><span class="p">:</span> <span class="n">map_to_passfort_result</span><span class="p">(</span><span class="n">result</span><span class="p">),</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">'provider_data'</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">result</span><span class="p">),</span>
            <span class="s">"external_resources"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"EMBED"</span><span class="p">,</span>
                    <span class="s">"url"</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">further_details</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                    <span class="s">"id"</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span>
                    <span class="s">"label"</span><span class="p">:</span> <span class="s">"Further details"</span>
                <span class="p">}</span>
            <span class="p">],</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>

            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_CONNECTION'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Failed to contact data provider: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ProviderError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_MESSAGE'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Provider error: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"express"</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">createDemoResult</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"./testing"</span><span class="p">);</span>
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">makeProviderRequest</span><span class="p">,</span>
  <span class="nx">extractPassFortMetadata</span><span class="p">,</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"./provider"</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">"/checks"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Handle demo data scenarios</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">demo_result</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span>
      <span class="nx">createDemoResult</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">demo_result</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">check_input</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="kr">const</span> <span class="nx">credentials</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">provider_credentials</span>

  <span class="k">return</span> <span class="nx">makeProviderRequest</span><span class="p">(</span>
    <span class="nx">credentials</span><span class="p">,</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">provider_config</span><span class="p">,</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">check_input</span>
  <span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">checkResult</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">make_provider_request</span><span class="p">(</span><span class="nx">credentials</span><span class="p">,</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">check_input</span><span class="p">)</span>


        <span class="k">return</span> <span class="nx">jsonify</span><span class="p">({</span>
            <span class="s2">"result"</span><span class="p">:</span> <span class="nx">map_to_passfort_result</span><span class="p">(</span><span class="nx">result</span><span class="p">),</span>
            <span class="s1">'errors'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">'warnings'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">'provider_data'</span><span class="p">:</span> <span class="nx">result</span><span class="p">,</span>
            <span class="s2">"external_resources"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"EMBED"</span><span class="p">,</span>
                    <span class="s2">"url"</span><span class="p">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">further_details</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
                    <span class="s2">"id"</span><span class="p">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
                    <span class="s2">"label"</span><span class="p">:</span> <span class="s2">"Further details"</span>
                <span class="p">}</span>
            <span class="p">],</span>
        <span class="p">});</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">"CONNECTION"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
          <span class="na">errors</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="s2">"PROVIDER_CONNECTION"</span><span class="p">,</span>
              <span class="na">error</span><span class="p">:</span> <span class="s2">"Failed to contact data provider: "</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">],</span>
          <span class="na">warnings</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
          <span class="na">errors</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="s2">"PROVIDER_MESSAGE"</span><span class="p">,</span>
              <span class="na">error</span><span class="p">:</span> <span class="s2">"Provider error: "</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">],</span>
          <span class="na">warnings</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre><h4 id='check_input'><code>check_input</code></h4>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>entity_type</code></td>
      <td>The value <code>"COMPANY"</code></td>
      <td>Yes</td>
      <td>
        The only supported entity type for Company Custom Checks
        is company.
      </td>
    </tr>
    <tr>
    <tr>
      <td><code>external_refs</code></td>
      <td>Object</td>
      <td>Yes</td>
      <td>
        A provider defined identifier assigned to the profiles or check being run. 
      </td>
    </tr>
    <tr>
    <tr>
      <td><code>customer_refs</code></td>
      <td>String</td>
      <td>Yes</td>
      <td>
        A label used by Passfort customers to identify the profile the check is being run against. 
      </td>
    </tr>
    <tr>
      <td><code>metadata</code></td>
      <td>
        An object containing the registry data, structured as it is
        in <a href="#data-structure">the Passfort Partner API</a>.
      </td>
      <td>If a match is found by the provider</td>
      <td>As best as possible, all fields you support should be made to populate all fields supported by the provider</td>
    </tr>
  </tbody>
</table>
<h4 id='check_input-metadata'><code>check_input.metadata</code></h4>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always Present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>addresses</code></td>
      <td><code>List</code></td>
      <td>No</td>
      <td>
        List of addresses associated with the company.
      </td>
    </tr>
    <tr>
      <td><code>number</code></td>
      <td><code>String</code></td>
      <td>No</td>
      <td>
        Optional field for company number.
      </td>
    </tr>
    <tr>
      <td><code>bvd_id</code></td>
      <td><code>UUID</code></td>
      <td>No</td>
      <td>
        The bvd_id associated with the company.
      </td>
    </tr>
    <tr>
      <td><code>country_of_incorporation</code></td>
      <td><code>String</code></td>
      <td>No</td>
      <td>
        The country of incorporation.
      </td>
    </tr>
    <tr>
      <td><code>state_of_incorporation</code></td>
      <td><code>String</code></td>
      <td>No</td>
      <td>
        The state of incorporation.
      </td>
    </tr>
  </tbody>
</table>
<h3 id='response-fields-2'>Response fields</h3>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>errors</code></td>
      <td>
        An array containing one or more
        <a href="#check-errors">Errors</a>
      </td>
      <td>No</td>
      <td>
        A list of errors that occurred while running this check. If this is
        provided and it's not empty, the result of this check is
        considered to be errored by Passfort, regardless of the other contents
        of this response.
      </td>
    </tr>
    <tr>
      <td><code>warnings</code></td>
      <td>
        An array containing one or more warnings
      </td>
      <td>No</td>
      <td>
        Essentially the same as <a href="#check-errors">errors</a>, except the
        <code>sub_type</code> and <code>data</code> fields aren't present, and
        providing warnings won't cause Passfort to consider the check
        as errored.
      </td>
    </tr>
    <tr>
      <td><code>provider_data</code></td>
      <td>
        Any valid JSON value
      </td>
      <td>No</td>
      <td>
        This should be the structured JSON data returned by the data provider
        or a conversion of the data provider's response to allow
        Passfort to investigate any issues that arise with your integration.
      </td>
    </tr>
  </tbody>
</table>

<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"provider_data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Demo result. Did not make request to provider."</span><span class="p">,</span><span class="w">
  </span><span class="s2">"warnings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"external_resources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EMBED"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://host.docker.internal:8080/external_resource"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8AA89547-89FC-4EAD-ACEC-FFA36F451337"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example embed"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"decision"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASS"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"summary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"It's a pass..."</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h4 id='check_output'><code>check_output</code></h4>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>decision</code></td>
      <td><code>DecisionClass</code></td>
      <td>Yes</td>
      <td>
        The check will return one of the following decisions: "PASS | FAIL | PARTIAL | WARN | ERROR"
      </td>
    </tr>
    <tr>
      <td><code>summary</code></td>
      <td>
      A summary of the result
        in <a href="#data-structure">the Passfort Partner API</a>.
      </td>
      <td>If a match was found by the provider</td>
      <td>As best as possible, all fields you support should be made to populate all fields supported by the provider</td>
    </tr>
    <tr>
        <tr>
      <td><code>external_resources</code></td>
      <td>
        An object 
        in <a href="#data-structure">the Passfort Partner API</a>.
      </td>
      <td>No</td>
      <td>As best as possible, all fields you support should be made to populate all fields supported by the provider</td>
    </tr>
    <tr>
      <td><code>warnings</code></td>
      <td>
        An object containing the registry data, structured as it is
        in <a href="#data-structure">the Passfort Partner API</a>.
      </td>
      <td>If a match was found by the provider</td>
      <td>As best as possible, all fields you support should be made to populate all fields supported by the provider</td>
    </tr>
    <tr>
      <td><code>errors</code></td>
      <td>
        An array containing one or more
        <a href="#check-errors">Errors</a>
      </td>
      <td>No</td>
      <td>
      A list of errors that occurred while running this check. If this is
      provided and it is not empty, the result of this check is
      considered to be errored by Passfort, regardless of the other contents
      of this response.
      </td>
    </tr>
  </tbody>
</table>
<h1 id='one-time-sync-individual-custom'>One-time Sync Individual Custom</h1>
<p>This section lists all endpoints that must be implemented for a one-time synchronous Individual custom check integration.</p>

<p>One-time synchronous Individual custom checks are custom checks with the following behavior:</p>

<p>* The check result is returned directly upon request; the response is only sent when the check is finished (synchronous).</p>

<p>* This one-time check operates at a point in time, meaning the check result is returned once and there is no ongoing monitoring.</p>
<h2 id='get-check-configuration-for-one-time-sync-individual-custom'>Get check configuration for one-time sync Individual custom</h2>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.get</span><span class="p">(</span><span class="s">"/config"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_check_configuration</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s">"check_type"</span><span class="p">:</span> <span class="s">"INDIVIDUAL_CUSTOM"</span><span class="p">,</span>
        <span class="s">"check_template"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"type"</span><span class="p">:</span> <span class="s">"ONE_TIME_SYNCHRONOUS"</span><span class="p">,</span>
            <span class="s">"timeout"</span><span class="p">:</span> <span class="mi">60</span>
        <span class="p">},</span>
        <span class="s">"pricing"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"supports_reselling"</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">},</span>
        <span class="s">"supported_countries"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">"GBR"</span><span class="p">,</span>
            <span class="s">"USA"</span><span class="p">,</span>
            <span class="s">"CAN"</span><span class="p">,</span>
            <span class="s">"NLD"</span>
        <span class="p">],</span>
        <span class="s">"supported_features"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">"EXTERNAL_EMBED"</span>
        <span class="p">],</span>
        <span class="s">"credentials"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span>
                    <span class="s">"name"</span><span class="p">:</span> <span class="s">"apikey"</span><span class="p">,</span>
                    <span class="s">"label"</span><span class="p">:</span> <span class="s">"API Key"</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s">"config"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="p">:</span> <span class="p">[</span>

            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">})</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/config'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">check_type</span><span class="p">:</span> <span class="s1">'INDIVIDUAL_CUSTOM'</span><span class="p">,</span>
        <span class="na">check_template</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">type</span><span class="p">:</span> <span class="s1">'ONE_TIME_SYNCHRONOUS'</span><span class="p">,</span>
            <span class="na">timeout</span><span class="p">:</span> <span class="mi">60</span>
        <span class="p">},</span>
        <span class="na">pricing</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">supports_reselling</span><span class="p">:</span> <span class="kc">false</span>
        <span class="p">},</span>
        <span class="na">supported_countries</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'GBR'</span><span class="p">,</span>
            <span class="s1">'USA'</span><span class="p">,</span>
            <span class="s1">'CAN'</span><span class="p">,</span>
            <span class="s1">'NLD'</span>
        <span class="p">],</span>
        <span class="na">supported_features</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">'EXTERNAL_EMBED'</span>
        <span class="p">],</span>
        <span class="na">credentials</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">fields</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span>
                    <span class="na">name</span><span class="p">:</span> <span class="s1">'apikey'</span><span class="p">,</span>
                    <span class="na">label</span><span class="p">:</span> <span class="s1">'API Key'</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="na">config</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">fields</span><span class="p">:</span> <span class="p">[</span>

            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>

<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"check_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INDIVIDUAL_CUSTOM"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_template"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ONE_TIME_SYNCHRONOUS"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"timeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"pricing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"supports_reselling"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"supported_countries"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"USA"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"CAN"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"NLD"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"supported_features"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"EXTERNAL_EMBED"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"apikey"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"API Key"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint specifies which configuration is used by Passfort to perform a
one-time synchronous custom check using your integration.</p>
<h3 id='http-request'>HTTP request</h3>
<p><code>GET https://my-integration.example.com/config</code></p>
<h3 id='response-fields'>Response fields</h3>
<p>Most configuration fields are already discussed in the <a href="#configuration">configuration
section</a>. The following options are specific to the Individual custom check.</p>
<h4 id='check-type'>Check type</h4>
<p>The <code>check_type</code> field must be set to <code>&quot;INDIVIDUAL_CUSTOM&quot;</code>.</p>
<h4 id='check-template'>Check template</h4>
<p>The <code>check_template</code> fields for this check are:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>type</code></td>
      <td>The value <code>"ONE_TIME_SYNCHRONOUS"</code></td>
      <td>Yes</td>
      <td>
        Which check template to use for this check. For one-time synchronous
        checks, you must specify <code>"ONE_TIME_SYNCHRONOUS"</code>.
      </td>
    </tr>
    <tr>
      <td><code>timeout</code></td>
      <td>number</td>
      <td>No</td>
      <td>
        The minimum number of seconds Passfort waits without a response before
        considering identity checks run through this integration to have
        timed out. Must be an integer. If not specified or set to
        <code>null</code>, a timeout of 60 seconds is used.
      </td>
    </tr>
  </tbody>
</table>

<aside class="warning">
    Requests made to this endpoint must be verified
   per the <a href="#authentication">authentication section</a>.
</aside>
<h2 id='run-a-one-time-sync-individual-custom-check'>Run a one-time sync Individual custom check</h2>
<p>This endpoint exposes your data provider&#39;s check results to Passfort.</p>
<h3 id='http-request-2'>HTTP request</h3>
<p><code>POST https://my-integration.example.com/checks</code></p>

<blockquote>
<p>A JSON payload following this structure is sent to the endpoint:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01234567-89ab-cdef-0123-456789abcdef"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"demo_result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ANY"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"commercial_relationship"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DIRECT"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"check_input"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"entity_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INDIVIDUAL"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"personal_details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"family_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Person"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"given_names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"Example"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"dob"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-10-26"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"nationality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"address_history"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"STRUCTURED"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"locality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"London"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"postal_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"E1 1AA"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"route"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Crown Street"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"street_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
          </span><span class="s2">"original_freeform_address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42 Crown Street, London, E1 1AA"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="s2">"start_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1985-10"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"require_dob"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The payload of the request can contain the following fields:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        Every check instruction contains a unique ID which can be used to
        track and identify individual requests without needing to use other
        information in the request.
      </td>
    </tr>
    <tr>
      <td><code>demo_result</code></td>
      <td>
        One of the <a href="#demo-result-types">specified demo result types</a>
      </td>
      <td>No</td>
      <td>
        If this field is present, the check must be considered a demo check
        and you should respond with appropriate demo data. See the
        <a href="#demo-checks">Demo Checks</a> section for more information.
      </td>
    </tr>
    <tr>
      <td><code>commercial_relationship</code></td>
      <td><code>"DIRECT"</code></td>
      <td>Yes</td>
      <td>
        Specifies whether the check is for a customer with a direct
        relationship with your integration's data provider or if they're
        using the check through Passfort's pay-as-you-go reselling scheme. 
        Reselling is not available for Individual Custom Check.
      </td>
    </tr>
    <tr>
      <td><code>check_input</code></td>
      <td>A <code>IndividualData</code> object</td>
      <td>Yes</td>
      <td>  
      This field contains the profile information for the individual on which the
        Individual custom check is run. See the
        <a href="#check-input">Passfort Data Structure check input</a> section
        for more information on how profile data is structured within Passfort.
      </td>
    </tr>
    <tr>
      <td><code>provider_config</code></td>
      <td>A user-defined JSON object</td>
      <td>Yes</td>
      <td>
        This field contains the provider config structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-sync-individual-custom">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the <code>value</code> of the configuration option.
      </td>
    </tr>
    <tr>
      <td><code>provider_credentials</code></td>
      <td>A user-defined JSON object</td>
      <td>No</td>
      <td>
        This field contains the credentials structured in the way
        specified by your integration's
        <a href="#get-check-configuration-one-time-sync-individual-custom">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the <code>value</code> of the configuration option. <strong>This
        field is only sent if <code>commercial_relationship</code> is set to
        <code>"DIRECT"</code>.</strong>
      </td>
    </tr>
  </tbody>
</table>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">integration.testing</span> <span class="kn">import</span> <span class="n">create_demo_result</span>
<span class="kn">from</span> <span class="nn">integration.provider</span> <span class="kn">import</span> <span class="n">make_provider_request</span><span class="p">,</span> <span class="n">reseller_creds</span><span class="p">,</span> \
    <span class="n">extract_passfort_metadata</span>
<span class="kn">from</span> <span class="nn">integration.errors</span> <span class="kn">import</span> <span class="n">ProviderError</span><span class="p">,</span> <span class="n">ConnectionError</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.post</span><span class="p">(</span><span class="s">'/checks'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run_check</span><span class="p">():</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>

    <span class="n">demo_result</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'demo_result'</span><span class="p">)</span>
    <span class="n">check_input</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'check_input'</span><span class="p">)</span>

    <span class="c"># Handle demo data scenarios</span>
    <span class="k">if</span> <span class="n">demo_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">create_demo_result</span><span class="p">(</span><span class="n">demo_result</span><span class="p">,</span> <span class="n">check_input</span><span class="p">))</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_config'</span><span class="p">)</span>

    <span class="n">credentials</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_credentials'</span><span class="p">)</span>

    <span class="c"># Make call to provider</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">make_provider_request</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">check_input</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">"result"</span><span class="p">:</span> <span class="n">map_to_passfort_result</span><span class="p">(</span><span class="n">result</span><span class="p">),</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">'provider_data'</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">result</span><span class="p">),</span>
            <span class="s">"external_resources"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"EMBED"</span><span class="p">,</span>
                    <span class="s">"url"</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">further_details</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                    <span class="s">"id"</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span>
                    <span class="s">"label"</span><span class="p">:</span> <span class="s">"Further details"</span>
                <span class="p">}</span>
            <span class="p">],</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>

            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_CONNECTION'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Failed to contact data provider: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ProviderError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_MESSAGE'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Provider error: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"express"</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">createDemoResult</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"./testing"</span><span class="p">);</span>
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">makeProviderRequest</span><span class="p">,</span>
  <span class="nx">extractPassFortMetadata</span><span class="p">,</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"./provider"</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">"/checks"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Handle demo data scenarios</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">demo_result</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span>
      <span class="nx">createDemoResult</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">demo_result</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">check_input</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="kr">const</span> <span class="nx">credentials</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">provider_credentials</span>

  <span class="k">return</span> <span class="nx">makeProviderRequest</span><span class="p">(</span>
    <span class="nx">credentials</span><span class="p">,</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">provider_config</span><span class="p">,</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">check_input</span>
  <span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">checkResult</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">make_provider_request</span><span class="p">(</span><span class="nx">credentials</span><span class="p">,</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">check_input</span><span class="p">)</span>


        <span class="k">return</span> <span class="nx">jsonify</span><span class="p">({</span>
            <span class="s2">"result"</span><span class="p">:</span> <span class="nx">map_to_passfort_result</span><span class="p">(</span><span class="nx">result</span><span class="p">),</span>
            <span class="s1">'errors'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">'warnings'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">'provider_data'</span><span class="p">:</span> <span class="nx">result</span><span class="p">,</span>
            <span class="s2">"external_resources"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"EMBED"</span><span class="p">,</span>
                    <span class="s2">"url"</span><span class="p">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">further_details</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
                    <span class="s2">"id"</span><span class="p">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
                    <span class="s2">"label"</span><span class="p">:</span> <span class="s2">"Further details"</span>
                <span class="p">}</span>
            <span class="p">],</span>
        <span class="p">});</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">"CONNECTION"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
          <span class="na">errors</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="s2">"PROVIDER_CONNECTION"</span><span class="p">,</span>
              <span class="na">error</span><span class="p">:</span> <span class="s2">"Failed to contact data provider: "</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">],</span>
          <span class="na">warnings</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
          <span class="na">errors</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="s2">"PROVIDER_MESSAGE"</span><span class="p">,</span>
              <span class="na">error</span><span class="p">:</span> <span class="s2">"Provider error: "</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">],</span>
          <span class="na">warnings</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre><h4 id='check_input'><code>check_input</code></h4>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>entity_type</code></td>
      <td>The value <code>"INDIVIDUAL"</code></td>
      <td>Yes</td>
      <td>
        The only supported entity type for Individual Custom Checks
        is individual.
      </td>
    </tr>
    <tr>
    <tr>
      <td><code>personal_details</code></td>
      <td>Object</td>
      <td>No</td>
      <td>
        A data object containing Personal information about an individual. Refer to <a href="https://developer.passfort.com/api#tag/Profiles/paths/~1profiles~1%7Bprofile_id%7D~1collected_data/post">Passfort API Documentation</a> for additional details.
      </td>
    </tr>
    <tr>
    <tr>
      <td><code>contact_details</code></td>
      <td>Object</td>
      <td>No</td>
      <td>
        The phone number and email for the individual the check is run against. 
      </td>
    </tr>
    <tr>
      <td><code>documents_metadata</code></td>
      <td>Object</td>
      <td>No</td>
      <td>Any additional identity numbers that individual has. Note that the individual's national identity number(s) is stored in <code>personal_details.national_identity_number</code>
      </td>
    </tr>
    <tr>
      <td><code>customer_refs</code></td>
      <td>String</td>
      <td>Yes</td>
      <td>
        A label used by Passfort customers to identify the profile the check is being run against. 
      </td>
    </tr>
    <tr>
      <td><code>address_history</code></td>
      <td>Object</td>
      <td>No</td>
      <td>
        A list of addresses in which the individual has lived. Each of these can have an approximate start and end date. Refer to <a href="https://developer.passfort.com/api#tag/Profiles/paths/~1profiles~1%7Bprofile_id%7D~1collected_data/post">Passfort API Documentation</a> for additional details.
      </td>
    </tr>
  </tbody>
</table>
<h3 id='response-fields-2'>Response fields</h3>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>errors</code></td>
      <td>
        An array containing one or more
        <a href="#check-errors">Errors</a>
      </td>
      <td>No</td>
      <td>
        A list of errors that occurred while running this check. If this is
        provided and it's not empty, the result of this check is
        considered to be errored by Passfort, regardless of the other contents
        of this response.
      </td>
    </tr>
    <tr>
      <td><code>warnings</code></td>
      <td>
        An array containing one or more warnings
      </td>
      <td>No</td>
      <td>
        Essentially the same as <a href="#check-errors">errors</a>, except the
        <code>sub_type</code> and <code>data</code> fields aren't present, and
        providing warnings won't cause Passfort to consider the check
        as errored.
      </td>
    </tr>
    <tr>
      <td><code>provider_data</code></td>
      <td>
        Any valid JSON value
      </td>
      <td>No</td>
      <td>
        This should be the structured JSON data returned by the data provider
        or a conversion of the data provider's response to allow
        Passfort to investigate any issues that arise with your integration.
      </td>
    </tr>
  </tbody>
</table>

<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"provider_data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Demo result. Did not make request to provider."</span><span class="p">,</span><span class="w">
  </span><span class="s2">"warnings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"external_resources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EMBED"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://host.docker.internal:8080/external_resource"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8AA89547-89FC-4EAD-ACEC-FFA36F451337"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example embed"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"decision"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASS"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"summary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"It's a pass..."</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h4 id='check_output'><code>check_output</code></h4>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>decision</code></td>
      <td><code>DecisionClass</code></td>
      <td>Yes</td>
      <td>
        The check will return one of the following decisions: "PASS | FAIL | PARTIAL | WARN | ERROR"
      </td>
    </tr>
    <tr>
      <td><code>summary</code></td>
      <td>
      A summary of the result
        in <a href="#data-structure">the Passfort Partner API</a>.
      </td>
      <td>If a match was found by the provider</td>
      <td>As best as possible, all fields you support should be made to populate all fields supported by the provider</td>
    </tr>
    <tr>
        <tr>
      <td><code>external_resources</code></td>
      <td>
        An object 
        in <a href="#data-structure">the Passfort Partner API</a>.
      </td>
      <td>No</td>
      <td>As best as possible, all fields you support should be made to populate all fields supported by the provider</td>
    </tr>
    <tr>
      <td><code>warnings</code></td>
      <td>
        An object containing the registry data, structured as it is
        in <a href="#data-structure">the Passfort Partner API</a>.
      </td>
      <td>If a match is found by the provider</td>
      <td>As best as possible, all fields you support should be made to populate all fields supported by the provider</td>
    </tr>
    <tr>
      <td><code>errors</code></td>
      <td>
        An array containing one or more
        <a href="#check-errors">Errors</a>
      </td>
      <td>No</td>
      <td>
      A list of errors that occurred while running this check. If this is
      provided and it is not empty, the result of this check is
      considered to be errored by Passfort, regardless of the other contents
      of this response.
      </td>
    </tr>
  </tbody>
</table>
<h1 id='supported-features'>Supported Features</h1><h2 id='company-search'>Company Search</h2>
<p>The identifier for this feature is <code>COMPANY_SEARCH</code>.</p>

<p>In order to run a successful company data check, a company must be uniquely 
identified. Some company data providers allow searching through the candidates 
in their dataset in order to identify the company to be checked.</p>

<p>This endpoint exposes your data provider&apos;s company search functionality to 
Passfort.</p>
<h3 id='http-request'>HTTP Request</h3>
<p><code>POST https://my-integration.example.com/search</code></p>

<blockquote>
<p>A JSON payload following this structure will be sent to the endpoint:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"demo_result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ANY"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"commercial_relationship"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DIRECT"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"search_input"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"query"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Co."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"country_of_incorporation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"provider_credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"apikey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foobar"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>The payload of the request can contain the following fields</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always Present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>demo_result</code></td>
      <td>
        One of the <a href="#demo-result-types">specified demo result types</a>
      </td>
      <td>No</td>
      <td>
        If this field is present, the search must be considered a demo search
        and you should respond with appropriate demo data. See the
        <a href="#demo-checks">Demo Checks section</a> for more information.
      </td>
    </tr>
    <tr>
      <td><code>commercial_relationship</code></td>
      <td>One of <code>"DIRECT"</code>, <code>"PASSFORT"</code></td>
      <td>Yes</td>
      <td>
        Specified whether the search is for a customer with a direct
        relationship with your integration&apos;s data provider, or if they're
        using the search feature through PassFort&apos;s pay-as-you-go reselling scheme.
      </td>
    </tr>
    <tr>
      <td><code>search_input</code></td>
      <td>A SearchInput object</td>
      <td>Yes</td>
      <td>
        This field contains the known profile information on the company being
        searched for. 
      </td>
    </tr>
    <tr>
      <td><code>provider_config</code></td>
      <td>A user-defined JSON object</td>
      <td>Yes</td>
      <td>
        This field contains the provider configuration structured in the way
        specified by your integration&apos;s
        <a href="#get-check-configuration-one-time-sync-company-data">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option.
      </td>
    </tr>
    <tr>
      <td><code>provider_credentials</code></td>
      <td>A user-defined JSON object</td>
      <td>No</td>
      <td>
        This field contains the credentials structured in the way
        specified by your integration&apos;s
        <a href="#get-check-configuration-one-time-sync-company-data">
          configuration endpoint
        </a>, with the <code>name</code> field corresponding to the key, and
        the value being the value of the configuration option. <strong>This
        field is only sent if <code>commercial_relationship</code> is set to
        <code>"DIRECT"</code>.</strong>
      </td>
    </tr>
  </tbody>
</table>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">integration.testing</span> <span class="kn">import</span> <span class="n">create_demo_result</span>
<span class="kn">from</span> <span class="nn">integration.provider</span> <span class="kn">import</span> <span class="n">make_provider_request</span><span class="p">,</span> <span class="n">reseller_creds</span><span class="p">,</span> \
    <span class="n">convert_to_passfort_candidate</span>
<span class="kn">from</span> <span class="nn">integration.errors</span> <span class="kn">import</span> <span class="n">ProviderError</span><span class="p">,</span> <span class="n">ConnectionError</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.post</span><span class="p">(</span><span class="s">'/search'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run_search</span><span class="p">():</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>

    <span class="n">demo_result</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'demo_result'</span><span class="p">)</span>
    <span class="n">search_input</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'search_input'</span><span class="p">)</span>

    <span class="c"># Handle demo data scenarios</span>
    <span class="k">if</span> <span class="n">demo_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">create_demo_result</span><span class="p">(</span><span class="n">demo_result</span><span class="p">,</span> <span class="n">search_input</span><span class="p">))</span>

    <span class="n">commercial_rel</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'commercial_relationship'</span><span class="p">)</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">reseller_creds</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_config'</span><span class="p">)</span>

    <span class="c"># Use provided creds if search is through direct agreement</span>
    <span class="k">if</span> <span class="n">commercial_rel</span> <span class="o">==</span> <span class="s">'DIRECT'</span><span class="p">:</span>
      <span class="n">credentials</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'provider_credentials'</span><span class="p">)</span>

    <span class="c"># Make call to provider</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">make_provider_request</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">search_input</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'search_output'</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="p">[</span>
                  <span class="n">convert_to_passfort_candidate</span><span class="p">(</span><span class="n">hit</span><span class="p">)</span> 
                  <span class="k">for</span> <span class="n">hit</span> 
                  <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">hits</span>
                <span class="p">],</span>
                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">hit</span><span class="p">:</span> <span class="n">hit</span><span class="o">.</span><span class="n">score</span>
            <span class="p">),</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">'provider_data'</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_CONNECTION'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Failed to contact data provider: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="n">ProviderError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s">'errors'</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s">'type'</span><span class="p">:</span> <span class="s">'PROVIDER_MESSAGE'</span><span class="p">,</span>
                <span class="s">'message'</span><span class="p">:</span> <span class="n">f</span><span class="s">'Provider error: {str(e)}'</span>
            <span class="p">}],</span>
            <span class="s">'warnings'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"express"</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="kr">const</span> <span class="p">{</span> <span class="nx">createDemoResult</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"./testing"</span><span class="p">);</span>
<span class="kr">const</span> <span class="p">{</span>
  <span class="nx">makeProviderRequest</span><span class="p">,</span>
  <span class="nx">RESELLER_CREDS</span><span class="p">,</span>
  <span class="nx">convertToPassFortCandidate</span><span class="p">,</span>
<span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"./provider"</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">"/search"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Handle demo data scenarios</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">demo_result</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span>
      <span class="nx">createDemoResult</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">demo_result</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">search_input</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Use provided creds if check is through direct agreement</span>
  <span class="kr">const</span> <span class="nx">credentials</span> <span class="o">=</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">commercial_relationship</span> <span class="o">===</span> <span class="s2">"DIRECT"</span>
      <span class="p">?</span> <span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">provider_credentials</span>
      <span class="p">:</span> <span class="nx">RESELLER_CREDS</span><span class="p">;</span>

  <span class="k">return</span> <span class="nx">makeProviderRequest</span><span class="p">(</span>
    <span class="nx">credentials</span><span class="p">,</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">provider_config</span><span class="p">,</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">search_input</span>
  <span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">searchResult</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">search_output</span><span class="p">:</span> <span class="nx">searchResult</span><span class="p">.</span><span class="nx">hits</span>
          <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">hit</span> <span class="o">=&gt;</span> <span class="nx">convertToPassFortCandidate</span><span class="p">(</span><span class="nx">hit</span><span class="p">))</span>
          <span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">score</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">score</span><span class="p">)</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
        <span class="na">errors</span><span class="p">:</span> <span class="p">[],</span>
        <span class="na">warnings</span><span class="p">:</span> <span class="p">[],</span>
        <span class="na">provider_data</span><span class="p">:</span> <span class="nx">checkResult</span><span class="p">.</span><span class="nx">data</span><span class="p">(),</span>
      <span class="p">});</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">"CONNECTION"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
          <span class="na">errors</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="s2">"PROVIDER_CONNECTION"</span><span class="p">,</span>
              <span class="na">error</span><span class="p">:</span> <span class="s2">"Failed to contact data provider: "</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">],</span>
          <span class="na">warnings</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
          <span class="na">errors</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="na">type</span><span class="p">:</span> <span class="s2">"PROVIDER_MESSAGE"</span><span class="p">,</span>
              <span class="na">error</span><span class="p">:</span> <span class="s2">"Provider error: "</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">],</span>
          <span class="na">warnings</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre>
<blockquote>
<p>This endpoint should return JSON in the following format:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"search_output"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Company"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123456"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"country_of_incorporation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ACTIVE"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"provider_reference"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MY-INTEGRATION"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GB-123456"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Couches"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9876531"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"country_of_incorporation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DORMANT"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"provider_reference"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My-INTEGRATION"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GB-9876531"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Cars"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4851723"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"country_of_incorporation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GBR"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DISSOLVED"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"provider_reference"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMPANY_DATA_REFERENCE_INTEGRATION"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GB-4851723"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"warnings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"provider_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='response-fields'>Response fields</h3>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>search_output</code></td>
      <td>A list of objects structured per <code>Candidate</code> below</td>
      <td>If search did not error</td>
      <td>
        Indicates the list of candidates for this search. If supported by the provider,
        they should be sorted by match likelihood with the best match first.
      </td>
    </tr>
    <tr>
      <td><code>errors</code></td>
      <td>
        An array containing one or more
        <a href="#check-errors">Errors</a>
      </td>
      <td>No</td>
      <td>
        A list of errors that occurred while running this search. If
        this is provided and is not empty, Passfort considers the
        result of this search to be errored, regardless of the other
        contents of this response.
      </td>
    </tr>
    <tr>
      <td><code>warnings</code></td>
      <td>
        An array containing one or more warnings
      </td>
      <td>No</td>
      <td>
        Essentially the same as <code>errors</code>, except the
        <code>sub_type</code> and <code>data</code> fields aren't present, and
        providing warnings won't cause Passfort to consider the search
        as errored.
      </td>
    </tr>
    <tr>
      <td><code>provider_data</code></td>
      <td>
        Any valid JSON value
      </td>
      <td>No</td>
      <td>
        This should be the structured JSON data returned by the data provider
        or a conversion of the data provider&apos;s response to allow
        Passfort to investigate any issues that arise with your integration.
      </td>
    </tr>
    <tr>
      <td><code>charges</code></td>
      <td>
        An array containing one or more
        <a href="#check-charges">Charges</a>
      </td>
      <td>No</td>
      <td>
        A list of charges incurred while running this search. Charges may only
        be returned if both of these conditions are met:
        <ul>
          <li>No errors occur when the check is run.</li>
          <li>
            The check is resold by Passfort.
          </li>
        </ul>
        
        For demo searches, charges may be returned but they won't be deducted
        from the institution&apos;s credit.
        
        If charges are returned, the total amount charged must be no greater
        than the maximum cost-per-check specified in the integration&apos;s
        configuration.
      </td>
    </tr>
  </tbody>
</table>
<h4 id='candidate'><code>Candidate</code></h4>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>name</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>The registered name of the company.</td>
    </tr>
    <tr>
      <td><code>number</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>The company&apos;s number or identifier in some registry.</td>
    </tr>
    <tr>
      <td><code>number_label</code></td>
      <td>string</td>
      <td>No</td>
      <td>Text to use as a label to explain the <code>number</code>, such
          as "Company number", "Charity number", "VAT number" etc.
      </td>
    </tr>
    <tr>
      <td><code>country_of_incorporation</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>
        The <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3">ISO3 country code</a>
        for the country where the company is incorporated.
      </td>
    </tr>
    <tr>
      <td><code>status</code></td>
      <td>string</td>
      <td>No</td>
      <td>
        A string describing the current functioning of the company (e.g. "Active" or "Dissolved")
      </td>
    </tr>
    <tr>
      <td><code>provider_reference</code></td>
      <td>
        A ProviderRef object
      </td>
      <td>No</td>
      <td>
        An object uniquely identifying this candidate from this provider,
        structured as it is in <a href="#data-structure">the Passfort Partner API</a>
      </td>
    </tr>
    <tr>
      <td><code>addresses</code></td>
      <td>
        A list of CompanyAddress objects
      </td>
      <td>No</td>
      <td>
        Addresses of the company, with each CompanyAddress object structured
        as it is in <a href="#data-structure">the Passfort Partner API</a>.
      </td>
    </tr>
    <tr>
      <td><code>contact</code></td>
      <td>
        A CompanyContactDetails object
      </td>
      <td>No</td>
      <td>
        Contact details for the company, in an object structured as it
        is in <a href="#data-structure">the Passfort Partner API</a>.
      </td>
    </tr>
    <tr>
      <td><code>incorporation_date</code></td>
      <td>
        string
      </td>
      <td>No</td>
      <td>
        Exact date in YYYY-MM-DD format
      </td>
    </tr>
    <tr>
      <td><code>structure_type</code></td>
      <td>
        A StructuredCompanyType object
      </td>
      <td>No</td>
      <td>
        An object describing the company type: its members&apos; liability, its
        ownership structure, and whether it is traded publicly. The object is
        structured as it is in <a href="#data-structure">the Passfort Partner API</a>.
      </td>
    </tr>
    <tr>
      <td><code>lei</code></td>
      <td>string</td>
      <td>No</td>
      <td>Global Legal Entity Identifier</td>
    </tr>
    <tr>
      <td><code>tax_ids</code></td>
      <td>List of TaxId objects</td>
      <td>No</td>
      <td>
        Tax identifiers, with each TaxId object structured as in <a
        href="#data-structure">the Passfort Partner API</a>.
      </td>
    </tr>
    <tr>
      <td><code>bvd_id</code></td>
      <td>string</td>
      <td>No</td>
      <td>Moody&apos;s unique company identifier</td>
    </tr>
</tbody>
</table>
<h2 id='provider-field-checks'>Provider Field Checks</h2>
<p>The identifier for this feature is <code>PROVIDER_FIELD_CHECKS</code>. This feature is compatible
with the <a href="#one-time-sync-company-data">One-time Sync Company Data</a> check type.</p>

<p>This feature allows an integration to return an array of <code>CompanyFieldCheck</code> objects.
The <code>CompanyFieldCheck</code> object describes whether a particular field (i.e. company name or number)
has been matched or mismatched according to the integration’s custom logic. Provider field checks
should be surfaced using the <code>field_checks</code> attribute of the <code>check_output</code>.</p>
<h4 id='companyfieldcheck'><code>CompanyFieldCheck</code></h4>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>field</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>The field that the result refers to. One of 
      <code>["NAME", "NUMBER", "COUNTRY_OF_INCORPORATION", "IS_ACTIVE", "LEI", "ADDRESS"]</code></td>
    <tr>
    <tr>
      <td><code>result</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>The result of the comparison. One of <code>["MATCH", "MISMATCH"]</code></td>
    <tr>
  </tbody>
</table>
<h2 id='embedding-or-linking-an-external-webpage'>Embedding or linking an external webpage</h2>
<p>Integrations have the option to include a URL within the check result. This URL can then either be displayed as a link or used to embed the resulting webpage within Passfort.</p>

<p>The identifier for this feature is either <code>EXTERNAL_LINK</code> or <code>EXTERNAL_EMBED</code> depending on how you intend to surface the external resource. This feature is compatible with all of our supported check types.</p>

<p>The <code>external_resources</code> object includes: whether the external resource is displayed as a link or an embed, the url, id, and a label describing the resource. </p>

<blockquote>
<p>This endpoint returns JSON in the following format:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"provider_data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Demo result. Did not make request to provider."</span><span class="p">,</span><span class="w">
  </span><span class="s2">"warnings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">

  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"external_resources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EMBED"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://host.docker.internal:8080/external_resource"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8AA89547-89FC-4EAD-ACEC-FFA36F451337"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example embed"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"decision"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PASS"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"summary"</span><span class="p">:</span><span class="w"> </span><span class="s2">"It's a pass..."</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>type</code></td>
      <td>"EMBED"</a></td>
      <td>No</td>
      <td>The type of external resource that's being reported.</td>
    </tr>
    <tr>
      <td><code>url</code></td>
      <td>string</code></td>
      <td>No</td>
      <td>Provides additional detail for certain types of error.</td>
    </tr>
    <tr>
      <td><code>id</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>
        The <code>external_resource</code> identifier.
      </td>
    </tr>
    <tr>
      <td><code>label</code></td>
      <td>string</td>
      <td>No</td>
      <td>
        Integration-specific structured error information that customers can
        use to get additional information about the error.
      </td>
    </tr>
  </tbody>
</table>
<h3 id='authentication'>Authentication</h3>
<p>Passfort makes a request to your application via a signed url, which contains arguments as query parameters:</p>

<p><code>https://your-url.com/<your-id>?version=<version>&amp;valid_until=<valid_until>&amp;auditee_id=<auditee_id>&amp;signature=<signature></code></p>

<p>The list of query parameter arguments is shown below, and is delivered in this order:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>custom_data</code></td>
      <td>string</td>
      <td>No</td>
      <td>Any other parameters the integration wishes to have provided.</td>
    </tr>
    <tr>
      <td><code>version</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>Versioning information for the signed URL.</td>
    </tr>
    <tr>
      <td><code>valid_until</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>The epoch time the URL is considered valid until. Requests after this time will be deemed unauthentic by your integration.</td>
    </tr>
    <tr>
      <td><code>auditee_id</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>UUID identifying the user or API key viewing the check.</td>
    </tr>
    <tr>
      <td><code>signature</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>A base64url encoding of the SHA-256 HMAC of the entire URL, excluding the signature parameter.</td>
    </tr>
  </tbody>
</table>

<p>The signature contains a HMAC of the entire URL excluding &amp;signature=<signature>, and can be verified using a shared secret between Passfort and your backend systems.</p>

<p>The entire base URL (https://you-url.com/<your-id>) is returned by your integration as part of the result. It’s worth noting this URL should be considered permanent, meaning the content it serves should not change over time.</p>
<h1 id='requests-to-passfort'>Requests to Passfort</h1>
<p>Although the majority of the integrations API consists of endpoints
to be served by an integration and called by Passfort. There <em>are</em>
several endpoints provided by Passfort to allow an integration to
do its job. These endpoints are documented in this section.</p>

<aside class="info">
Requests to Passfort are authenticated in exactly the same way
as requests in the other direction, using the same shared key.
See the <a href="#authentication">authentication section</a> for
more details.
</aside>
<h2 id='callbacks'>Callbacks</h2>
<p>If your integration follows one of the callback-based check templates,
such as <code>ONE_TIME_SYNC_CALLBACK</code> you will need to make requests to
Passfort&#39;s &quot;callback&quot; endpoint to notify us of certain events, such
as when a check is complete.</p>
<h3 id='http-request'>HTTP Request</h3>
<p><code>POST https://api.passfort.com/integrations/v1/callbacks</code></p>

<blockquote>
<p>A JSON payload following this structure should be sent to the endpoint:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"provider_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b0b7611e-c024-4ffb-9f9f-928992bec445"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"reference"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"custom_data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"my_field"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Depending on the nature of the callback, additional fields may also be
expected. It will be documented in the check-specific documentation,
if any additional fields are expected.</p>

<p>Regardless of the check type, the payload of the request should contain
the following fields:</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Required?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>provider_id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        This should match the provider ID returned by your integration when
        the check was started.
      </td>
    </tr>
    <tr>
      <td><code>reference</code></td>
      <td>string</td>
      <td>Yes</td>
      <td>
        This should match the reference returned by your integration when
        the check was started.
      </td>
    </tr>
    <tr>
      <td><code>custom_data</code></td>
      <td>object</td>
      <td>No</td>
      <td>
        An object containing custom data to be sent to your integration in
        follow-up requests relating to this check. If we are already storing
        custom data for this check, the new data will be merged in, overwriting
        any fields with the same name.
      </td>
    </tr>
  </tbody>
</table>
<pre class="highlight python tab-python"><code><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
    <span class="s">"provider_id"</span><span class="p">:</span> <span class="s">"b0b7611e-c024-4ffb-9f9f-928992bec445"</span><span class="p">,</span>
    <span class="s">"reference"</span><span class="p">:</span> <span class="s">"12345"</span><span class="p">,</span>
    <span class="s">"custom_data"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">"my_field"</span><span class="p">:</span> <span class="mi">42</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="n">auth</span><span class="o">=</span><span class="n">outbound_auth</span><span class="p">())</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="nx">await</span> <span class="nx">outbound_auth</span><span class="p">().</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span><span class="s1">'POST'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'Content-Type'</span><span class="p">:</span> <span class="s1">'application/json'</span>
    <span class="p">}</span>
    <span class="nl">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
        <span class="na">provider_id</span><span class="p">:</span> <span class="s1">'b0b7611e-c024-4ffb-9f9f-928992bec445'</span><span class="p">,</span>
        <span class="na">reference</span><span class="p">:</span> <span class="s1">'12345'</span><span class="p">,</span>
        <span class="na">custom_data</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">my_field</span><span class="p">:</span> <span class="mi">42</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">})</span>
</code></pre>
<p>If this endpoint returns a non-2xx status code, the callback should be retried several
times (with an exponential backoff) to ensure that events aren&#39;t lost. If the callback
is being triggered by the provider, it is expected that the integration will simply
forward the failure code to the provider, at which point it is the provider&#39;s job to
retry appropriately.</p>

<blockquote>
<p>This endpoint will return JSON in the following format:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"callback_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"243c4758-28a2-476f-868d-7ce239f9574b"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<aside class="warning">
    Your requests to this endpoint must be signed
   per the <a href="#authentication">authentication section</a>.
</aside>
<h3 id='response-fields'>Response fields</h3>
<p>There will never be any check-type-specific fields returned from this endpoint.</p>

<table>
  <thead>
    <th>Field</th>
    <th>Type</th>
    <th>Always present?</th>
    <th>Description</th>
  </thead>
  <tbody>
    <tr>
      <td><code>callback_id</code></td>
      <td>UUID</td>
      <td>Yes</td>
      <td>
        This field has no specific purpose, but if you need to contact our support
        for an issue relating to callbacks, we may ask for this field so that we
        can cross-reference your requests with our own logs.
      </td>
    </tr>
  </tbody>
</table>
<h2 id='download-image'>Download image</h2>
<p>If your integration implements a Document verification check, you will need
to download images from our system to pass to the provider.</p>

<p>This endpoint returns the raw image data for a given image ID. Your integration
will be granted temporary access to an image whenever a check using that image
is instructed.</p>
<h3 id='http-request-2'>HTTP Request</h3>
<p><code>GET https://api.passfort.com/integrations/v1/images/{image_id}</code></p>
<pre class="highlight python tab-python"><code><span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="n">outbound_auth</span><span class="p">())</span>
<span class="n">res</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<span class="n">image_bytes</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">content</span>
</code></pre><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">outbound_auth</span><span class="p">().</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">`Failed to fetch image: </span><span class="p">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">statusText</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">imageBytes</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">body</span>
</code></pre>
<blockquote>
<p>This endpoint will return the raw image data.</p>
</blockquote>

<aside class="warning">
    Your requests to this endpoint must be signed
   per the <a href="#authentication">authentication section</a>.
</aside>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="python">Python</a>
                <a href="#" data-language-name="javascript">NodeJS</a>
          </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.8.2/js/lightbox.min.js"></script>
    <script>
      lightbox.option({
        'fadeDuration': 200,
        'resizeDuration': 300
      })
    </script>
  </body>
</html>
